import{c as Ae,o as $e,h as ae,m as J,i as le,N as Ge,P as V,k as K,j as Le,l as Oe,$ as Me,b as S,Y as Q,Z as O}from"./index-Du5PH0RG.js";import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as o}from"./chunk-charts-BaLkbnPn.js";import{I as W}from"./input-CMm-Oln2.js";import{u as de}from"./index-D4-djExh.js";import{u as Be}from"./index-ZeZSZmiz.js";import{C as Ke}from"./circle-CjsJvtH0.js";import{B as ue}from"./button-C6GEJN0y.js";import{C as H}from"./chevron-down-D7MM-WkY.js";import{S as X}from"./search-BglzbusU.js";import{C as Z}from"./check-lyfQA_S-.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],St=Ae("pencil",Ye);var re="rovingFocusGroup.onEntryFocus",Qe={bubbles:!1,cancelable:!0},z="RovingFocusGroup",[oe,fe,Ve]=$e(z),[ze,pe]=ae(z,[Ve]),[qe,We]=ze(z),me=o.forwardRef((r,d)=>e.jsx(oe.Provider,{scope:r.__scopeRovingFocusGroup,children:e.jsx(oe.Slot,{scope:r.__scopeRovingFocusGroup,children:e.jsx(He,{...r,ref:d})})}));me.displayName=z;var He=o.forwardRef((r,d)=>{const{__scopeRovingFocusGroup:i,orientation:u,loop:p=!1,dir:x,currentTabStopId:v,defaultCurrentTabStopId:k,onCurrentTabStopIdChange:y,onEntryFocus:I,preventScrollOnEntryFocus:m=!1,...b}=r,C=o.useRef(null),h=J(d,C),c=de(x),[w,n]=le({prop:v,defaultProp:k??null,onChange:y,caller:z}),[a,P]=o.useState(!1),f=Ge(I),j=fe(i),T=o.useRef(!1),[F,R]=o.useState(0);return o.useEffect(()=>{const g=C.current;if(g)return g.addEventListener(re,f),()=>g.removeEventListener(re,f)},[f]),e.jsx(qe,{scope:i,orientation:u,dir:c,loop:p,currentTabStopId:w,onItemFocus:o.useCallback(g=>n(g),[n]),onItemShiftTab:o.useCallback(()=>P(!0),[]),onFocusableItemAdd:o.useCallback(()=>R(g=>g+1),[]),onFocusableItemRemove:o.useCallback(()=>R(g=>g-1),[]),children:e.jsx(V.div,{tabIndex:a||F===0?-1:0,"data-orientation":u,...b,ref:h,style:{outline:"none",...r.style},onMouseDown:K(r.onMouseDown,()=>{T.current=!0}),onFocus:K(r.onFocus,g=>{const D=!T.current;if(g.target===g.currentTarget&&D&&!a){const L=new CustomEvent(re,Qe);if(g.currentTarget.dispatchEvent(L),!L.defaultPrevented){const _=j().filter(A=>A.focusable),M=_.find(A=>A.active),s=_.find(A=>A.id===w),q=[M,s,..._].filter(Boolean).map(A=>A.ref.current);ge(q,m)}}T.current=!1}),onBlur:K(r.onBlur,()=>P(!1))})})}),he="RovingFocusGroupItem",xe=o.forwardRef((r,d)=>{const{__scopeRovingFocusGroup:i,focusable:u=!0,active:p=!1,tabStopId:x,children:v,...k}=r,y=Le(),I=x||y,m=We(he,i),b=m.currentTabStopId===I,C=fe(i),{onFocusableItemAdd:h,onFocusableItemRemove:c,currentTabStopId:w}=m;return o.useEffect(()=>{if(u)return h(),()=>c()},[u,h,c]),e.jsx(oe.ItemSlot,{scope:i,id:I,focusable:u,active:p,children:e.jsx(V.span,{tabIndex:b?0:-1,"data-orientation":m.orientation,...k,ref:d,onMouseDown:K(r.onMouseDown,n=>{u?m.onItemFocus(I):n.preventDefault()}),onFocus:K(r.onFocus,()=>m.onItemFocus(I)),onKeyDown:K(r.onKeyDown,n=>{if(n.key==="Tab"&&n.shiftKey){m.onItemShiftTab();return}if(n.target!==n.currentTarget)return;const a=Je(n,m.orientation,m.dir);if(a!==void 0){if(n.metaKey||n.ctrlKey||n.altKey||n.shiftKey)return;n.preventDefault();let f=C().filter(j=>j.focusable).map(j=>j.ref.current);if(a==="last")f.reverse();else if(a==="prev"||a==="next"){a==="prev"&&f.reverse();const j=f.indexOf(n.currentTarget);f=m.loop?et(f,j+1):f.slice(j+1)}setTimeout(()=>ge(f))}}),children:typeof v=="function"?v({isCurrentTabStop:b,hasTabStop:w!=null}):v})})});xe.displayName=he;var Xe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ze(r,d){return d!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function Je(r,d,i){const u=Ze(r.key,i);if(!(d==="vertical"&&["ArrowLeft","ArrowRight"].includes(u))&&!(d==="horizontal"&&["ArrowUp","ArrowDown"].includes(u)))return Xe[u]}function ge(r,d=!1){const i=document.activeElement;for(const u of r)if(u===i||(u.focus({preventScroll:d}),document.activeElement!==i))return}function et(r,d){return r.map((i,u)=>r[(d+u)%r.length])}var tt=me,rt=xe,ne="Radio",[ot,ve]=ae(ne),[st,at]=ot(ne),ye=o.forwardRef((r,d)=>{const{__scopeRadio:i,name:u,checked:p=!1,required:x,disabled:v,value:k="on",onCheck:y,form:I,...m}=r,[b,C]=o.useState(null),h=J(d,n=>C(n)),c=o.useRef(!1),w=b?I||!!b.closest("form"):!0;return e.jsxs(st,{scope:i,checked:p,disabled:v,children:[e.jsx(V.button,{type:"button",role:"radio","aria-checked":p,"data-state":Ie(p),"data-disabled":v?"":void 0,disabled:v,value:k,...m,ref:h,onClick:K(r.onClick,n=>{p||y==null||y(),w&&(c.current=n.isPropagationStopped(),c.current||n.stopPropagation())})}),w&&e.jsx(je,{control:b,bubbles:!c.current,name:u,value:k,checked:p,required:x,disabled:v,form:I,style:{transform:"translateX(-100%)"}})]})});ye.displayName=ne;var Ne="RadioIndicator",be=o.forwardRef((r,d)=>{const{__scopeRadio:i,forceMount:u,...p}=r,x=at(Ne,i);return e.jsx(Oe,{present:u||x.checked,children:e.jsx(V.span,{"data-state":Ie(x.checked),"data-disabled":x.disabled?"":void 0,...p,ref:d})})});be.displayName=Ne;var nt="RadioBubbleInput",je=o.forwardRef(({__scopeRadio:r,control:d,checked:i,bubbles:u=!0,...p},x)=>{const v=o.useRef(null),k=J(v,x),y=Be(i),I=Me(d);return o.useEffect(()=>{const m=v.current;if(!m)return;const b=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(b,"checked").set;if(y!==i&&h){const c=new Event("click",{bubbles:u});h.call(m,i),m.dispatchEvent(c)}},[y,i,u]),e.jsx(V.input,{type:"radio","aria-hidden":!0,defaultChecked:i,...p,tabIndex:-1,ref:k,style:{...p.style,...I,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});je.displayName=nt;function Ie(r){return r?"checked":"unchecked"}var it=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ee="RadioGroup",[ct,Ct]=ae(ee,[pe,ve]),Se=pe(),Ce=ve(),[lt,dt]=ct(ee),we=o.forwardRef((r,d)=>{const{__scopeRadioGroup:i,name:u,defaultValue:p,value:x,required:v=!1,disabled:k=!1,orientation:y,dir:I,loop:m=!0,onValueChange:b,...C}=r,h=Se(i),c=de(I),[w,n]=le({prop:x,defaultProp:p??null,onChange:b,caller:ee});return e.jsx(lt,{scope:i,name:u,required:v,disabled:k,value:w,onValueChange:n,children:e.jsx(tt,{asChild:!0,...h,orientation:y,dir:c,loop:m,children:e.jsx(V.div,{role:"radiogroup","aria-required":v,"aria-orientation":y,"data-disabled":k?"":void 0,dir:c,...C,ref:d})})})});we.displayName=ee;var Pe="RadioGroupItem",ke=o.forwardRef((r,d)=>{const{__scopeRadioGroup:i,disabled:u,...p}=r,x=dt(Pe,i),v=x.disabled||u,k=Se(i),y=Ce(i),I=o.useRef(null),m=J(d,I),b=x.value===p.value,C=o.useRef(!1);return o.useEffect(()=>{const h=w=>{it.includes(w.key)&&(C.current=!0)},c=()=>C.current=!1;return document.addEventListener("keydown",h),document.addEventListener("keyup",c),()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",c)}},[]),e.jsx(rt,{asChild:!0,...k,focusable:!v,active:b,children:e.jsx(ye,{disabled:v,required:x.required,checked:b,...y,...p,name:x.name,ref:m,onCheck:()=>x.onValueChange(p.value),onKeyDown:K(h=>{h.key==="Enter"&&h.preventDefault()}),onFocus:K(p.onFocus,()=>{var h;C.current&&((h=I.current)==null||h.click())})})})});ke.displayName=Pe;var ut="RadioGroupIndicator",Re=o.forwardRef((r,d)=>{const{__scopeRadioGroup:i,...u}=r,p=Ce(i);return e.jsx(be,{...p,...u,ref:d})});Re.displayName=ut;var De=we,Ee=ke,ft=Re;const Fe=o.forwardRef(({className:r,...d},i)=>e.jsx(De,{className:S("grid gap-2",r),...d,ref:i}));Fe.displayName=De.displayName;const se=o.forwardRef(({className:r,...d},i)=>e.jsx(Ee,{ref:i,className:S("aspect-square h-4 w-4 rounded-full border border-input text-primary ring-offset-background focus:outline-none focus-visible:ring-0 focus-visible:ring-offset-0 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:border-primary",r),...d,children:e.jsx(ft,{className:"flex items-center justify-center",children:e.jsx(Ke,{className:"h-2.5 w-2.5 fill-current text-current"})})}));se.displayName=Ee.displayName;const wt=({cityRef:r,warehouseRef:d,deliveryType:i,isExpanded:u=!0,onCityChange:p,onWarehouseChange:x,onDeliveryTypeChange:v,onContinue:k})=>{const[y,I]=o.useState([]),[m,b]=o.useState([]),[C,h]=o.useState([]),[c,w]=o.useState(null),[n,a]=o.useState(null),[P,f]=o.useState(!1),[j,T]=o.useState(!1),[F,R]=o.useState(""),[g,D]=o.useState("");o.useEffect(()=>{Q.getPopularCities().then(I).catch(console.error)},[]),o.useEffect(()=>{r?Q.getCity(r).then(s=>{w(s)}).catch(console.error):w(null)},[r]),o.useEffect(()=>{d&&c?Q.getWarehouse(d).then(s=>{a(s)}).catch(console.error):a(null)},[d,c]),o.useEffect(()=>{if(F.length>=2){const s=setTimeout(()=>{Q.searchCities(F).then(b).catch(console.error)},300);return()=>clearTimeout(s)}else b([])},[F]),o.useEffect(()=>{c&&(console.log("üîÑ [NovaPoshtaDelivery] Loading warehouses for city:",{cityRef:c.ref,cityName:c.description_ua,deliveryType:i}),f(!1),R(""),b([]),T(!1),D(""),Q.getWarehouses(c.ref,i).then(s=>{console.log(`‚úÖ [NovaPoshtaDelivery] Loaded ${s.length} warehouses for city ${c.ref}`),s.length>0&&console.log("üì¶ [NovaPoshtaDelivery] Sample warehouse:",s[0]),h(s)}).catch(s=>{console.error("‚ùå [NovaPoshtaDelivery] Error loading warehouses:",s)}))},[c,i]),o.useEffect(()=>{j&&c&&(C.length===0||g)&&(console.log("üîÑ [NovaPoshtaDelivery] Loading warehouses on dropdown open"),Q.getWarehouses(c.ref,i,g||void 0).then(s=>{console.log(`‚úÖ [NovaPoshtaDelivery] Loaded ${s.length} warehouses on open`),h(s)}).catch(s=>{console.error("‚ùå [NovaPoshtaDelivery] Error loading warehouses on open:",s)}))},[j]),o.useEffect(()=>{if(j&&c&&g.length>=2){const s=setTimeout(()=>{Q.getWarehouses(c.ref,i,g).then(U=>{console.log(`‚úÖ [NovaPoshtaDelivery] Search found ${U.length} warehouses`),h(U)}).catch(U=>{console.error("‚ùå [NovaPoshtaDelivery] Search error:",U)})},300);return()=>clearTimeout(s)}},[g,j]);const L=s=>{w(s),a(null),p(s),x(null),f(!1),R("")},_=s=>{a(s),x(s),T(!1),D("")},M=F.length>=2?m:y;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3 ml-[28px]",children:e.jsxs(Fe,{value:i,onValueChange:s=>v(s),className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(se,{value:"PostOffice",id:"postoffice"}),e.jsx("span",{children:"–£ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(se,{value:"Postomat",id:"postomat"}),e.jsx("span",{children:"–£ –ø–æ—à—Ç–æ–º–∞—Ç"})]})]})}),e.jsxs("fieldset",{className:"space-y-2",children:[e.jsxs("legend",{className:"flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{children:"–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:S("flex h-10 w-full items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm cursor-pointer","hover:border-primary transition-colors",!c&&"opacity-60"),onClick:()=>{f(!P),P||R("")},children:[e.jsx("span",{className:c?"text-foreground":"text-muted-foreground",children:c?c.full_description_ua:"–í–∏–±–µ—Ä—ñ—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç"}),e.jsx(H,{className:S("h-4 w-4 transition-transform text-muted-foreground",P&&"rotate-180")})]}),P&&e.jsxs("div",{className:"border rounded-xl bg-background overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(W,{type:"text",placeholder:"–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É –≤—ñ–¥ 3-—Ö –±—É–∫–≤",value:F,onChange:s=>R(s.target.value),className:"pl-10",autoFocus:!0,onClick:s=>s.stopPropagation()})]})}),F.length<2&&y.length>0&&e.jsx("div",{className:"p-3 border-b",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:y.slice(0,5).map(s=>e.jsx("button",{type:"button",onClick:U=>{U.stopPropagation(),L(s)},className:"px-3 py-1.5 text-sm border rounded-lg",children:s.description_ua},s.ref))})}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:M.length>0?e.jsx("div",{className:"p-2",children:M.map(s=>e.jsxs("button",{type:"button",onClick:U=>{U.stopPropagation(),L(s)},className:S("w-full flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer text-left",(c==null?void 0:c.ref)===s.ref&&"text-primary font-medium"),children:[(c==null?void 0:c.ref)===s.ref&&e.jsx(Z,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:S("flex-1",(c==null?void 0:c.ref)===s.ref&&"text-primary"),children:s.full_description_ua})]},s.ref))}):F.length>=2?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"}):e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞"})})]})]})]}),c&&e.jsxs("fieldset",{className:"space-y-2",children:[e.jsxs("legend",{className:"flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{children:i==="PostOffice"?"–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è":"–ü–æ—à—Ç–æ–º–∞—Ç"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:S("flex min-h-10 w-full items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm cursor-pointer","hover:border-primary transition-colors",!c&&"opacity-60"),onClick:()=>{T(!j),j||D("")},children:[e.jsx("span",{className:S("flex-1 break-words pr-2",n?"text-foreground":"text-muted-foreground"),children:n?n.description_ua:i==="PostOffice"?"–í–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è":"–í–∏–±–µ—Ä—ñ—Ç—å –ø–æ—à—Ç–æ–º–∞—Ç"}),e.jsx(H,{className:S("h-4 w-4 transition-transform text-muted-foreground flex-shrink-0",j&&"rotate-180")})]}),j&&e.jsxs("div",{className:"border rounded-xl bg-background overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(W,{type:"text",placeholder:i==="PostOffice"?"–í–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è":"–í–∏–±–µ—Ä—ñ—Ç—å –ø–æ—à—Ç–æ–º–∞—Ç",value:g,onChange:s=>D(s.target.value),className:"pl-10 rounded-xl",autoFocus:!0,onClick:s=>s.stopPropagation()})]})}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:C.length>0?e.jsx("ul",{className:"p-2 space-y-1",children:C.map(s=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:U=>{U.stopPropagation(),_(s)},className:S("w-full flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer text-left",(n==null?void 0:n.ref)===s.ref&&"text-primary font-medium"),children:[(n==null?void 0:n.ref)===s.ref&&e.jsx(Z,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:S("flex-1 text-sm",(n==null?void 0:n.ref)===s.ref&&"text-primary"),children:s.description_ua})]})},s.ref))}):e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:g.length>=2?"–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ":"–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è..."})})]})]})]}),u&&k&&e.jsx("div",{className:"pt-4",children:e.jsx(ue,{type:"button",onClick:k,disabled:!c||!n,variant:"outline",className:"w-full rounded-xl border h-10 hover:border hover:bg-transparent hover:text-primary disabled:hover:text-primary disabled:opacity-50",children:"–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏"})})]})},Pt=({cityId:r,branchId:d,savedCityName:i,savedCityRegion:u,savedBranchName:p,savedBranchAddress:x,savedBranchPostalCode:v,isExpanded:k=!0,onCityChange:y,onBranchChange:I,onContinue:m})=>{const[b,C]=o.useState([]),[h,c]=o.useState([]),[w,n]=o.useState([]),[a,P]=o.useState(null),[f,j]=o.useState(null);o.useEffect(()=>{if(r&&i&&!a){let t=i,l=u||"";const N=i.match(/^(.+?)\s*\((.+?)\)$/);if(N){t=N[1].trim();const $=N[2].trim();$==="*"?l="":l=$}const E=parseInt(r.toString(),10);if(isNaN(E)||E<=0){console.log(`üîç [UkrPoshtaDelivery] Saved cityId "${r}" is not numeric, searching via API for "${t}"...`),O.searchCities(t).then($=>{const te=G=>G?G.replace(/\s*–æ–±–ª\.?\s*$/i,"").trim():"",ce=te(l),Y=$.find(G=>{const _e=G.name.toLowerCase()===t.toLowerCase(),Ue=ce?te(G.region||"")===ce:!0,Te=G.cityId&&!isNaN(parseInt(G.cityId.toString(),10));return _e&&Ue&&Te});if(Y&&Y.cityId){console.log(`‚úÖ [UkrPoshtaDelivery] Found numeric CITY_ID ${Y.cityId} for saved city "${t}"`);const G={id:Y.cityId.toString(),name:Y.name,postalCode:"",region:Y.region||l,cityId:Y.cityId.toString()};P(G),y(G)}else console.warn(`‚ö†Ô∏è [UkrPoshtaDelivery] Could not find numeric CITY_ID for saved city "${t}"`),P({id:r,name:t,postalCode:"",region:l,cityId:r})}).catch($=>{console.error(`‚ùå [UkrPoshtaDelivery] Error searching for saved city "${t}":`,$),P({id:r,name:t,postalCode:"",region:l,cityId:r})});return}const B={id:r,name:t,postalCode:"",region:l,cityId:r};P(B),console.log("‚ö° [UkrPoshtaDelivery] Instant city display from saved data:",B)}},[r,i,u,a,y]),o.useEffect(()=>{if(d&&p&&!f&&a){const t={id:d,name:p,address:x||"",postalCode:v||"",cityId:a.id};j(t),console.log("‚ö° [UkrPoshtaDelivery] Instant branch display from saved data:",t)}},[d,p,x,v,f,a]);const[T,F]=o.useState(!1),[R,g]=o.useState(!1),[D,L]=o.useState(""),[_,M]=o.useState("");o.useEffect(()=>{O.getPopularCities().then(C).catch(console.error)},[]),o.useEffect(()=>{if(r){const t=parseInt(r.toString(),10);if(isNaN(t)||t<=0){console.warn(`‚ö†Ô∏è [UkrPoshtaDelivery] Invalid cityId (not a numeric CITY_ID): ${r}. Skipping API call.`),P(null);return}console.log(`üîç [UkrPoshtaDelivery] Loading city by ID: ${r}`),O.getCity(r).then(l=>{console.log("‚úÖ [UkrPoshtaDelivery] Loaded city:",l),P(l)}).catch(l=>{l.message&&l.message.includes("City not found")?console.warn(`‚ö†Ô∏è [UkrPoshtaDelivery] City with ID ${r} not found in API. This may be normal if the city was removed or ID changed.`):console.error(`‚ùå [UkrPoshtaDelivery] Error loading city ${r}:`,l),P(null)})}else P(null)},[r]),o.useEffect(()=>{if(d&&a){const t=a.cityId||a.id;O.getBranch(d,t).then(l=>{j(l)}).catch(console.error)}else j(null)},[d,a]),o.useEffect(()=>{if(D.length>=2){const t=setTimeout(()=>{console.log("üîç [UkrPoshtaDelivery] Searching cities for:",D),O.searchCities(D).then(l=>{console.log(`‚úÖ [UkrPoshtaDelivery] Found ${l.length} cities:`,l),c(l)}).catch(l=>{console.error("‚ùå [UkrPoshtaDelivery] Error searching cities:",l),c([])})},300);return()=>clearTimeout(t)}else c([])},[D]),o.useEffect(()=>{if(a){const t=a.cityId,l=t?parseInt(t.toString(),10):null;if(!l||isNaN(l)){console.warn("‚ö†Ô∏è [UkrPoshtaDelivery] City does not have valid CITY_ID, trying to get it from API:",{cityName:a.name,cityId:t,id:a.id}),a.name?O.searchCities(a.name).then(N=>{const E=N.find(B=>B.name.toLowerCase()===a.name.toLowerCase()&&B.cityId&&!isNaN(parseInt(B.cityId.toString(),10)));if(E&&E.cityId){console.log("‚úÖ [UkrPoshtaDelivery] Found CITY_ID for city:",E);const B={...a,cityId:E.cityId};P(B),y(B),O.getBranches(E.cityId).then($=>{console.log(`‚úÖ [UkrPoshtaDelivery] Loaded ${$.length} branches for city ${E.cityId}`),n($)}).catch($=>{console.error("‚ùå [UkrPoshtaDelivery] Error loading branches:",$),n([])})}else console.error("‚ùå [UkrPoshtaDelivery] Could not find CITY_ID for city:",a.name),n([])}).catch(N=>{console.error("‚ùå [UkrPoshtaDelivery] Error searching for city:",N),n([])}):n([]);return}console.log("üîÑ [UkrPoshtaDelivery] Loading branches for city:",{cityId:l,cityName:a.name}),F(!1),L(""),c([]),g(!1),M(""),O.getBranches(l.toString()).then(N=>{console.log(`‚úÖ [UkrPoshtaDelivery] Loaded ${N.length} branches for city ${l}`),N.length>0&&console.log("üì¶ [UkrPoshtaDelivery] Sample branch:",N[0]),n(N)}).catch(N=>{console.error("‚ùå [UkrPoshtaDelivery] Error loading branches:",N),n([])})}},[a]),o.useEffect(()=>{if(R&&a&&(w.length===0||_)){const t=a.cityId,l=t?parseInt(t.toString(),10):null;if(!l||isNaN(l)){console.warn("‚ö†Ô∏è [UkrPoshtaDelivery] Cannot load branches: invalid CITY_ID"),n([]);return}console.log("üîÑ [UkrPoshtaDelivery] Loading branches on dropdown open"),O.getBranches(l.toString(),_||void 0).then(N=>{console.log(`‚úÖ [UkrPoshtaDelivery] Loaded ${N.length} branches on open`),n(N)}).catch(N=>{console.error("‚ùå [UkrPoshtaDelivery] Error loading branches on open:",N),n([])})}},[R]),o.useEffect(()=>{if(R&&a&&_.length>=2){const t=a.cityId,l=t?parseInt(t.toString(),10):null;if(!l||isNaN(l)){console.warn("‚ö†Ô∏è [UkrPoshtaDelivery] Cannot search branches: invalid CITY_ID"),n([]);return}const N=setTimeout(()=>{O.getBranches(l.toString(),_).then(E=>{console.log(`‚úÖ [UkrPoshtaDelivery] Search found ${E.length} branches`),n(E)}).catch(E=>{console.error("‚ùå [UkrPoshtaDelivery] Search error:",E),n([])})},300);return()=>clearTimeout(N)}},[_,R]);const s=async t=>{let l=t;const N=t.cityId?parseInt(t.cityId.toString(),10):null;!N||isNaN(N)?(console.warn(`‚ö†Ô∏è [UkrPoshtaDelivery] City "${t.name}" has no numeric CITY_ID. This should not happen for popular cities from DB.`),l={...t,displayName:ie(t)}):l={...t,id:t.cityId.toString(),cityId:t.cityId.toString(),displayName:ie(t)},P(l),j(null),y(l),I(null),F(!1),L("")},U=t=>{j(t),I(t),g(!1),M("")},q=D.length>=2?h:b,A=t=>!t.region||t.region.trim()===""?`${t.name} (*)`:`${t.name} (${t.region})`,ie=t=>A(t);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("fieldset",{className:"space-y-2",children:[e.jsxs("legend",{className:"flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{children:"–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:S("flex min-h-10 w-full items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm cursor-pointer","hover:border-primary transition-colors",!a&&"opacity-60"),onClick:()=>{F(!T),T||L("")},children:[e.jsx("span",{className:S("flex-1 break-words pr-2",a?"text-foreground":"text-muted-foreground"),children:a?A(a):"–í–∏–±–µ—Ä—ñ—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç"}),e.jsx(H,{className:S("h-4 w-4 transition-transform text-muted-foreground flex-shrink-0",T&&"rotate-180")})]}),T&&e.jsxs("div",{className:"border rounded-xl bg-background overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(W,{type:"text",placeholder:"–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É –≤—ñ–¥ 3-—Ö –±—É–∫–≤",value:D,onChange:t=>L(t.target.value),className:"pl-10",autoFocus:!0,onClick:t=>t.stopPropagation()})]})}),D.length<2&&b.length>0&&e.jsx("div",{className:"p-3 border-b",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:b.slice(0,5).map(t=>e.jsx("button",{type:"button",onClick:l=>{l.stopPropagation(),s(t)},className:"px-3 py-1.5 text-sm border rounded-lg",children:A(t)},t.id))})}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:q.length>0?e.jsx("div",{className:"p-2",children:q.map(t=>e.jsxs("button",{type:"button",onClick:l=>{l.stopPropagation(),s(t)},className:S("w-full flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer text-left",(a==null?void 0:a.id)===t.id&&"text-primary font-medium"),children:[(a==null?void 0:a.id)===t.id&&e.jsx(Z,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:S("flex-1",(a==null?void 0:a.id)===t.id&&"text-primary"),children:A(t)})]},t.id))}):D.length>=2?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"}):e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞"})})]})]})]}),a&&e.jsxs("fieldset",{className:"space-y-2",children:[e.jsxs("legend",{className:"flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{children:"–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:S("flex min-h-10 w-full items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm cursor-pointer","hover:border-primary transition-colors",!a&&"opacity-60"),onClick:()=>{g(!R),R||M("")},children:[e.jsx("span",{className:S("flex-1 break-words pr-2",f?"text-foreground":"text-muted-foreground"),children:f?`${f.name}, ${f.address}`:"–í–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è"}),e.jsx(H,{className:S("h-4 w-4 transition-transform text-muted-foreground flex-shrink-0",R&&"rotate-180")})]}),R&&e.jsxs("div",{className:"border rounded-xl bg-background overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(W,{type:"text",placeholder:"–í–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è",value:_,onChange:t=>M(t.target.value),className:"pl-10 rounded-xl",autoFocus:!0,onClick:t=>t.stopPropagation()})]})}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:w.length>0?e.jsx("ul",{className:"p-2 space-y-1",children:w.map(t=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:l=>{l.stopPropagation(),U(t)},className:S("w-full flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer text-left",(f==null?void 0:f.id)===t.id&&"text-primary font-medium"),children:[(f==null?void 0:f.id)===t.id&&e.jsx(Z,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsxs("span",{className:S("flex-1 text-sm",(f==null?void 0:f.id)===t.id&&"text-primary"),children:[t.name,", ",t.address]})]})},t.id))}):e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:_.length>=2?"–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ":"–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è..."})})]})]})]}),k&&m&&e.jsx("div",{className:"pt-4",children:e.jsx(ue,{type:"button",onClick:m,disabled:!a||!f,variant:"outline",className:"w-full rounded-xl border h-10 hover:border hover:bg-transparent hover:text-primary disabled:hover:text-primary disabled:opacity-50",children:"–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏"})})]})};export{wt as N,St as P,Fe as R,Pt as U,se as a};
