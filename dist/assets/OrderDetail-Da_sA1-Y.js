import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as h}from"./chunk-charts-BaLkbnPn.js";import{B as ae}from"./button-CthZnacx.js";import{B as Se}from"./badge-yFknLLV8.js";import{I as he}from"./input-BXec95Z_.js";import{S as ds,a as ms,b as hs,c as us,d as Te}from"./select-CJKqwBe4.js";import{a as Ns,b as gs}from"./useOrders-9c5eoxxb.js";import{Y as Me,Z as ps,A as Ps,q as bs,u as ks,z as Cs,w as ws}from"./index-D2NyTv7N.js";import{L as ce}from"./label-DKkqBypw.js";import{C as xs}from"./checkbox-CB3It4xW.js";import{P as te,R as ys,a as ve,N as Ss,U as Ts}from"./UkrPoshtaDelivery-DFKCL8uS.js";import{C as de}from"./circle-check-big-Dq7iXVST.js";import{N as Ue,U as ze,P as He,W as Ke,C as Ze,F as Qe}from"./PaymentLogos-5VRd8a-7.js";import{u as vs}from"./usePublicSettings-sqsT9GiJ.js";import{u as Ge}from"./useTexts-BcgqYQSt.js";import{D as _s,a as Os,b as Fs,c as Rs,d as Es}from"./dialog-BJyV5hg7.js";import{P as _e}from"./package-VKfECNuV.js";import{P as Ye,T as Is}from"./trash-2-DqmK1xeF.js";import{A as Ws}from"./arrow-left-C3yQphL3.js";import{C as As}from"./calendar-BKX0a5K4.js";import{M as $s}from"./minus-jy0A813U.js";import{C as Bs}from"./credit-card-BCWW2R-L.js";import"./index-D4-djExh.js";import"./Combination-DslA7HWg.js";import"./index-ZeZSZmiz.js";import"./chevron-down-BA2jWc8x.js";import"./chevron-up-ED3Hs5Sr.js";import"./check-DZm7sQsE.js";import"./circle-DbiJhrI6.js";import"./search-CUrwVdP1.js";import"./index-CMDvW82E.js";const Ls=({customer:o,recipient:u,onSave:H,onCancel:L,mode:x="view",defaultExpanded:D=!1,isCompleted:ne,onToggleExpanded:ie})=>{const[P,s]=h.useState(D||x==="edit"),[r,b]=h.useState({firstName:o.firstName||"",lastName:o.lastName||"",phone:o.phone||"",hasDifferentRecipient:!!u,recipientFirstName:(u==null?void 0:u.firstName)||"",recipientLastName:(u==null?void 0:u.lastName)||"",recipientPhone:(u==null?void 0:u.phone)||""}),V=m=>{const l=m.replace(/\D/g,"");return l.length===0?(q("Це обов'язкове поле"),!1):l.length<12||!l.startsWith("380")?(q("Некоректний номер"),!1):(q(""),!0)},k=m=>/^[а-яА-ЯіІїЇєЄґҐ\s-]+$/.test(m);h.useEffect(()=>{if(P||x==="edit"){let m=o.firstName||"",l=o.lastName||"";if(!m&&!l&&o.name){const I=o.name.trim().split(/\s+/);I.length>=2?(l=I[0],m=I.slice(1).join(" ")):I.length===1&&(l=I[0])}let C=(u==null?void 0:u.firstName)||"",z=(u==null?void 0:u.lastName)||"";if(u&&!C&&!z&&u.name){const I=u.name.trim().split(/\s+/);I.length>=2?(z=I[0],C=I.slice(1).join(" ")):I.length===1&&(z=I[0])}if(b({firstName:m,lastName:l,phone:o.phone||"",hasDifferentRecipient:!!u,recipientFirstName:C,recipientLastName:z,recipientPhone:(u==null?void 0:u.phone)||""}),P&&(o.phone&&(K(!0),V(o.phone)),l&&(n(!0),l.trim()===""?T("Це обов'язкове поле"):k(l)?T(""):T("Використовуйте тільки кириличні символи")),m&&($(!0),m.trim()===""?W("Це обов'язкове поле"):k(m)?W(""):W("Використовуйте тільки кириличні символи")),u)){if(u.phone){f(!0);const I=u.phone.replace(/\D/g,"");I.length===0?oe("Це обов'язкове поле"):I.length<12||!I.startsWith("380")?oe("Некоректний номер"):oe("")}z&&(N(!0),z.trim()===""?v("Це обов'язкове поле"):k(z)?v(""):v("Використовуйте тільки кириличні символи")),C&&(g(!0),C.trim()===""?E("Це обов'язкове поле"):k(C)?E(""):E("Використовуйте тільки кириличні символи"))}}},[o,u,P,x]);const[A,K]=h.useState(!1),[U,q]=h.useState(""),c=h.useRef(null),[R,n]=h.useState(!1),[j,T]=h.useState(""),[Y,$]=h.useState(!1),[Z,W]=h.useState(""),[F,f]=h.useState(!1),[G,oe]=h.useState(""),t=h.useRef(null),[i,N]=h.useState(!1),[y,v]=h.useState(""),[w,g]=h.useState(!1),[S,E]=h.useState(""),Oe=m=>{const l=m.target,C=l.selectionStart||0,z=l.value;let O=z.replace(/\D/g,"");if(O&&!O.startsWith("380")&&(O="380"+O),O=O.slice(0,12),O.length<=3){b(ee=>({...ee,phone:""})),A&&V("");return}const J="+"+O,re=z.slice(0,C).replace(/\D/g,"").length;let X=4;re>3&&(X=4+(re-3)),re>=O.length&&(X=J.length),b(ee=>({...ee,phone:J})),setTimeout(()=>{c.current&&c.current.setSelectionRange(X,X)},0),(A||J.length>4)&&V(J)},Fe=m=>{if(m.key==="Backspace"&&(m.currentTarget.selectionStart||0)<=4){m.preventDefault();return}if(m.key==="Delete"&&(m.currentTarget.selectionStart||0)<4){m.preventDefault();return}},Re=m=>{setTimeout(()=>{if(c.current){const l=r.phone===""?"+380":r.phone;l.length>4?c.current.setSelectionRange(l.length,l.length):c.current.setSelectionRange(4,4)}},0)},xe=m=>{(r.phone===""||r.phone==="+380")&&b(l=>({...l,phone:""})),K(!0),V(r.phone===""||r.phone==="+380"?"":r.phone)},Ee=m=>{const l=m.target.value;l===""||k(l)?(b(C=>({...C,lastName:l})),n(!0),l.trim()===""?T("Це обов'язкове поле"):T("")):(n(!0),T("Використовуйте тільки кириличні символи"))},Ie=m=>{const l=m.target.value;l===""||k(l)?(b(C=>({...C,firstName:l})),$(!0),l.trim()===""?W("Це обов'язкове поле"):W("")):($(!0),W("Використовуйте тільки кириличні символи"))},We=m=>{const l=m.target,C=l.selectionStart||0,z=l.value;let O=z.replace(/\D/g,"");if(O&&!O.startsWith("380")&&(O="380"+O),O=O.slice(0,12),O.length<=3){b(ee=>({...ee,recipientPhone:""})),F&&V("");return}const J="+"+O,re=z.slice(0,C).replace(/\D/g,"").length;let X=4;re>3&&(X=4+(re-3)),re>=O.length&&(X=J.length),b(ee=>({...ee,recipientPhone:J})),setTimeout(()=>{t.current&&t.current.setSelectionRange(X,X)},0),(F||J.length>4)&&V(J)},Ae=m=>{if(m.key==="Backspace"&&(m.currentTarget.selectionStart||0)<=4){m.preventDefault();return}if(m.key==="Delete"&&(m.currentTarget.selectionStart||0)<4){m.preventDefault();return}},$e=m=>{setTimeout(()=>{if(t.current){const l=r.recipientPhone===""?"+380":r.recipientPhone;l.length>4?t.current.setSelectionRange(l.length,l.length):t.current.setSelectionRange(4,4)}},0)},Be=m=>{(r.recipientPhone===""||r.recipientPhone==="+380")&&b(l=>({...l,recipientPhone:""})),f(!0),V(r.recipientPhone===""||r.recipientPhone==="+380"?"":r.recipientPhone)},Le=m=>{const l=m.target.value;l===""||k(l)?(b(C=>({...C,recipientLastName:l})),N(!0),l.trim()===""?v("Це обов'язкове поле"):v("")):(N(!0),v("Використовуйте тільки кириличні символи"))},ue=m=>{const l=m.target.value;l===""||k(l)?(b(C=>({...C,recipientFirstName:l})),g(!0),l.trim()===""?E("Це обов'язкове поле"):E("")):(g(!0),E("Використовуйте тільки кириличні символи"))},_=A&&!U&&r.phone&&r.phone.length>=12,ke=R&&!j&&r.lastName.trim()!=="",Ce=Y&&!Z&&r.firstName.trim()!=="",De=_&&ke&&Ce,pe=!r.hasDifferentRecipient||F&&!G&&r.recipientPhone&&r.recipientPhone.length>=12,we=!r.hasDifferentRecipient||i&&!y&&r.recipientLastName.trim()!=="",je=!r.hasDifferentRecipient||w&&!S&&r.recipientFirstName.trim()!=="",Ve=!r.hasDifferentRecipient||pe&&we&&je,me=De&&Ve,Ne=()=>{if(!me)return;const m={name:`${r.lastName} ${r.firstName}`,phone:r.phone,firstName:r.firstName,lastName:r.lastName},l=r.hasDifferentRecipient?{name:`${r.recipientLastName} ${r.recipientFirstName}`,phone:r.recipientPhone,firstName:r.recipientFirstName,lastName:r.recipientLastName}:void 0;H(m,l),x==="view"&&s(!1)};return x==="view"&&!P?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Замовник"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm",children:o.name}),e.jsx("button",{type:"button",onClick:()=>s(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm",children:o.phone})]}),u&&e.jsxs("div",{className:"space-y-1 pt-2 border-t",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Отримувач"}),e.jsx("div",{className:"text-sm",children:u.name}),e.jsx("div",{className:"text-sm",children:u.phone})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"phone",children:"Телефон *"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{ref:c,id:"phone",name:"phone",type:"tel",value:r.phone===""?"+380":r.phone,onChange:Oe,onKeyDown:Fe,onFocus:Re,onBlur:xe,placeholder:"+380",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${r.phone===""||r.phone==="+380"?"text-muted-foreground":""} ${A&&U?"border-red-500":""}`}),_&&e.jsx(de,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),A&&U&&e.jsx("p",{className:"text-sm text-red-500",children:U})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"lastName",children:"Прізвище *"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{id:"lastName",name:"lastName",value:r.lastName,onChange:Ee,onBlur:()=>{n(!0),r.lastName.trim()===""?T("Це обов'язкове поле"):k(r.lastName)?T(""):T("Використовуйте тільки кириличні символи")},placeholder:"Введіть прізвище кирилицею",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${R&&j?"border-red-500":""}`}),ke&&e.jsx(de,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),R&&j&&e.jsx("p",{className:"text-sm text-red-500",children:j})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"firstName",children:"Ім'я *"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{id:"firstName",name:"firstName",value:r.firstName,onChange:Ie,onBlur:()=>{$(!0),r.firstName.trim()===""?W("Це обов'язкове поле"):k(r.firstName)?W(""):W("Використовуйте тільки кириличні символи")},placeholder:"Введіть Ім'я кирилицею",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${Y&&Z?"border-red-500":""}`}),Ce&&e.jsx(de,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),Y&&Z&&e.jsx("p",{className:"text-sm text-red-500",children:Z})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(xs,{id:"hasDifferentRecipient",checked:r.hasDifferentRecipient,onCheckedChange:m=>{b(l=>({...l,hasDifferentRecipient:m,...m?{}:{recipientFirstName:"",recipientLastName:"",recipientPhone:""}})),m||(g(!1),E(""),N(!1),v(""),f(!1),oe(""))}}),e.jsx(ce,{htmlFor:"hasDifferentRecipient",className:"text-sm font-normal cursor-pointer flex items-center gap-1",children:"Інший отримувач замовлення"})]}),r.hasDifferentRecipient&&e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"recipientPhone",children:"Номер телефону отримувача *"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{ref:t,id:"recipientPhone",name:"recipientPhone",type:"tel",value:r.recipientPhone===""?"+380":r.recipientPhone,onChange:We,onKeyDown:Ae,onFocus:$e,onBlur:Be,placeholder:"+380",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${r.recipientPhone===""||r.recipientPhone==="+380"?"text-muted-foreground":""} ${F&&G?"border-red-500":""}`}),pe&&e.jsx(de,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),F&&G&&e.jsx("p",{className:"text-sm text-red-500",children:G})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"recipientLastName",children:"Прізвище отримувача *"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{id:"recipientLastName",name:"recipientLastName",value:r.recipientLastName,onChange:Le,onBlur:()=>{N(!0),r.recipientLastName.trim()===""?v("Це обов'язкове поле"):k(r.recipientLastName)?v(""):v("Використовуйте тільки кириличні символи")},placeholder:"Введіть прізвище кирилицею",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${i&&y?"border-red-500":""}`}),we&&e.jsx(de,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),i&&y&&e.jsx("p",{className:"text-sm text-red-500",children:y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"recipientFirstName",children:"Ім'я отримувача *"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{id:"recipientFirstName",name:"recipientFirstName",value:r.recipientFirstName,onChange:ue,onBlur:()=>{g(!0),r.recipientFirstName.trim()===""?E("Це обов'язкове поле"):k(r.recipientFirstName)?E(""):E("Використовуйте тільки кириличні символи")},placeholder:"Введіть Ім'я кирилицею",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${w&&S?"border-red-500":""}`}),je&&e.jsx(de,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),w&&S&&e.jsx("p",{className:"text-sm text-red-500",children:S})]})]}),e.jsx(ae,{type:"button",variant:"outline",disabled:!me,onClick:Ne,className:"w-full rounded-xl",children:"Продовжити"})]})},Ds=({delivery:o,onSave:u,onCancel:H,mode:L="view",defaultExpanded:x=!1,orderTotal:D=0,isCompleted:ne,onToggleExpanded:ie,onValidationChange:P})=>{var W,F,f,G,oe;const{data:s={}}=vs(),{data:r}=Ge(),b=Array.isArray(r)?r:[],V=((W=b.find(t=>t.key==="checkout.delivery.nova_poshta.title"))==null?void 0:W.value)||"Нова Пошта",k=((F=b.find(t=>t.key==="checkout.delivery.nova_poshta.description"))==null?void 0:F.value)||"1-2 дні по Україні",A=((f=b.find(t=>t.key==="checkout.delivery.ukrposhta.title"))==null?void 0:f.value)||"Укрпошта",K=((G=b.find(t=>t.key==="checkout.delivery.ukrposhta.description"))==null?void 0:G.value)||"3-5 днів по Україні",U=((oe=b.find(t=>t.key==="checkout.delivery.pickup.title"))==null?void 0:oe.value)||"Самовивіз",q=typeof s.free_delivery_threshold=="number"?s.free_delivery_threshold:parseInt(String(s.free_delivery_threshold||"1500"))||1500,[c,R]=h.useState(x||L==="edit"),[n,j]=h.useState(()=>{const t=o.method,i=t==="ukrposhta"?"ukr_poshta":t;if(i==="nova_poshta"){const N=!!o.city,y=!!o.warehouse;o.cityRef,o.warehouseRef;const v=N&&y,w="PostOffice",g=o.warehouse||"";return{method:i,novaPoshtaCity:o.city||"",novaPoshtaCityRef:o.cityRef||null,novaPoshtaPostOfficeWarehouse:g,novaPoshtaPostOfficeWarehouseRef:o.warehouseRef||null,novaPoshtaPostOfficeCompleted:v,novaPoshtaPostomatWarehouse:"",novaPoshtaPostomatWarehouseRef:null,novaPoshtaPostomatCompleted:!1,novaPoshtaDeliveryType:w,novaPoshtaExpanded:v&&(x||L==="edit")}}else if(i==="ukr_poshta"){const N=!!o.city,y=!!o.warehouse;o.cityRef,o.warehouseRef;const v=N&&y;let w="",g=o.city||"";if(g.includes("(")&&g.includes(")")){const S=g.match(/^(.+?)\s*\((.+?)\)$/);S&&(g=S[1].trim(),w=S[2].trim())}return{method:i,ukrPoshtaCity:o.city||"",ukrPoshtaCityId:o.cityRef||null,ukrPoshtaCityRegion:w,ukrPoshtaBranch:o.warehouse||"",ukrPoshtaBranchId:o.warehouseRef||null,ukrPoshtaPostalCode:o.postIndex||"",ukrPoshtaAddress:o.address||"",ukrPoshtaCompleted:v,ukrPoshtaExpanded:v&&(x||L==="edit")}}return{method:i}}),T=t=>{if(t==="nova_poshta"){const i=n.novaPoshtaDeliveryType==="PostOffice"?n.novaPoshtaPostOfficeWarehouse:n.novaPoshtaPostomatWarehouse,N=n.novaPoshtaDeliveryType==="PostOffice"?n.novaPoshtaPostOfficeCompleted:n.novaPoshtaPostomatCompleted;return{city:n.novaPoshtaCity,warehouse:i,completed:N}}else if(t==="ukr_poshta"||t==="ukrposhta")return{city:n.ukrPoshtaCity,cityRegion:n.ukrPoshtaCityRegion,branch:n.ukrPoshtaBranch,postalCode:n.ukrPoshtaPostalCode,address:n.ukrPoshtaAddress,completed:n.ukrPoshtaCompleted};return null},Y=["95dc212d-479c-4ffb-a8ab-8c1b9073d0bc","f9316480-5f2d-425d-bc2c-ac7cd29decf0"];h.useEffect(()=>{n.method==="nova_poshta"&&o.warehouseRef&&L==="edit"&&Me.getWarehouse(o.warehouseRef).then(t=>{const i=t.type_of_warehouse,y=Y.includes(i)?"Postomat":"PostOffice",v=o.warehouse||"";j(w=>y==="PostOffice"?{...w,novaPoshtaDeliveryType:"PostOffice",novaPoshtaPostOfficeWarehouse:v,novaPoshtaPostOfficeWarehouseRef:o.warehouseRef,novaPoshtaPostOfficeCompleted:!!(o.city&&o.warehouse),novaPoshtaPostomatWarehouse:"",novaPoshtaPostomatWarehouseRef:null,novaPoshtaPostomatCompleted:!1}:{...w,novaPoshtaDeliveryType:"Postomat",novaPoshtaPostomatWarehouse:v,novaPoshtaPostomatWarehouseRef:o.warehouseRef,novaPoshtaPostomatCompleted:!!(o.city&&o.warehouse),novaPoshtaPostOfficeWarehouse:"",novaPoshtaPostOfficeWarehouseRef:null,novaPoshtaPostOfficeCompleted:!1})}).catch(t=>{console.error("[DeliveryForm] Error loading warehouse type:",t)})},[n.method,o.warehouseRef,L]),h.useEffect(()=>{if(n.method==="nova_poshta"&&n.novaPoshtaCity&&!n.novaPoshtaCityRef&&c&&L==="edit"){const t=n.novaPoshtaCity.trim();Me.searchCities(t).then(i=>{const N=i.find(y=>y.full_description_ua===t||y.description_ua===t||y.full_description_ua.includes(t)||t.includes(y.description_ua))||i[0];if(N){j(v=>({...v,novaPoshtaCityRef:N.ref,novaPoshtaCity:N.full_description_ua}));const y=n.novaPoshtaPostOfficeWarehouse||n.novaPoshtaPostomatWarehouse;if(y&&N.ref){const v=n.novaPoshtaDeliveryType||"PostOffice";Me.getWarehouses(N.ref,v).then(w=>{const g=w.find(S=>S.description_ua===y||S.description_ua.includes(y)||y.includes(S.description_ua))||w[0];g&&j(S=>v==="PostOffice"?{...S,novaPoshtaPostOfficeWarehouseRef:g.ref,novaPoshtaPostOfficeWarehouse:g.description_ua}:{...S,novaPoshtaPostomatWarehouseRef:g.ref,novaPoshtaPostomatWarehouse:g.description_ua})}).catch(console.error)}}}).catch(console.error)}},[n.method,n.novaPoshtaCity,n.novaPoshtaCityRef,n.novaPoshtaPostOfficeWarehouse,n.novaPoshtaPostomatWarehouse,n.novaPoshtaDeliveryType,c]),h.useEffect(()=>{if(n.method==="ukr_poshta"&&n.ukrPoshtaCity&&!n.ukrPoshtaCityId&&c&&L==="edit"){const i=n.ukrPoshtaCity.trim().replace(/\s*\([^)]*\)\s*$/,"").trim();ps.searchCities(i).then(N=>{const y=N.find(v=>v.name===i||v.name.includes(i)||i.includes(v.name))||N[0];if(y){const v=y.region&&y.region.trim()!==""?`${y.name} (${y.region})`:`${y.name} (*)`;j(w=>({...w,ukrPoshtaCityId:y.id,ukrPoshtaCity:v,ukrPoshtaCityRegion:y.region||""})),n.ukrPoshtaBranch&&y.id&&ps.getBranches(y.id).then(w=>{const g=n.ukrPoshtaBranch.trim(),S=w.find(E=>E.name===g||E.name.includes(g)||g.includes(E.name))||w[0];S&&j(E=>({...E,ukrPoshtaBranchId:S.id,ukrPoshtaBranch:S.name,ukrPoshtaPostalCode:S.postalCode||E.ukrPoshtaPostalCode,ukrPoshtaAddress:S.address||E.ukrPoshtaAddress}))}).catch(console.error)}}).catch(console.error)}},[n.method,n.ukrPoshtaCity,n.ukrPoshtaCityId,n.ukrPoshtaBranch,c]),h.useEffect(()=>{c&&(n.method==="nova_poshta"&&n.novaPoshtaExpanded===!1?j(t=>({...t,novaPoshtaExpanded:!0})):n.method==="ukr_poshta"&&n.ukrPoshtaExpanded===!1&&j(t=>({...t,ukrPoshtaExpanded:!0})))},[c,n.method,n.novaPoshtaExpanded,n.ukrPoshtaExpanded]);const $=()=>n.method==="pickup"?!0:n.method==="nova_poshta"?(n.novaPoshtaDeliveryType==="PostOffice"?n.novaPoshtaPostOfficeCompleted:n.novaPoshtaPostomatCompleted)||!1:n.method==="ukr_poshta"&&n.ukrPoshtaCompleted||!1;h.useEffect(()=>{P&&P($())},[n.method,n.novaPoshtaDeliveryType,n.novaPoshtaPostOfficeCompleted,n.novaPoshtaPostomatCompleted,n.ukrPoshtaCompleted,P]);const Z=()=>{if(!$())return;let t={method:n.method};n.method==="nova_poshta"?(t.city=n.novaPoshtaCity||"",t.cityRef=n.novaPoshtaCityRef||null,t.warehouse=n.novaPoshtaDeliveryType==="PostOffice"?n.novaPoshtaPostOfficeWarehouse||"":n.novaPoshtaPostomatWarehouse||"",t.warehouseRef=n.novaPoshtaDeliveryType==="PostOffice"?n.novaPoshtaPostOfficeWarehouseRef||null:n.novaPoshtaPostomatWarehouseRef||null):n.method==="ukr_poshta"&&(t.method="ukrposhta",t.city=n.ukrPoshtaCity||"",t.cityRef=n.ukrPoshtaCityId?String(n.ukrPoshtaCityId):null,t.warehouse=n.ukrPoshtaBranch||"",t.warehouseRef=n.ukrPoshtaBranchId?String(n.ukrPoshtaBranchId):null,t.postIndex=n.ukrPoshtaPostalCode||"",t.address=n.ukrPoshtaAddress||""),u(t),L==="view"&&R(!1),n.method==="nova_poshta"?j(i=>({...i,novaPoshtaExpanded:!1})):n.method==="ukr_poshta"&&j(i=>({...i,ukrPoshtaExpanded:!1}))};return L==="view"&&!c?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[o.method==="nova_poshta"&&e.jsx(Ue,{className:"w-5 h-5"}),o.method==="ukrposhta"&&e.jsx(ze,{className:"w-5 h-5"}),o.method==="pickup"&&e.jsx(He,{className:"w-5 h-5"}),o.method==="nova_poshta"&&V,o.method==="ukrposhta"&&A,o.method==="pickup"&&U]}),e.jsx("button",{type:"button",onClick:()=>R(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),o.city&&e.jsxs("div",{className:"text-sm",children:["м. ",o.city]}),o.warehouse&&e.jsx("div",{className:"text-sm",children:o.warehouse}),o.address&&e.jsx("div",{className:"text-sm",children:o.address}),o.postIndex&&e.jsxs("div",{className:"text-sm",children:["Індекс: ",o.postIndex]}),o.method==="pickup"&&e.jsx("div",{className:"text-sm",children:s.store_address||"м. Київ, вул. Урлівська 30"})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs(ys,{value:n.method,onValueChange:t=>{j(i=>i.method===t&&t==="nova_poshta"&&i.novaPoshtaExpanded===!1?{...i,novaPoshtaExpanded:!0}:i.method===t&&t==="ukr_poshta"&&i.ukrPoshtaExpanded===!1?{...i,ukrPoshtaExpanded:!0}:t==="pickup"?{...i,method:t,novaPoshtaExpanded:void 0,ukrPoshtaExpanded:void 0}:{...i,method:t,novaPoshtaExpanded:t==="nova_poshta"?!0:void 0,ukrPoshtaExpanded:t==="ukr_poshta"?!0:void 0,...t==="nova_poshta"?{novaPoshtaDeliveryType:i.novaPoshtaDeliveryType||"PostOffice"}:{}})},className:"space-y-3",children:[e.jsxs("div",{className:"border rounded-xl transition-all",onClick:t=>{n.method==="nova_poshta"&&n.novaPoshtaExpanded===!1&&(t.stopPropagation(),j(i=>({...i,novaPoshtaExpanded:!0})))},children:[e.jsxs("label",{className:"flex flex-col gap-2 p-4 cursor-pointer hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{value:"nova_poshta",id:"nova_poshta"}),e.jsxs("div",{className:"font-medium flex items-center gap-2 flex-1",children:[e.jsx(Ue,{className:"w-5 h-5"}),V]}),e.jsx("div",{className:"text-sm font-medium",children:D>=q?e.jsx("span",{className:"text-green-600",children:"Безкоштовно"}):"від 60 ₴"})]}),e.jsx("div",{className:"ml-[28px]",children:(()=>{const t=T("nova_poshta"),N=n.method==="nova_poshta"&&n.novaPoshtaExpanded===!1&&(t==null?void 0:t.completed)&&t.city&&t.warehouse,y=n.method!=="nova_poshta"&&(t==null?void 0:t.completed)&&t.city&&t.warehouse;return N||y?e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("div",{className:"text-foreground",children:t.city}),e.jsx("div",{className:"text-foreground",children:t.warehouse})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:k})})()})]}),n.method==="nova_poshta"&&n.novaPoshtaExpanded!==!1&&e.jsx("div",{className:"pl-4 pr-4 pb-4",children:e.jsx(Ss,{cityRef:n.novaPoshtaCityRef,warehouseRef:n.novaPoshtaDeliveryType==="PostOffice"?n.novaPoshtaPostOfficeWarehouseRef:n.novaPoshtaPostomatWarehouseRef,deliveryType:n.novaPoshtaDeliveryType||"PostOffice",isExpanded:!0,onCityChange:t=>{j(i=>({...i,novaPoshtaCity:t?t.full_description_ua:"",novaPoshtaCityRef:t?t.ref:null,novaPoshtaPostOfficeWarehouse:"",novaPoshtaPostOfficeWarehouseRef:null,novaPoshtaPostOfficeCompleted:!1,novaPoshtaPostomatWarehouse:"",novaPoshtaPostomatWarehouseRef:null,novaPoshtaPostomatCompleted:!1}))},onWarehouseChange:t=>{j(i=>i.novaPoshtaDeliveryType==="PostOffice"?{...i,novaPoshtaPostOfficeWarehouse:t?t.description_ua:"",novaPoshtaPostOfficeWarehouseRef:t?t.ref:null,novaPoshtaPostOfficeCompleted:!!t}:{...i,novaPoshtaPostomatWarehouse:t?t.description_ua:"",novaPoshtaPostomatWarehouseRef:t?t.ref:null,novaPoshtaPostomatCompleted:!!t})},onDeliveryTypeChange:t=>{j(i=>t==="PostOffice"?{...i,novaPoshtaDeliveryType:t,novaPoshtaPostOfficeCompleted:!!i.novaPoshtaPostOfficeWarehouseRef}:{...i,novaPoshtaDeliveryType:t,novaPoshtaPostomatCompleted:!!i.novaPoshtaPostomatWarehouseRef})},onContinue:()=>{j(t=>({...t,novaPoshtaExpanded:!1,...t.novaPoshtaDeliveryType==="PostOffice"?{novaPoshtaPostOfficeCompleted:!0}:{novaPoshtaPostomatCompleted:!0}})),Z()}})})]}),e.jsxs("div",{className:"border rounded-xl transition-all",onClick:t=>{n.method==="ukr_poshta"&&n.ukrPoshtaExpanded===!1&&(t.stopPropagation(),j(i=>({...i,ukrPoshtaExpanded:!0})))},children:[e.jsxs("label",{className:"flex flex-col gap-2 p-4 cursor-pointer hover:border-primary transition-colors w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{value:"ukr_poshta",id:"ukr_poshta"}),e.jsxs("div",{className:"font-medium flex items-center gap-2 flex-1",children:[e.jsx(ze,{className:"w-5 h-5"}),A]}),e.jsx("div",{className:"text-sm font-medium",children:D>=q?e.jsx("span",{className:"text-green-600",children:"Безкоштовно"}):"від 45 грн"})]}),e.jsx("div",{className:"ml-[28px] w-full",children:(()=>{const t=T("ukr_poshta"),N=n.method==="ukr_poshta"&&n.ukrPoshtaExpanded===!1&&(t==null?void 0:t.completed)&&t.city,y=n.method!=="ukr_poshta"&&(t==null?void 0:t.completed)&&t.city;if(N||y){const v=t.city||(t.cityRegion?`${t.city} (${t.cityRegion})`:t.city),w=t.cityRegion?t.city.replace(` (${t.cityRegion})`,""):t.city,g=t.postalCode&&t.address?`${t.postalCode} ${w}, ${t.address}`:t.branch||"";return e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("div",{className:"text-foreground",children:v}),g&&e.jsx("div",{className:"text-foreground",children:g})]})}return e.jsx("div",{className:"text-sm text-muted-foreground",children:K})})()})]}),n.method==="ukr_poshta"&&n.ukrPoshtaExpanded!==!1&&e.jsx("div",{className:"pl-4 pr-4 pb-4",children:e.jsx(Ts,{cityId:n.ukrPoshtaCityId,branchId:n.ukrPoshtaBranchId,savedCityName:n.ukrPoshtaCity,savedCityRegion:n.ukrPoshtaCityRegion,savedBranchName:n.ukrPoshtaBranch,savedBranchAddress:n.ukrPoshtaAddress,savedBranchPostalCode:n.ukrPoshtaPostalCode,isExpanded:!0,onCityChange:t=>{const i=t?t.region&&t.region.trim()!==""?`${t.name} (${t.region})`:`${t.name} (*)`:"";j(N=>({...N,ukrPoshtaCity:i,ukrPoshtaCityId:t?t.id:null,ukrPoshtaCityRegion:t&&t.region||"",ukrPoshtaBranch:"",ukrPoshtaBranchId:null,ukrPoshtaPostalCode:"",ukrPoshtaAddress:"",ukrPoshtaCompleted:!1}))},onBranchChange:t=>{j(i=>({...i,ukrPoshtaBranch:t?t.name:"",ukrPoshtaBranchId:t?t.id:null,ukrPoshtaPostalCode:t?t.postalCode:"",ukrPoshtaAddress:t?t.address:"",ukrPoshtaCompleted:!!t}))},onContinue:()=>{j(t=>({...t,ukrPoshtaExpanded:!1,ukrPoshtaCompleted:!0})),Z()}})})]}),e.jsx("div",{className:"border rounded-xl transition-all",children:e.jsxs("label",{className:"flex flex-col gap-2 p-4 cursor-pointer hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{value:"pickup",id:"pickup"}),e.jsxs("div",{className:"font-medium flex items-center gap-2 flex-1",children:[e.jsx(He,{className:"w-5 h-5"}),U]}),e.jsx("div",{className:"text-sm font-medium",children:e.jsx("span",{className:"text-green-600",children:"Безкоштовно"})})]}),e.jsx("div",{className:"ml-[28px]",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:s.store_address||"м. Київ, вул. Урлівська 30"})})]})})]})})},Vs=({payment:o,deliveryMethod:u,onSave:H,onCancel:L,mode:x="view",defaultExpanded:D=!1,isCompleted:ne,onToggleExpanded:ie})=>{var Y,$,Z,W,F;const{data:P}=Ge(),s=Array.isArray(P)?P:[],r=((Y=s.find(f=>f.key==="checkout.payment.wayforpay.title"))==null?void 0:Y.value)||"Онлайн оплата",b=(($=s.find(f=>f.key==="checkout.payment.wayforpay.description"))==null?void 0:$.value)||"Безпечна оплата карткою через WayForPay",V=((Z=s.find(f=>f.key==="checkout.payment.nalojka.title"))==null?void 0:Z.value)||"Оплата при отриманні",k=((W=s.find(f=>f.key==="checkout.payment.fop.title"))==null?void 0:W.value)||"Оплата на рахунок ФОП",A=((F=s.find(f=>f.key==="checkout.payment.fop.description"))==null?void 0:F.value)||"Оплата на банківський рахунок ФОП",K=()=>{var f;return u==="nova_poshta"?"Післяплата (комісія 2% + 20 грн)":u==="ukrposhta"?"Післяплата (комісія 2% + 15 грн)":u==="pickup"?"Оплата готівкою при отриманні замовлення":((f=s.find(G=>G.key==="checkout.payment.nalojka.description"))==null?void 0:f.value)||"Оплата при отриманні (+20 грн комісія)"},[U,q]=h.useState(D||x==="edit"),[c,R]=h.useState(o.method),n=f=>f==="wayforpay"?r:f==="nalojka"?V:f==="fopiban"?k:"",j=f=>f==="wayforpay"?b:f==="nalojka"?K():f==="fopiban"?A:"",T=f=>f==="wayforpay"?e.jsx(Ke,{className:"w-5 h-5"}):f==="nalojka"?e.jsx(Ze,{className:"w-5 h-5"}):f==="fopiban"?e.jsx(Qe,{className:"w-5 h-5"}):null;return x==="view"&&!U?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[T(o.method),n(o.method)]}),e.jsx("button",{type:"button",onClick:()=>q(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:j(o.method)})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs(ys,{value:c,onValueChange:f=>{if(R(f),f){const G={method:f,status:o.status,paidAmount:o.paidAmount};H(G),x==="view"&&q(!1)}},className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 p-4 border rounded-xl cursor-pointer hover:border-primary transition-colors",children:[e.jsx(ve,{value:"wayforpay",id:"wayforpay"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5"}),r]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:b})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-4 border rounded-xl cursor-pointer hover:border-primary transition-colors",children:[e.jsx(ve,{value:"nalojka",id:"nalojka"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5"}),V]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:K()})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-4 border rounded-xl cursor-pointer hover:border-primary transition-colors",children:[e.jsx(ve,{value:"fopiban",id:"fopiban"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5"}),k]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:A})]})]})]})})};function qs({isOpen:o,onClose:u,onAdd:H,products:L}){const[x,D]=h.useState(null),[ne,ie]=h.useState([]),[P,s]=h.useState(1),r=c=>{D(c),ie([]),s(1)},b=c=>{ie(R=>R.includes(c)?R.filter(n=>n!==c):[...R,c])},V=()=>{x&&(H(x.code,P,ne),k())},k=()=>{D(null),ie([]),s(1),u()},A=(x==null?void 0:x.options)||[],K=ne.reduce((c,R)=>{const n=A.find(j=>j.code===R);return c+((n==null?void 0:n.price)||0)},0),U=x?x.salePrice||x.basePrice:0,q=(U+K)*P;return e.jsx(_s,{open:o,onOpenChange:k,children:e.jsxs(Os,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Fs,{children:e.jsx(Rs,{children:"Додати товар до замовлення"})}),e.jsx("div",{className:"space-y-6 py-4",children:x?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 border rounded-lg bg-muted/50",children:[e.jsx("div",{className:"flex-shrink-0",children:x.images&&x.images.length>0?e.jsx("img",{src:x.images[0],alt:x.name,className:"w-16 h-16 object-cover rounded"}):e.jsx("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center",children:e.jsx(_e,{className:"h-8 w-8 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:x.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Артикул: ",x.code]}),e.jsx("div",{className:"text-sm font-semibold mt-1",children:x.salePrice?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-primary",children:[x.salePrice," ₴"]}),e.jsxs("span",{className:"text-muted-foreground line-through ml-2",children:[x.basePrice," ₴"]})]}):e.jsxs("span",{children:[x.basePrice," ₴"]})})]}),e.jsx(ae,{variant:"ghost",size:"sm",onClick:()=>D(null),children:"Змінити"})]}),A.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(ce,{children:"Додаткові опції"}),e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:A.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:border-orange-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(xs,{id:`option-${c.code}`,checked:ne.includes(c.code),onCheckedChange:()=>b(c.code)}),e.jsxs("label",{htmlFor:`option-${c.code}`,className:"flex-1 cursor-pointer",children:[e.jsx("div",{className:"font-medium",children:c.name}),c.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:c.description})]})]}),e.jsxs("div",{className:"font-semibold text-primary ml-4",children:["+",c.price," ₴"]})]},c.code))})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-primary/5",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Всього:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:[q.toFixed(0)," ₴"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Товар: ",U," ₴ × ",P," ="," ",(U*P).toFixed(0)," ₴",e.jsx("br",{}),"Опції: +",K.toFixed(0)," ₴"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{children:"Оберіть товар"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-[400px] overflow-y-auto",children:L.map(c=>e.jsxs("button",{onClick:()=>r(c),className:"flex items-center gap-4 p-4 border rounded-lg hover:border-orange-500 transition-colors text-left",children:[e.jsx("div",{className:"flex-shrink-0",children:c.images&&c.images.length>0?e.jsx("img",{src:c.images[0],alt:c.name,className:"w-16 h-16 object-cover rounded"}):e.jsx("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center",children:e.jsx(_e,{className:"h-8 w-8 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:c.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Артикул: ",c.code]}),e.jsx("div",{className:"text-sm font-semibold mt-1",children:c.salePrice?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-primary",children:[c.salePrice," ₴"]}),e.jsxs("span",{className:"text-muted-foreground line-through ml-2",children:[c.basePrice," ₴"]})]}):e.jsxs("span",{children:[c.basePrice," ₴"]})}),c.stock!==void 0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Остаток: ",c.stock]})]})]},c.id))})]})}),e.jsxs(Es,{children:[e.jsx(ae,{variant:"outline",onClick:k,children:"Скасувати"}),x&&e.jsxs(ae,{onClick:V,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Додати до замовлення"]})]})]})})}const fs={created:"Замовлення оформлено",accepted:"Прийнято",paid:"Оплачено",packed:"Спаковано",shipped:"Відправлено",arrived:"Прибуло",completed:"Залишити відгук",processing:"В обробці",assembled:"Зібрано",in_transit:"В дорозі"},Ms={created:"bg-blue-100 text-blue-800",accepted:"bg-purple-100 text-purple-800",paid:"bg-green-100 text-green-800",packed:"bg-teal-100 text-teal-800",shipped:"bg-indigo-100 text-indigo-800",arrived:"bg-emerald-100 text-emerald-800",completed:"bg-gray-100 text-gray-800",processing:"bg-yellow-100 text-yellow-800",assembled:"bg-cyan-100 text-cyan-800",in_transit:"bg-violet-100 text-violet-800"},Us=["accepted","paid","packed","shipped","arrived","completed"],zs=o=>{const u=typeof o=="string"?new Date(o):o,H=String(u.getHours()).padStart(2,"0"),L=String(u.getMinutes()).padStart(2,"0"),x=String(u.getDate()).padStart(2,"0"),D=String(u.getMonth()+1).padStart(2,"0"),ne=u.getFullYear();return`${H}:${L}, ${x}.${D}.${ne}`};function bt(){var m,l,C,z,I,O,J,re,X,ee,Je,Xe,es,ss,ts,as,ns,os,rs,is,ls,cs;const{id:o}=Ps(),u=bs(),{data:H=[]}=ks(),L=Ns(),x=gs(),{toast:D}=Cs(),{data:ne={}}=vs(),{data:ie}=Ge(),P=Array.isArray(ie)?ie:[],[s,r]=h.useState(null),[b,V]=h.useState(!0),[k,A]=h.useState(""),[K,U]=h.useState("not_paid"),[q,c]=h.useState(""),[R,n]=h.useState(!1),[j,T]=h.useState(!1),[Y,$]=h.useState(!1),[Z,W]=h.useState(!1),[F,f]=h.useState([]),[G,oe]=h.useState(!1),[t,i]=h.useState(null),[N,y]=h.useState(!1),v=((m=P.find(a=>a.key==="checkout.delivery.nova_poshta.title"))==null?void 0:m.value)||"Нова Пошта",w=((l=P.find(a=>a.key==="checkout.delivery.ukrposhta.title"))==null?void 0:l.value)||"Укрпошта",g=((C=P.find(a=>a.key==="checkout.delivery.pickup.title"))==null?void 0:C.value)||"Самовивіз",S=((z=P.find(a=>a.key==="checkout.payment.wayforpay.title"))==null?void 0:z.value)||"Онлайн оплата",E=((I=P.find(a=>a.key==="checkout.payment.wayforpay.description"))==null?void 0:I.value)||"Безпечна оплата карткою через WayForPay",Oe=((O=P.find(a=>a.key==="checkout.payment.nalojka.title"))==null?void 0:O.value)||"Оплата при отриманні",Fe=((J=P.find(a=>a.key==="checkout.payment.fop.title"))==null?void 0:J.value)||"Оплата на рахунок ФОП",Re=((re=P.find(a=>a.key==="checkout.payment.fop.description"))==null?void 0:re.value)||"Оплата на банківський рахунок ФОП",xe=a=>/^[а-яА-ЯіІїЇєЄґҐ\s-]+$/.test(a);h.useEffect(()=>{o&&ws.getOrder(o).then(a=>{var p,d,M;if(console.log("[OrderDetail] Order data received:",a),console.log("[OrderDetail] Analytics data:",a.analytics),console.log("[OrderDetail] Has analytics:",!!a.analytics),console.log("[OrderDetail] Analytics keys:",a.analytics?Object.keys(a.analytics):"none"),r(a),f(a.items.map((B,Q)=>({...B,id:B.id||`item_${Q}_${Date.now()}`}))),A(a.deliveryTtn||""),U(((p=a.payment)==null?void 0:p.status)||"not_paid"),c(((M=(d=a.payment)==null?void 0:d.paidAmount)==null?void 0:M.toString())||""),a.delivery)if(a.delivery.method==="pickup")i(!0);else if(a.delivery.method==="nova_poshta"){const B=!!(a.delivery.city&&a.delivery.cityRef),Q=!!(a.delivery.warehouse&&a.delivery.warehouseRef);i(B&&Q)}else if(a.delivery.method==="ukrposhta"){const B=!!(a.delivery.city&&a.delivery.cityRef),Q=!!(a.delivery.warehouse&&a.delivery.warehouseRef);i(B&&Q)}else i(!1)}).catch(a=>{console.error("[OrderDetail] Error loading order:",a)}).finally(()=>V(!1))},[o]);const Ee=(X=s==null?void 0:s.customer)!=null&&X.phone?(s.customer.phone===""||s.customer.phone==="+380"?"":s.customer.phone).replace(/\D/g,"").length===12&&(s.customer.phone===""||s.customer.phone==="+380"?"":s.customer.phone).replace(/\D/g,"").startsWith("380"):!1,Ie=(ee=s==null?void 0:s.customer)!=null&&ee.lastName?s.customer.lastName.trim()!==""&&xe(s.customer.lastName):!1,We=(Je=s==null?void 0:s.customer)!=null&&Je.firstName?s.customer.firstName.trim()!==""&&xe(s.customer.firstName):!1,Ae=!(s!=null&&s.recipient)||(s.recipient.phone===""||s.recipient.phone==="+380"?"":s.recipient.phone).replace(/\D/g,"").length===12&&(s.recipient.phone===""||s.recipient.phone==="+380"?"":s.recipient.phone).replace(/\D/g,"").startsWith("380"),$e=!(s!=null&&s.recipient)||s.recipient.lastName.trim()!==""&&xe(s.recipient.lastName),Be=!(s!=null&&s.recipient)||s.recipient.firstName.trim()!==""&&xe(s.recipient.firstName),Le=!(s!=null&&s.recipient)||Ae&&$e&&Be,ue=Ee&&Ie&&We&&Le;h.useEffect(()=>{ue&&(y(!0),R||n(!1))},[ue]);const _=h.useMemo(()=>{if(!s||F.length===0)return null;let a=0,p=0;F.forEach(B=>{const Q=H.find(be=>be.code===B.productId);if(!Q)return;const ye=Q.basePrice||0,ge=Q.salePrice,Pe=B.selectedOptions.reduce((be,se)=>{const le=Q.options.find(fe=>fe.code===se);return be+((le==null?void 0:le.price)||0)},0),qe=(ye+Pe)*B.quantity;a+=qe,ge&&ge<ye&&(p+=(ye-ge)*B.quantity)});const d=s.deliveryCost||0,M=a-p+d;return{subtotal:a,discount:p,deliveryCost:d,total:M}},[s,F,H]),ke=a=>{s&&L.mutate({id:s.id,status:a},{onSuccess:()=>{r(p=>p?{...p,status:a,updatedAt:new Date}:null)}})},Ce=()=>{s&&x.mutate({id:s.id,data:{customer:s.customer,delivery:s.delivery,payment:s.payment,status:s.status,subtotal:s.subtotal,discount:s.discount,deliveryCost:s.deliveryCost,total:s.total,deliveryTtn:k||void 0}},{onSuccess:()=>{r(a=>a?{...a,deliveryTtn:k||void 0}:null)}})},De=a=>{var p;return((p=H.find(d=>d.code===a))==null?void 0:p.name)||a},pe=async a=>{if(!s)return;const p={...s,...a,items:F,..._?{subtotal:_.subtotal,discount:_.discount,total:_.total}:{}};try{await x.mutateAsync({id:s.id,data:{customer:p.customer,recipient:p.recipient,delivery:p.delivery,payment:p.payment,status:p.status,subtotal:p.subtotal,discount:p.discount,deliveryCost:p.deliveryCost,total:p.total,deliveryTtn:p.deliveryTtn,items:F.map(d=>({productId:d.productId,quantity:d.quantity,selectedOptions:d.selectedOptions}))}}),r(p),n(!1),T(!1),$(!1),W(!1),D({title:"Збережено",description:"Замовлення оновлено"})}catch(d){D({title:"Помилка",description:d.message||"Не вдалося зберегти зміни",variant:"destructive"})}},we=a=>{f(p=>p.filter(d=>d.id!==a))},je=(a,p)=>{p<1||f(d=>d.map(M=>M.id===a?{...M,quantity:p}:M))},Ve=(a,p,d)=>{const M={id:`item_${Date.now()}_${Math.random()}`,productId:a,quantity:p,selectedOptions:d};f(B=>[...B,M])},me=h.useMemo(()=>{if(!(s!=null&&s.delivery))return null;if(s.delivery.method==="nova_poshta"){const a=!!(s.delivery.city&&s.delivery.cityRef),p=!!(s.delivery.warehouse&&s.delivery.warehouseRef),d=t!==null?t:a&&p;return{city:s.delivery.city,warehouse:s.delivery.warehouse,completed:d}}else if(s.delivery.method==="ukrposhta"){const a=!!(s.delivery.city&&s.delivery.cityRef),p=!!(s.delivery.warehouse&&s.delivery.warehouseRef),d=t!==null?t:a&&p;return{city:s.delivery.city,branch:s.delivery.warehouse,postalCode:s.delivery.postIndex,address:s.delivery.address,completed:d}}else if(s.delivery.method==="pickup")return{completed:!0};return null},[s==null?void 0:s.delivery,t]),Ne=h.useMemo(()=>t!==null?t:(me==null?void 0:me.completed)||!1,[me,t]);return b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження замовлення..."})}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ae,{variant:"ghost",size:"icon",onClick:()=>u("/admin/orders"),children:e.jsx(Ws,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Замовлення ",s.id]}),s.trackingToken&&e.jsx("a",{href:`/thank-you?track=${s.trackingToken}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 transition-colors inline-flex items-center",title:"Відкрити сторінку відстеження замовлення",children:e.jsx("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",focusable:"false","aria-hidden":"true",className:"inline-block",children:e.jsx("path",{fill:"currentColor",d:"M12 4.929 9.879 7.05a1.003 1.003 0 0 0 0 1.415 1.003 1.003 0 0 0 1.414 0l2.121-2.122a3.009 3.009 0 0 1 4.243 0 3.009 3.009 0 0 1 0 4.243l-2.121 2.121a1.003 1.003 0 0 0 0 1.414 1.003 1.003 0 0 0 1.414 0l2.121-2.12a5.002 5.002 0 0 0 0-7.072 5.002 5.002 0 0 0-7.071 0Zm-2.828 9.9a1.003 1.003 0 0 0 1.414 0l4.242-4.243a1.003 1.003 0 0 0 0-1.414 1.003 1.003 0 0 0-1.414 0l-4.242 4.242a1.003 1.003 0 0 0 0 1.415Zm3.535.707-2.121 2.121a3.009 3.009 0 0 1-4.243 0 3.009 3.009 0 0 1 0-4.243l2.121-2.121a1.003 1.003 0 0 0 0-1.414 1.003 1.003 0 0 0-1.414 0L4.93 12a5.002 5.002 0 0 0 0 7.071 5.002 5.002 0 0 0 7.071 0l2.121-2.121a1.003 1.003 0 0 0 0-1.414 1.003 1.003 0 0 0-1.414 0Z"})})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx(Se,{className:Ms[s.status],children:fs[s.status]}),((Xe=s.payment)==null?void 0:Xe.status)==="paid"?e.jsx(Se,{className:"bg-green-100 text-green-800 text-xs",children:"Оплачено"}):((es=s.payment)==null?void 0:es.status)==="cash_on_delivery"?e.jsx(Se,{className:"bg-orange-100 text-orange-800 text-xs",children:"Післяплата"}):e.jsx(Se,{className:"bg-gray-100 text-gray-800 text-xs",children:"Не оплачено"}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(As,{className:"h-4 w-4"}),zs(s.createdAt)]})]})]}),e.jsxs(ds,{value:s.status,onValueChange:a=>ke(a),children:[e.jsx(ms,{className:"w-48",children:e.jsx(hs,{})}),e.jsx(us,{children:Us.map(a=>e.jsx(Te,{value:a,children:fs[a]},a))})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-lg border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Товари в замовленні (",F.length,")"]}),e.jsx("div",{className:"flex gap-2",children:Z?e.jsxs(e.Fragment,{children:[e.jsx(ae,{variant:"outline",size:"sm",onClick:()=>{f(s.items.map((a,p)=>({...a,id:a.id||`item_${p}_${Date.now()}`}))),W(!1)},children:"Скасувати"}),e.jsx(ae,{size:"sm",onClick:()=>pe({items:F}),children:"Зберегти"})]}):e.jsxs(ae,{variant:"outline",size:"sm",onClick:()=>W(!0),children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Редагувати"]})})]}),e.jsx("div",{className:"space-y-4",children:F.map((a,p)=>{const d=H.find(se=>se.code===a.productId),M=(d==null?void 0:d.basePrice)||0,B=d==null?void 0:d.salePrice,Q=B&&B<M,ye=B||M,ge=Q?Math.round((M-(B||0))/M*100):0,Pe=a.selectedOptions.reduce((se,le)=>{const fe=d==null?void 0:d.options.find(js=>js.code===le);return se+((fe==null?void 0:fe.price)||0)},0),qe=(ye+Pe)*a.quantity,be=`${a.productId}_${p}_${JSON.stringify([...a.selectedOptions].sort())}`;return e.jsxs("div",{className:"flex gap-4 pb-4 border-b last:border-0 last:pb-0",children:[e.jsx("div",{className:"flex-shrink-0",children:d!=null&&d.images&&d.images.length>0?e.jsx("img",{src:d.images[0],alt:d.name,className:"w-20 h-20 object-cover rounded"}):e.jsx("div",{className:"w-20 h-20 bg-muted rounded flex items-center justify-center",children:e.jsx(_e,{className:"h-8 w-8 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[Q&&e.jsxs("div",{className:"bg-yellow-500 text-white text-xs font-bold px-2 py-0.5 rounded-full flex-shrink-0",children:["-",ge,"%"]}),e.jsx("div",{className:"font-medium text-base flex-1 min-w-0",children:De(a.productId)}),Pe>0&&e.jsxs("div",{className:"text-base font-bold text-primary whitespace-nowrap ml-8",children:["+",Pe," ₴"]}),e.jsxs("div",{className:"text-base font-medium whitespace-nowrap ml-8",children:[a.quantity," шт."]}),e.jsxs("div",{className:"text-lg font-bold whitespace-nowrap ml-8",children:[qe.toFixed(0)," ₴"]})]}),e.jsx("div",{className:"text-sm text-green-600 mb-2",children:"Готово к отправке"}),e.jsx("div",{className:"flex items-center gap-2 mb-2",children:Q?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-base font-bold",children:[ye," ₴"]}),e.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:[M," ₴"]})]}):e.jsxs("span",{className:"text-base font-bold",children:[M," ₴"]})}),(d==null?void 0:d.code)&&e.jsxs("div",{className:"text-xs text-muted-foreground mb-1",children:["Артикул: ",d.code]}),d&&e.jsxs("div",{className:"text-xs text-muted-foreground mb-2",children:["Остаток: ",d.stock]}),a.selectedOptions.length>0&&e.jsxs("div",{className:"mb-2 mt-3",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground mb-2",children:"Дополнительные опции:"}),e.jsx("div",{className:"space-y-2 max-w-md",children:a.selectedOptions.map(se=>{const le=d==null?void 0:d.options.find(fe=>fe.code===se);return le?e.jsxs("div",{className:"flex items-center justify-between text-sm bg-primary/10 border border-primary/20 rounded-lg px-3 py-2",children:[e.jsx("span",{className:"font-semibold text-foreground",children:le.name}),e.jsxs("span",{className:"font-bold text-primary",children:["+",le.price," ₴"]})]},se):null})})]}),Z&&e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{const se=a.quantity-1;se>=1&&je(a.id,se)},disabled:a.quantity<=1,className:`h-8 w-8 flex items-center justify-center rounded-xl border border-border transition-colors text-sm font-medium ${a.quantity<=1?"opacity-50 cursor-not-allowed bg-muted text-muted-foreground":"hover:bg-muted hover:border-primary text-foreground"}`,children:e.jsx($s,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-8 text-center text-sm font-medium text-muted-foreground",children:a.quantity}),e.jsx("button",{type:"button",onClick:()=>je(a.id,a.quantity+1),className:"h-8 w-8 flex items-center justify-center rounded-xl border border-border hover:bg-muted hover:border-primary transition-colors text-foreground text-sm font-medium",children:e.jsx(Ye,{className:"w-3 h-3"})})]}),e.jsx("button",{type:"button",onClick:()=>we(a.id),className:"h-8 w-8 flex items-center justify-center text-muted-foreground hover:text-destructive transition-colors",children:e.jsx(Is,{className:"w-5 h-5"})})]})]})]},be)})}),Z&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs(ae,{variant:"outline",onClick:()=>oe(!0),children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Додати товар"]})})]}),e.jsxs("div",{className:"bg-card rounded-lg border p-6",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2 cursor-pointer mb-4",onClick:()=>{n(!R)},children:[ue?e.jsx(de,{className:"w-6 h-6 text-green-500"}):(ss=s==null?void 0:s.customer)!=null&&ss.phone||(ts=s==null?void 0:s.customer)!=null&&ts.firstName||(as=s==null?void 0:s.customer)!=null&&as.lastName?e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white flex items-center justify-center text-sm font-medium",children:"1"}):e.jsx("span",{className:"w-6 h-6 rounded-full bg-primary text-white flex items-center justify-center text-sm",children:"1"}),"Контактні дані *"]}),ue&&N&&!R?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Замовник"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[(ns=s.customer)==null?void 0:ns.lastName," ",(os=s.customer)==null?void 0:os.firstName]}),e.jsx("button",{type:"button",onClick:()=>n(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm",children:(rs=s.customer)==null?void 0:rs.phone})]}),s.recipient&&e.jsxs("div",{className:"space-y-1 pt-2 border-t",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Отримувач"}),e.jsxs("div",{className:"text-sm",children:[s.recipient.lastName," ",s.recipient.firstName]}),e.jsx("div",{className:"text-sm",children:s.recipient.phone})]})]}):e.jsx(Ls,{customer:s.customer,recipient:s.recipient,onSave:(a,p)=>{pe({customer:a,recipient:p}),y(!0),n(!1)},onCancel:()=>n(!1),mode:"view",defaultExpanded:R,isCompleted:ue,onToggleExpanded:()=>n(!R)}),s.promoCode&&e.jsxs("div",{className:"flex items-center gap-2 text-sm mt-4 pt-4 border-t",children:[e.jsx("span",{className:"text-muted-foreground",children:"Промокод:"}),e.jsx("span",{className:"font-medium text-green-600",children:s.promoCode})]})]}),e.jsxs("div",{className:"bg-card rounded-lg border p-6",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2 cursor-pointer mb-4",onClick:()=>{Ne&&T(!j)},children:[Ne?e.jsx(de,{className:"w-6 h-6 text-green-500"}):e.jsx("span",{className:"w-6 h-6 rounded-full bg-primary text-white flex items-center justify-center text-sm",children:"2"}),"Доставка *"]}),j?e.jsx(Ds,{delivery:s.delivery,onSave:a=>{pe({delivery:a})},onCancel:()=>T(!1),mode:"edit",defaultExpanded:!0,orderTotal:(_==null?void 0:_.total)||s.total,isCompleted:Ne,onToggleExpanded:()=>T(!j),onValidationChange:a=>i(a)}):e.jsx("div",{className:"space-y-2",children:(()=>{const a=me;if(s.delivery.method==="nova_poshta"&&a)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),v]}),e.jsx("button",{type:"button",onClick:()=>T(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),a.city&&e.jsx("div",{className:"text-sm",children:a.city}),a.warehouse&&e.jsx("div",{className:"text-sm",children:a.warehouse})]});if(s.delivery.method==="ukrposhta"&&a){const p=a.city||"",d=a.postalCode&&a.address?`${a.postalCode} ${p.replace(/\s*\([^)]*\)\s*$/,"")}, ${a.address}`:a.branch||"";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5"}),w]}),e.jsx("button",{type:"button",onClick:()=>T(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),p&&e.jsx("div",{className:"text-sm",children:p}),d&&e.jsx("div",{className:"text-sm",children:d})]})}else if(s.delivery.method==="pickup")return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5"}),g]}),e.jsx("button",{type:"button",onClick:()=>T(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm",children:ne.store_address||"м. Київ, вул. Урлівська 30"})]});return null})()})]}),e.jsxs("div",{className:"bg-card rounded-lg border p-6",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2 cursor-pointer mb-4",onClick:()=>{var a;(a=s.payment)!=null&&a.method&&$(!Y)},children:[(is=s.payment)!=null&&is.method?e.jsx(de,{className:"w-6 h-6 text-green-500"}):e.jsx("span",{className:"w-6 h-6 rounded-full bg-primary text-white flex items-center justify-center text-sm",children:"3"}),"Спосіб оплати *"]}),(ls=s.payment)!=null&&ls.method&&!Y?e.jsxs("div",{className:"space-y-2",children:[s.payment.method==="wayforpay"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5"}),S]}),e.jsx("button",{type:"button",onClick:()=>$(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:E})]}),s.payment.method==="nalojka"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5"}),Oe]}),e.jsx("button",{type:"button",onClick:()=>$(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.delivery.method==="nova_poshta"&&"Післяплата (комісія 2% + 20 грн)",s.delivery.method==="ukrposhta"&&"Післяплата (комісія 2% + 15 грн)",s.delivery.method==="pickup"&&"Оплата готівкою при отриманні замовлення"]})]}),s.payment.method==="fopiban"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5"}),Fe]}),e.jsx("button",{type:"button",onClick:()=>$(!0),className:"text-muted-foreground hover:text-primary",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Re})]})]}):e.jsx(Vs,{payment:s.payment,deliveryMethod:s.delivery.method,onSave:a=>{pe({payment:a})},onCancel:()=>$(!1),mode:"edit",defaultExpanded:Y,isCompleted:!!((cs=s.payment)!=null&&cs.method),onToggleExpanded:()=>$(!Y)})]}),s.comment&&e.jsxs("div",{className:"bg-card rounded-lg border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Коментар"}),e.jsx("div",{className:"text-sm whitespace-pre-wrap",children:s.comment})]}),(()=>{const a=!!s.analytics;return console.log("[OrderDetail Render] Has analytics:",a),console.log("[OrderDetail Render] Analytics object:",s.analytics),a?e.jsxs("div",{className:"bg-card rounded-lg border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Аналітика сесії"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[(s.analytics.utmSource||s.analytics.utmMedium||s.analytics.utmCampaign)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"UTM параметри:"}),e.jsxs("div",{className:"pl-4 space-y-1",children:[s.analytics.utmSource&&e.jsxs("div",{children:["Джерело: ",e.jsx("span",{className:"font-medium",children:s.analytics.utmSource})]}),s.analytics.utmMedium&&e.jsxs("div",{children:["Канал: ",e.jsx("span",{className:"font-medium",children:s.analytics.utmMedium})]}),s.analytics.utmCampaign&&e.jsxs("div",{children:["Кампанія: ",e.jsx("span",{className:"font-medium",children:s.analytics.utmCampaign})]}),s.analytics.utmTerm&&e.jsxs("div",{children:["Термін: ",e.jsx("span",{className:"font-medium",children:s.analytics.utmTerm})]}),s.analytics.utmContent&&e.jsxs("div",{children:["Контент: ",e.jsx("span",{className:"font-medium",children:s.analytics.utmContent})]})]})]}),(s.analytics.referrer||s.analytics.landingPage)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Джерела:"}),e.jsxs("div",{className:"pl-4 space-y-1",children:[s.analytics.referrer&&e.jsxs("div",{children:["Реферер: ",e.jsx("span",{className:"font-medium break-all",children:s.analytics.referrer})]}),s.analytics.landingPage&&e.jsxs("div",{children:["Вхідна сторінка: ",e.jsx("span",{className:"font-medium break-all",children:s.analytics.landingPage})]})]})]}),(s.analytics.deviceType||s.analytics.browser||s.analytics.os)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Пристрій:"}),e.jsxs("div",{className:"pl-4 space-y-1",children:[s.analytics.deviceType&&e.jsxs("div",{children:["Тип: ",e.jsx("span",{className:"font-medium capitalize",children:s.analytics.deviceType})]}),s.analytics.browser&&e.jsxs("div",{children:["Браузер: ",e.jsx("span",{className:"font-medium",children:s.analytics.browser})]}),s.analytics.os&&e.jsxs("div",{children:["ОС: ",e.jsx("span",{className:"font-medium",children:s.analytics.os})]}),s.analytics.screenResolution&&e.jsxs("div",{children:["Роздільність: ",e.jsx("span",{className:"font-medium",children:s.analytics.screenResolution})]})]})]}),(s.analytics.ipAddress||s.analytics.country||s.analytics.city)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Локація:"}),e.jsxs("div",{className:"pl-4 space-y-1",children:[s.analytics.ipAddress&&e.jsxs("div",{children:["IP: ",e.jsx("span",{className:"font-mono font-medium",children:s.analytics.ipAddress.split(",")[0].trim()})]}),s.analytics.country&&e.jsxs("div",{children:["Країна: ",e.jsx("span",{className:"font-medium",children:s.analytics.country})]}),s.analytics.city&&e.jsxs("div",{children:["Місто: ",e.jsx("span",{className:"font-medium",children:s.analytics.city})]})]})]}),(s.analytics.pagesViewed!==null&&s.analytics.pagesViewed!==void 0||s.analytics.totalTimeSpent!==null&&s.analytics.totalTimeSpent!==void 0||s.analytics.cartItemsCount!==null&&s.analytics.cartItemsCount!==void 0)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Статистика сесії:"}),e.jsxs("div",{className:"pl-4 space-y-1",children:[s.analytics.pagesViewed!==null&&s.analytics.pagesViewed!==void 0&&e.jsxs("div",{children:["Переглянуто сторінок: ",e.jsx("span",{className:"font-medium",children:s.analytics.pagesViewed})]}),s.analytics.totalTimeSpent!==null&&s.analytics.totalTimeSpent!==void 0&&e.jsxs("div",{children:["Час на сайті: ",e.jsxs("span",{className:"font-medium",children:[Math.floor(s.analytics.totalTimeSpent/60)," хв ",s.analytics.totalTimeSpent%60," сек"]})]}),s.analytics.cartItemsCount!==null&&s.analytics.cartItemsCount!==void 0&&e.jsxs("div",{children:["Товарів у кошику: ",e.jsx("span",{className:"font-medium",children:s.analytics.cartItemsCount})]})]})]}),s.analytics.language&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:"Мова:"}),e.jsx("div",{className:"pl-4",children:e.jsx("span",{className:"font-medium",children:s.analytics.language})})]})]})]}):null})()]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-lg border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Підсумок"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Товари (",F.length,")"]}),e.jsxs("span",{children:["₴",(_==null?void 0:_.subtotal.toFixed(2))||s.subtotal.toFixed(2)]})]}),((_==null?void 0:_.discount)||s.discount)>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Знижка"}),e.jsxs("span",{children:["-₴",((_==null?void 0:_.discount)||s.discount).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Доставка"}),e.jsx("span",{children:s.deliveryCost>0?`₴${s.deliveryCost.toFixed(2)}`:"Безкоштовно"})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2 mt-2",children:[e.jsx("span",{children:"Всього"}),e.jsxs("span",{children:["₴",(_==null?void 0:_.total.toFixed(2))||s.total.toFixed(2)]})]})]})]}),(s.delivery.method==="nova_poshta"||s.delivery.method==="ukrposhta")&&e.jsxs("div",{className:"bg-card rounded-lg border p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"ТТН (Трекінг-номер)"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{value:k,onChange:a=>A(a.target.value),placeholder:"Введіть номер ТТН",className:"w-full"}),e.jsx(ae,{onClick:Ce,variant:"outline",size:"default",className:"w-full",children:"Зберегти"}),s.deliveryTtn&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Поточний ТТН: ",s.deliveryTtn]})]})]}),e.jsxs("div",{className:"bg-card rounded-lg border p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Bs,{className:"h-5 w-5"}),"Статус та сума оплати"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Статус оплати"}),e.jsxs(ds,{value:K,onValueChange:a=>U(a),children:[e.jsx(ms,{className:"w-full",children:e.jsx(hs,{})}),e.jsxs(us,{children:[e.jsx(Te,{value:"not_paid",children:"Не оплачено"}),e.jsx(Te,{value:"cash_on_delivery",children:"Післяплата"}),e.jsx(Te,{value:"paid",children:"Оплачено"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Сума оплати (₴)"}),e.jsx(he,{type:"number",step:"0.01",min:"0",value:q,onChange:a=>c(a.target.value),placeholder:"0.00",className:"w-full"})]}),e.jsx("div",{children:e.jsx(ae,{onClick:()=>{s&&x.mutate({id:s.id,data:{customer:s.customer,delivery:s.delivery,payment:{...s.payment,status:K,paidAmount:q?parseFloat(q):null},status:s.status,subtotal:s.subtotal,discount:s.discount,deliveryCost:s.deliveryCost,total:s.total,deliveryTtn:s.deliveryTtn}},{onSuccess:()=>{r(a=>a?{...a,payment:{...a.payment,status:K,paidAmount:q?parseFloat(q):null}}:null),D({title:"Збережено",description:"Дані оплати оновлено"})},onError:a=>{D({title:"Помилка",description:a.message||"Не вдалося зберегти дані оплати",variant:"destructive"})}})},variant:"outline",size:"default",className:"w-full",children:"Зберегти зміни оплати"})})]})]})]})]}),e.jsx(qs,{isOpen:G,onClose:()=>oe(!1),onAdd:Ve,products:H})]}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Замовлення не знайдено"})})}export{bt as OrderDetail};
