const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Ct8VNDTX.css"])))=>i.map(i=>d[i]);
import{q as qt,a as Ut,u as Kt,s as N,H as Ht,v as j,t as xt,w as Gt,_ as Jt,x as Yt}from"./index-B6OfjcXa.js";import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as c}from"./chunk-charts-BaLkbnPn.js";import{B as E}from"./button-DuES4t0P.js";import{I}from"./input-DJYt3sht.js";import{L as k}from"./label-VmO7nHBb.js";import{P as _,R as ft,a as $,N as Qt,U as Xt}from"./UkrPoshtaDelivery-DaCzRKEl.js";import{C as Zt}from"./checkbox-BxYtfKK5.js";import{u as es}from"./usePublicSettings-D_JscJXt.js";import{u as ts}from"./useTexts-pJ3-f1BL.js";import{N as je,U as ke,P as be,W as vt,C as yt,F as Pt}from"./PaymentLogos-5VRd8a-7.js";import{P as ss}from"./package-COYvvZxv.js";import{A as as}from"./arrow-left-BVYHnN_C.js";import{C as P}from"./circle-check-big-DyuaBmZf.js";import{C as te}from"./chevron-up-TvWTALxc.js";import{C as se}from"./chevron-down-8yCirq3-.js";import"./index-D4-djExh.js";import"./index-ZeZSZmiz.js";import"./circle-C5Ii7Dm0.js";import"./search-BS-SlgZ5.js";import"./check-CY5PsTnj.js";const Es=()=>{var ot,rt,nt,it,lt,ct,dt,ht,mt,ut,pt;const ae=qt(),{items:b,getSubtotal:U,getDiscount:oe,getDeliveryCost:os,getTotal:Ce,clearCart:gt}=Ut(),{data:Nt=[]}=Kt(),{data:y={}}=es(),{data:we}=ts(),f=Array.isArray(we)?we:[],[Re,Ee]=c.useState(!1),Ie=((ot=f.find(t=>t.key==="checkout.delivery.nova_poshta.title"))==null?void 0:ot.value)||"Нова Пошта",jt=((rt=f.find(t=>t.key==="checkout.delivery.nova_poshta.description"))==null?void 0:rt.value)||"1-2 дні по Україні",_e=((nt=f.find(t=>t.key==="checkout.delivery.ukrposhta.title"))==null?void 0:nt.value)||"Укрпошта",kt=((it=f.find(t=>t.key==="checkout.delivery.ukrposhta.description"))==null?void 0:it.value)||"3-5 днів по Україні",De=((lt=f.find(t=>t.key==="checkout.delivery.pickup.title"))==null?void 0:lt.value)||"Самовивіз",Se=((ct=f.find(t=>t.key==="checkout.payment.wayforpay.title"))==null?void 0:ct.value)||"Онлайн оплата",Te=((dt=f.find(t=>t.key==="checkout.payment.wayforpay.description"))==null?void 0:dt.value)||"Безпечна оплата карткою через WayForPay",Fe=((ht=f.find(t=>t.key==="checkout.payment.nalojka.title"))==null?void 0:ht.value)||"Оплата при отриманні",Oe=((mt=f.find(t=>t.key==="checkout.payment.fop.title"))==null?void 0:mt.value)||"Оплата на рахунок ФОП",Me=((ut=f.find(t=>t.key==="checkout.payment.fop.description"))==null?void 0:ut.value)||"Оплата на банківський рахунок ФОП";c.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"}),N({stage:"started_checkout",cartProducts:b,cartTotal:Ce()})},[]),c.useEffect(()=>{const t=localStorage.getItem("checkoutFormData");if(t)try{const a=JSON.parse(t);n(o=>({...o,name:a.name||o.name,firstName:a.firstName||o.firstName,lastName:a.lastName||o.lastName,phone:a.phone||o.phone||"",deliveryExpanded:a.deliveryExpanded!==void 0?a.deliveryExpanded:!0,contactInfoCompleted:a.contactInfoCompleted||!1,contactInfoExpanded:a.contactInfoExpanded!==void 0?a.contactInfoExpanded:!0,paymentMethod:a.paymentMethod||o.paymentMethod||"",paymentCompleted:a.paymentCompleted||!1,paymentExpanded:a.paymentExpanded!==void 0?a.paymentExpanded:!0,deliveryMethod:a.deliveryMethod||o.deliveryMethod,novaPoshtaCity:a.novaPoshtaCity||o.novaPoshtaCity,novaPoshtaCityRef:a.novaPoshtaCityRef||o.novaPoshtaCityRef,novaPoshtaPostOfficeWarehouse:a.novaPoshtaPostOfficeWarehouse||o.novaPoshtaPostOfficeWarehouse,novaPoshtaPostOfficeWarehouseRef:a.novaPoshtaPostOfficeWarehouseRef||o.novaPoshtaPostOfficeWarehouseRef,novaPoshtaPostOfficeCompleted:a.novaPoshtaPostOfficeCompleted||!1,novaPoshtaPostomatWarehouse:a.novaPoshtaPostomatWarehouse||o.novaPoshtaPostomatWarehouse,novaPoshtaPostomatWarehouseRef:a.novaPoshtaPostomatWarehouseRef||o.novaPoshtaPostomatWarehouseRef,novaPoshtaPostomatCompleted:a.novaPoshtaPostomatCompleted||!1,novaPoshtaDeliveryType:a.novaPoshtaDeliveryType||o.novaPoshtaDeliveryType,novaPoshtaExpanded:!1,ukrPoshtaCity:a.ukrPoshtaCity||o.ukrPoshtaCity,ukrPoshtaCityId:a.ukrPoshtaCityId||o.ukrPoshtaCityId,ukrPoshtaCityRegion:a.ukrPoshtaCityRegion||o.ukrPoshtaCityRegion,ukrPoshtaBranch:a.ukrPoshtaBranch||o.ukrPoshtaBranch,ukrPoshtaBranchId:a.ukrPoshtaBranchId||o.ukrPoshtaBranchId,ukrPoshtaPostalCode:a.ukrPoshtaPostalCode||o.ukrPoshtaPostalCode,ukrPoshtaAddress:a.ukrPoshtaAddress||o.ukrPoshtaAddress,ukrPoshtaExpanded:!1,ukrPoshtaCompleted:a.ukrPoshtaCompleted||!1,pickupExpanded:!1,pickupCompleted:a.pickupCompleted||!1,comment:a.comment||o.comment||"",commentExpanded:a.commentExpanded!==void 0?a.commentExpanded:!1}))}catch(a){console.error("Error loading checkout form data from localStorage:",a)}},[]);const[s,n]=c.useState({firstName:"",lastName:"",name:"",phone:"",hasDifferentRecipient:!1,recipientFirstName:"",recipientLastName:"",recipientPhone:"",paymentMethod:"",paymentCompleted:!1,paymentExpanded:!0,deliveryMethod:"",novaPoshtaCity:"",novaPoshtaCityRef:null,novaPoshtaPostOfficeWarehouse:"",novaPoshtaPostOfficeWarehouseRef:null,novaPoshtaPostOfficeCompleted:!1,novaPoshtaPostomatWarehouse:"",novaPoshtaPostomatWarehouseRef:null,novaPoshtaPostomatCompleted:!1,novaPoshtaDeliveryType:"PostOffice",novaPoshtaExpanded:!1,ukrPoshtaCity:"",ukrPoshtaCityId:null,ukrPoshtaCityRegion:"",ukrPoshtaBranch:"",ukrPoshtaBranchId:null,ukrPoshtaPostalCode:"",ukrPoshtaAddress:"",ukrPoshtaExpanded:!1,ukrPoshtaCompleted:!1,pickupExpanded:!1,pickupCompleted:!1,comment:"",commentExpanded:!1,contactInfoCompleted:!1,contactInfoExpanded:!0,deliveryExpanded:!0}),We=c.useMemo(()=>{var t;return s.deliveryMethod==="nova_poshta"?"Післяплата (комісія 2% + 20 грн)":s.deliveryMethod==="ukr_poshta"||s.deliveryMethod==="ukrposhta"?"Післяплата (комісія 2% + 15 грн)":s.deliveryMethod==="pickup"?"Оплата готівкою при отриманні замовлення":((t=f.find(a=>a.key==="checkout.payment.nalojka.description"))==null?void 0:t.value)||"Оплата при отриманні (+20 грн комісія)"},[s.deliveryMethod,f]),[K,bt]=c.useState(!1),[re,ne]=c.useState(""),D=c.useRef(null),[Be,ie]=c.useState(!1),[le,S]=c.useState(""),[Le,ce]=c.useState(!1),[de,T]=c.useState(""),[H,$e]=c.useState(!1),[he,Ct]=c.useState(""),F=c.useRef(null),[Ae,G]=c.useState(!1),[me,C]=c.useState(""),[ze,J]=c.useState(!1),[ue,w]=c.useState(""),[Y,Ve]=c.useState(""),[pe,wt]=c.useState(!1),[R,qe]=c.useState(null),[xe,Q]=c.useState(""),[Ue,Ke]=c.useState(!1),[fe,Rt]=c.useState(!1),[ve,Et]=c.useState(!1),He=c.useRef(null),ye=c.useRef(null),Pe=c.useRef(null),O=t=>{const a=t.replace(/\D/g,"");return a.length===0?(ne("Це обов'язкове поле"),!1):a.length<12||!a.startsWith("380")?(ne("Некоректний номер"),!1):(ne(""),!0)},v=t=>/^[а-яА-ЯіІїЇєЄґҐ\s-]+$/.test(t),It=t=>{const a=t.target.value;s.lastName,a===""||v(a)?(n(o=>({...o,lastName:a})),ie(!0),a.trim()===""?S("Це обов'язкове поле"):S("")):(ie(!0),S("Використовуйте тільки кириличні символи"))},_t=t=>{const a=t.target.value;s.firstName,a===""||v(a)?(n(o=>({...o,firstName:a})),ce(!0),a.trim()===""?T("Це обов'язкове поле"):T("")):(ce(!0),T("Використовуйте тільки кириличні символи"))},Dt=t=>{const a=t.target,o=a.selectionStart||0,r=a.value;let i=r.replace(/\D/g,"");if(i&&!i.startsWith("380")&&(i="380"+i),i=i.slice(0,12),i.length<=3){n(l=>({...l,phone:""})),K&&O("");return}const d="+"+i,x=r.slice(0,o).replace(/\D/g,"").length;let m=4;x>3&&(m=4+(x-3)),x>=i.length&&(m=d.length),n(l=>({...l,phone:d})),setTimeout(()=>{D.current&&D.current.setSelectionRange(m,m)},0),(K||d.length>4)&&O(d)},St=t=>{if(t.key==="Backspace"&&(t.currentTarget.selectionStart||0)<=4){t.preventDefault();return}if(t.key==="Delete"&&(t.currentTarget.selectionStart||0)<4){t.preventDefault();return}},Tt=t=>{setTimeout(()=>{if(D.current){const a=s.phone===""?"+380":s.phone;a.length>4?D.current.setSelectionRange(a.length,a.length):D.current.setSelectionRange(4,4)}},0)},Ft=t=>{(s.phone===""||s.phone==="+380")&&n(a=>({...a,phone:""})),bt(!0),O(s.phone===""||s.phone==="+380"?"":s.phone)},Ot=t=>{const a=t.target.value;a===""||v(a)?(n(o=>({...o,recipientLastName:a})),G(!0),a.trim()===""?C("Це обов'язкове поле"):C("")):(G(!0),C("Використовуйте тільки кириличні символи"))},Mt=t=>{const a=t.target.value;a===""||v(a)?(n(o=>({...o,recipientFirstName:a})),J(!0),a.trim()===""?w("Це обов'язкове поле"):w("")):(J(!0),w("Використовуйте тільки кириличні символи"))},Wt=t=>{const a=t.target,o=a.selectionStart||0,r=a.value;let i=r.replace(/\D/g,"");if(i&&!i.startsWith("380")&&(i="380"+i),i=i.slice(0,12),i.length<=3){n(l=>({...l,recipientPhone:""})),H&&O("");return}const d="+"+i,x=r.slice(0,o).replace(/\D/g,"").length;let m=4;x>3&&(m=4+(x-3)),x>=i.length&&(m=d.length),n(l=>({...l,recipientPhone:d})),setTimeout(()=>{F.current&&F.current.setSelectionRange(m,m)},0),(H||d.length>4)&&O(d)},Bt=t=>{if(t.key==="Backspace"&&(t.currentTarget.selectionStart||0)<=4){t.preventDefault();return}if(t.key==="Delete"&&(t.currentTarget.selectionStart||0)<4){t.preventDefault();return}},Lt=t=>{setTimeout(()=>{if(F.current){const a=s.recipientPhone===""?"+380":s.recipientPhone;a.length>4?F.current.setSelectionRange(a.length,a.length):F.current.setSelectionRange(4,4)}},0)},$t=t=>{(s.recipientPhone===""||s.recipientPhone==="+380")&&n(a=>({...a,recipientPhone:""})),$e(!0),O(s.recipientPhone===""||s.recipientPhone==="+380"?"":s.recipientPhone)},Ge=(s.phone===""||s.phone==="+380"?"":s.phone).replace(/\D/g,"").length===12&&(s.phone===""||s.phone==="+380"?"":s.phone).replace(/\D/g,"").startsWith("380"),Je=s.lastName.trim()!==""&&v(s.lastName),Ye=s.firstName.trim()!==""&&v(s.firstName),Qe=!s.hasDifferentRecipient||(s.recipientPhone===""||s.recipientPhone==="+380"?"":s.recipientPhone).replace(/\D/g,"").length===12&&(s.recipientPhone===""||s.recipientPhone==="+380"?"":s.recipientPhone).replace(/\D/g,"").startsWith("380"),Xe=!s.hasDifferentRecipient||s.recipientLastName.trim()!==""&&v(s.recipientLastName),Ze=!s.hasDifferentRecipient||s.recipientFirstName.trim()!==""&&v(s.recipientFirstName),At=!s.hasDifferentRecipient||Qe&&Xe&&Ze,A=Ge&&Je&&Ye&&At;c.useEffect(()=>{const t={name:s.name,firstName:s.firstName,lastName:s.lastName,phone:s.phone,hasDifferentRecipient:s.hasDifferentRecipient,recipientFirstName:s.recipientFirstName,recipientLastName:s.recipientLastName,recipientPhone:s.recipientPhone,contactInfoCompleted:s.contactInfoCompleted,contactInfoExpanded:s.contactInfoExpanded,deliveryExpanded:s.deliveryExpanded,paymentMethod:s.paymentMethod,paymentCompleted:s.paymentCompleted,paymentExpanded:s.paymentExpanded,deliveryMethod:s.deliveryMethod,novaPoshtaCity:s.novaPoshtaCity,novaPoshtaCityRef:s.novaPoshtaCityRef,novaPoshtaPostOfficeWarehouse:s.novaPoshtaPostOfficeWarehouse,novaPoshtaPostOfficeWarehouseRef:s.novaPoshtaPostOfficeWarehouseRef,novaPoshtaPostOfficeCompleted:s.novaPoshtaPostOfficeCompleted,novaPoshtaPostomatWarehouse:s.novaPoshtaPostomatWarehouse,novaPoshtaPostomatWarehouseRef:s.novaPoshtaPostomatWarehouseRef,novaPoshtaPostomatCompleted:s.novaPoshtaPostomatCompleted,novaPoshtaDeliveryType:s.novaPoshtaDeliveryType,novaPoshtaExpanded:s.novaPoshtaExpanded,ukrPoshtaCity:s.ukrPoshtaCity,ukrPoshtaCityId:s.ukrPoshtaCityId,ukrPoshtaCityRegion:s.ukrPoshtaCityRegion,ukrPoshtaBranch:s.ukrPoshtaBranch,ukrPoshtaBranchId:s.ukrPoshtaBranchId,ukrPoshtaPostalCode:s.ukrPoshtaPostalCode,ukrPoshtaAddress:s.ukrPoshtaAddress,ukrPoshtaExpanded:s.ukrPoshtaExpanded,ukrPoshtaCompleted:s.ukrPoshtaCompleted,pickupExpanded:s.pickupExpanded,pickupCompleted:s.pickupCompleted};localStorage.setItem("checkoutFormData",JSON.stringify(t))},[s]);const z=()=>s.deliveryMethod==="nova_poshta"?s.novaPoshtaDeliveryType==="PostOffice"?{city:s.novaPoshtaCity,cityRef:s.novaPoshtaCityRef,warehouse:s.novaPoshtaPostOfficeWarehouse,warehouseRef:s.novaPoshtaPostOfficeWarehouseRef,deliveryType:"PostOffice",completed:s.novaPoshtaPostOfficeCompleted}:{city:s.novaPoshtaCity,cityRef:s.novaPoshtaCityRef,warehouse:s.novaPoshtaPostomatWarehouse,warehouseRef:s.novaPoshtaPostomatWarehouseRef,deliveryType:"Postomat",completed:s.novaPoshtaPostomatCompleted}:s.deliveryMethod==="ukr_poshta"?{city:s.ukrPoshtaCity,cityId:s.ukrPoshtaCityId,cityRegion:s.ukrPoshtaCityRegion,branch:s.ukrPoshtaBranch,branchId:s.ukrPoshtaBranchId,postalCode:s.ukrPoshtaPostalCode,address:s.ukrPoshtaAddress,completed:s.ukrPoshtaCompleted}:s.deliveryMethod==="pickup"?{completed:s.pickupCompleted}:null,et=t=>{if(t==="nova_poshta"){const a=s.novaPoshtaDeliveryType==="PostOffice"?s.novaPoshtaPostOfficeWarehouse:s.novaPoshtaPostomatWarehouse,o=s.novaPoshtaDeliveryType==="PostOffice"?s.novaPoshtaPostOfficeCompleted:s.novaPoshtaPostomatCompleted;return{city:s.novaPoshtaCity,warehouse:a,completed:o}}else if(t==="ukr_poshta")return{city:s.ukrPoshtaCity,cityRegion:s.ukrPoshtaCityRegion,branch:s.ukrPoshtaBranch,postalCode:s.ukrPoshtaPostalCode,address:s.ukrPoshtaAddress,completed:s.ukrPoshtaCompleted};return null},zt=t=>{const{name:a,value:o}=t.target;n(r=>{const p={...r,[a]:o};return a==="firstName"&&o&&!r.firstName&&N({stage:"filled_name"}),a==="phone"&&o&&!r.phone&&N({stage:"filled_phone"}),p})},tt=async t=>{if(t.preventDefault(),!s.firstName||!s.lastName||!s.phone){j({title:"Помилка",description:"Будь ласка, заповніть контактні дані",variant:"destructive"});return}if(s.hasDifferentRecipient&&(!s.recipientFirstName||!s.recipientLastName||!s.recipientPhone)){j({title:"Помилка",description:"Будь ласка, заповніть дані отримувача",variant:"destructive"});return}const a=`${s.firstName} ${s.lastName}`.trim();if(!s.deliveryMethod){j({title:"Помилка",description:"Будь ласка, виберіть спосіб доставки",variant:"destructive"});return}if(s.deliveryMethod!=="pickup"){const o=z();if(s.deliveryMethod==="nova_poshta"){if(!(o!=null&&o.city)||!(o!=null&&o.warehouseRef)){j({title:"Помилка",description:"Будь ласка, виберіть місто та відділення доставки",variant:"destructive"});return}}else if(s.deliveryMethod==="ukr_poshta"&&(!(o!=null&&o.city)||!(o!=null&&o.branchId))){j({title:"Помилка",description:"Будь ласка, виберіть місто та відділення доставки",variant:"destructive"});return}}if(!s.paymentMethod){j({title:"Помилка",description:"Будь ласка, виберіть спосіб оплати",variant:"destructive"});return}N({stage:"clicked_submit"}),xt({eventType:"checkout_submit",eventCategory:"ecommerce",eventValue:Ce()}),Ee(!0);try{const o=U(),r=ge(),p=0,d=o-r,m={analyticsSessionId:sessionStorage.getItem("analytics_session_id")||null,customer:{name:a,phone:s.phone,firstName:s.firstName,lastName:s.lastName},recipient:s.hasDifferentRecipient?{name:`${s.recipientFirstName} ${s.recipientLastName}`.trim(),phone:s.recipientPhone,firstName:s.recipientFirstName,lastName:s.recipientLastName}:null,promoCode:(R==null?void 0:R.code)||null,delivery:(()=>{const u=z();return s.deliveryMethod==="nova_poshta"&&u?{method:s.deliveryMethod,city:u.city||null,warehouse:u.warehouse||null,warehouseRef:u.warehouseRef||null,cityRef:u.cityRef||null,postIndex:null,address:null}:s.deliveryMethod==="ukr_poshta"&&u?{method:"ukrposhta",city:u.city||null,warehouse:u.branch||null,warehouseRef:u.branchId||null,cityRef:u.cityId||null,postIndex:u.postalCode||null,address:u.address||null}:{method:s.deliveryMethod,city:null,warehouse:null,warehouseRef:null,cityRef:null,postIndex:null,address:null}})(),payment:{method:s.paymentMethod},items:b.map(u=>({productId:u.productId,quantity:u.quantity,selectedOptions:u.selectedOptions||[]})),subtotal:o||0,discount:r||0,deliveryCost:p||0,total:d||0,comment:s.comment&&s.comment.trim()?s.comment.trim():null},l=await Gt.create(m);if(N({stage:"completed_order",orderId:l.orderId,cartTotal:d}),xt({eventType:"order_completed",eventCategory:"ecommerce",orderId:l.orderId,eventValue:d}),localStorage.removeItem("checkoutFormData"),s.paymentMethod==="wayforpay")try{const{wayforpayAPI:u}=await Jt(async()=>{const{wayforpayAPI:Z}=await import("./index-B6OfjcXa.js").then(q=>q.au);return{wayforpayAPI:Z}},__vite__mapDeps([0]));console.log("[Checkout] Creating WayForPay payment for order:",l.orderId);const V=await u.createPayment(l.orderId);if(console.log("[Checkout] Payment response received:",V),!V.paymentUrl||!V.paymentData)throw new Error("Invalid payment response from server");const B=document.createElement("form");B.method="POST",B.action=V.paymentUrl,Object.entries(V.paymentData).forEach(([Z,q])=>{if(Array.isArray(q))q.forEach((L,ns)=>{const ee=document.createElement("input");ee.type="hidden",ee.name=`${Z}[]`,ee.value=String(L),B.appendChild(ee)});else{const L=document.createElement("input");L.type="hidden",L.name=Z,L.value=String(q),B.appendChild(L)}}),console.log("[Checkout] Submitting form to WayForPay"),document.body.appendChild(B),B.submit();return}catch(u){console.error("[Checkout] Error creating payment:",u),j({title:"Помилка оплати",description:u instanceof Error?u.message:"Не вдалося створити платіж. Спробуйте пізніше.",variant:"destructive"});return}gt();const h=l.trackingToken?`track=${l.trackingToken}`:`orderId=${l.orderId}`;ae(`/thank-you?${h}`)}catch(o){console.error("Order submission error:",o),j({title:"Помилка",description:o instanceof Error?o.message:"Не вдалося оформити замовлення. Спробуйте пізніше.",variant:"destructive"})}finally{Ee(!1)}},st=()=>{if(!R)return 0;const t=U(),a=oe();return(t-a)*R.discount/100},ge=()=>oe()+st(),at=async()=>{if(!Y.trim()){Q("Введіть промокод");return}Ke(!0),Q("");try{const t=await Yt.validate(Y,b.map(a=>({productId:a.productId})));qe({code:t.code,discount:t.discount,message:t.message}),Ve("")}catch(t){Q(t instanceof Error?t.message:"Помилка застосування промокоду"),qe(null)}finally{Ke(!1)}},M=U()-ge(),Ne=t=>Math.round(t).toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),W=typeof y.free_delivery_threshold=="number"?y.free_delivery_threshold:parseInt(String(y.free_delivery_threshold||"1500"))||1500,X=M>=W?s.deliveryMethod==="pickup"?{price:0,text:"Безкоштовно",showFree:!1}:{price:0,text:"Безкоштовно",showFree:!1}:s.deliveryMethod==="nova_poshta"?{price:60,text:"від 60 ₴",showFree:!0}:s.deliveryMethod==="ukr_poshta"?{price:45,text:"від 45 ₴",showFree:!0}:s.deliveryMethod==="pickup"?{price:0,text:"Безкоштовно",showFree:!1}:null,Vt=s.deliveryMethod==="nova_poshta"?"Доставка Нова Пошта:":s.deliveryMethod==="ukr_poshta"?"Доставка Укрпошта:":s.deliveryMethod==="pickup"?"Самовивіз:":"Доставка:",g=b.map(t=>{const a=Nt.find(o=>o.code===t.productId);return{...t,product:a}}).filter(t=>t.product);return b.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(ss,{className:"w-16 h-16 mx-auto text-muted-foreground"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Кошик порожній"}),e.jsx("p",{className:"text-muted-foreground",children:"Додайте товари для оформлення замовлення"}),e.jsx(E,{onClick:()=>ae("/"),className:"rounded-full",children:"Повернутися до покупок"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(Ht,{children:[e.jsx("title",{children:"Оформлення замовлення | FetrInUA"}),e.jsx("meta",{property:"og:title",content:"Оформлення замовлення | FetrInUA"}),e.jsx("meta",{name:"robots",content:"noindex"})]}),e.jsxs("div",{className:"min-h-screen bg-muted/30",children:[e.jsx("header",{className:"bg-background border-b sticky top-0 z-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-4",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>ae(-1),className:"rounded-full",children:e.jsx(as,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"Оформлення замовлення"})]})}),e.jsxs("div",{className:"container mx-auto px-4 pb-8",style:{paddingTop:"22px"},children:[e.jsx("div",{className:"mb-6 lg:hidden",children:e.jsxs("div",{className:"bg-card rounded-2xl shadow-soft overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 p-4 pb-0",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Замовлення"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[b.length," товара"]})]}),g.length>1?e.jsx("div",{className:"overflow-x-auto order-items-scroll",style:{paddingLeft:"1rem",paddingRight:"14px",paddingBottom:"0.75rem",WebkitOverflowScrolling:"touch",marginRight:"-1rem"},children:e.jsx("ul",{className:"flex gap-4",style:{width:"max-content"},children:g.map((t,a)=>{const o=t.product,r=t.selectedOptions.map(l=>o.options.find(h=>h.code===l)).filter(Boolean),p=r.reduce((l,h)=>l+((h==null?void 0:h.price)||0),0),i=o.salePrice||o.basePrice,d=o.basePrice,x=o.salePrice&&o.salePrice<d,m=i+p;return e.jsx("li",{style:{width:"265px",flexShrink:0},children:e.jsx("div",{className:"bg-background rounded-xl p-3 border border-border",children:e.jsxs("div",{className:"flex gap-3",style:{alignContent:"space-between",marginLeft:"calc(4px / 2 * -1)",marginRight:"calc(4px / 2 * -1)",display:"flex",flexWrap:"wrap",minWidth:0},children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-[88px] h-[90px] rounded-lg overflow-hidden",children:e.jsx("img",{src:o.images[0],alt:o.name,className:"w-full h-full object-cover",loading:"lazy"})})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm mb-1 line-clamp-2",style:{fontSize:"0.875rem"},children:o.name}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-1",children:[t.quantity," шт.",r.length>0&&e.jsxs("span",{children:[" + ",r.length," ",r.length===1?"опція":"опції"]})]})]}),e.jsx("div",{className:"mt-auto",children:x?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold text-destructive",style:{fontSize:"0.875rem"},children:[m," ₴/шт."]}),e.jsxs("div",{className:"text-xs text-muted-foreground line-through",style:{fontSize:"0.75rem"},children:[d+p," ₴/шт."]})]}):e.jsxs("div",{className:"text-sm font-semibold",style:{fontSize:"0.875rem"},children:[m," ₴/шт."]})})]})]})})},t.id||`${t.productId}_${a}`)})})}):g.length===1?e.jsx("div",{className:"p-4 pt-0",children:g.map((t,a)=>{const o=t.product,r=t.selectedOptions.map(l=>o.options.find(h=>h.code===l)).filter(Boolean),p=r.reduce((l,h)=>l+((h==null?void 0:h.price)||0),0),i=o.salePrice||o.basePrice,d=o.basePrice,x=o.salePrice&&o.salePrice<d,m=i+p;return e.jsx("div",{className:"bg-background rounded-xl p-3 border border-border",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-[88px] h-[90px] rounded-lg overflow-hidden",children:e.jsx("img",{src:o.images[0],alt:o.name,className:"w-full h-full object-cover",loading:"lazy"})})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm mb-1 line-clamp-2",style:{fontSize:"0.875rem"},children:o.name}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-1",children:[t.quantity," шт.",r.length>0&&e.jsxs("span",{children:[" + ",r.length," ",r.length===1?"опція":"опції"]})]})]}),e.jsx("div",{className:"mt-auto",children:x?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold text-destructive",style:{fontSize:"0.875rem"},children:[m," ₴/шт."]}),e.jsxs("div",{className:"text-xs text-muted-foreground line-through",style:{fontSize:"0.75rem"},children:[d+p," ₴/шт."]})]}):e.jsxs("div",{className:"text-sm font-semibold",style:{fontSize:"0.875rem"},children:[m," ₴/шт."]})})]})]})},t.id||`${t.productId}_${a}`)})}):null]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("form",{onSubmit:tt,className:"space-y-6",children:[e.jsxs("div",{ref:He,className:"bg-card rounded-2xl p-6 shadow-soft space-y-4 border",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2 cursor-pointer",onClick:()=>{A&&n(t=>({...t,contactInfoExpanded:!t.contactInfoExpanded}))},children:[A?e.jsx(P,{className:"w-6 h-6 text-green-500"}):s.phone||s.firstName||s.lastName?e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white flex items-center justify-center text-sm font-medium",children:"1"}):e.jsx("span",{className:"w-6 h-6 rounded-full bg-primary text-white flex items-center justify-center text-sm",children:"1"}),"Контактні дані *"]}),A&&s.contactInfoCompleted&&!s.contactInfoExpanded?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Замовник"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[s.lastName," ",s.firstName]}),e.jsx("button",{type:"button",onClick:()=>{n(t=>({...t,contactInfoExpanded:!0})),setTimeout(()=>{var t;(t=He.current)==null||t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},150)},className:"text-muted-foreground hover:text-primary",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm",children:s.phone})]}),s.hasDifferentRecipient&&s.recipientFirstName&&s.recipientLastName&&e.jsxs("div",{className:"space-y-1 pt-2 border-t",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Отримувач"}),e.jsxs("div",{className:"text-sm",children:[s.recipientLastName," ",s.recipientFirstName]}),e.jsx("div",{className:"text-sm",children:s.recipientPhone})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"phone",children:"Телефон *"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{ref:D,id:"phone",name:"phone",type:"tel",value:s.phone===""?"+380":s.phone,onChange:Dt,onKeyDown:St,onFocus:Tt,onBlur:Ft,placeholder:"+380",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${s.phone===""||s.phone==="+380"?"text-muted-foreground":""} ${K&&re?"border-red-500":""}`}),Ge&&e.jsx(P,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),K&&re&&e.jsx("p",{className:"text-sm text-red-500",children:re})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"lastName",children:"Прізвище *"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{id:"lastName",name:"lastName",value:s.lastName,onChange:It,onBlur:()=>{ie(!0),s.lastName.trim()===""?S("Це обов'язкове поле"):v(s.lastName)?S(""):S("Використовуйте тільки кириличні символи")},placeholder:"Введіть прізвище кирилицею",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${Be&&le?"border-red-500":""}`}),Je&&e.jsx(P,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),Be&&le&&e.jsx("p",{className:"text-sm text-red-500",children:le})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"firstName",children:"Ім'я *"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{id:"firstName",name:"firstName",value:s.firstName,onChange:_t,onBlur:()=>{ce(!0),s.firstName.trim()===""?T("Це обов'язкове поле"):v(s.firstName)?T(""):T("Використовуйте тільки кириличні символи")},placeholder:"Введіть Ім'я кирилицею",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${Le&&de?"border-red-500":""}`}),Ye&&e.jsx(P,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),Le&&de&&e.jsx("p",{className:"text-sm text-red-500",children:de})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(Zt,{id:"hasDifferentRecipient",checked:s.hasDifferentRecipient,onCheckedChange:t=>{n(a=>({...a,hasDifferentRecipient:t,...t?{}:{recipientFirstName:"",recipientLastName:"",recipientPhone:""}})),t||(J(!1),w(""),G(!1),C(""),$e(!1),Ct(""))}}),e.jsxs(k,{htmlFor:"hasDifferentRecipient",className:"text-sm font-normal cursor-pointer flex items-center gap-1",children:["Інший отримувач замовлення",e.jsx("span",{className:"text-muted-foreground",children:"?"})]})]}),s.hasDifferentRecipient&&e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"recipientPhone",children:"Номер телефону отримувача *"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{ref:F,id:"recipientPhone",name:"recipientPhone",type:"tel",value:s.recipientPhone===""?"+380":s.recipientPhone,onChange:Wt,onKeyDown:Bt,onFocus:Lt,onBlur:$t,placeholder:"+380",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${s.recipientPhone===""||s.recipientPhone==="+380"?"text-muted-foreground":""} ${H&&he?"border-red-500":""}`}),Qe&&e.jsx(P,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),H&&he&&e.jsx("p",{className:"text-sm text-red-500",children:he})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"recipientLastName",children:"Прізвище отримувача *"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{id:"recipientLastName",name:"recipientLastName",value:s.recipientLastName,onChange:Ot,onBlur:()=>{G(!0),s.recipientLastName.trim()===""?C("Це обов'язкове поле"):v(s.recipientLastName)?C(""):C("Використовуйте тільки кириличні символи")},placeholder:"Введіть прізвище кирилицею",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${Ae&&me?"border-red-500":""}`}),Xe&&e.jsx(P,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),Ae&&me&&e.jsx("p",{className:"text-sm text-red-500",children:me})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"recipientFirstName",children:"Ім'я отримувача *"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{id:"recipientFirstName",name:"recipientFirstName",value:s.recipientFirstName,onChange:Mt,onBlur:()=>{J(!0),s.recipientFirstName.trim()===""?w("Це обов'язкове поле"):v(s.recipientFirstName)?w(""):w("Використовуйте тільки кириличні символи")},placeholder:"Введіть Ім'я кирилицею",required:!0,className:`rounded-xl pr-10 focus-visible:ring-0 focus-visible:ring-offset-0 ${ze&&ue?"border-red-500":""}`}),Ze&&e.jsx(P,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),ze&&ue&&e.jsx("p",{className:"text-sm text-red-500",children:ue})]})]})]}),e.jsx(E,{type:"button",variant:"outline",disabled:!A,className:"w-full rounded-xl border h-10 hover:border hover:bg-transparent hover:text-primary disabled:hover:text-primary disabled:opacity-50",onClick:()=>{A&&n(t=>({...t,contactInfoCompleted:!0,contactInfoExpanded:!1}))},children:"Продовжити"})]})]}),e.jsxs("div",{className:"bg-card rounded-2xl p-6 shadow-soft space-y-4",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2 cursor-pointer",onClick:()=>{var t;s.deliveryMethod&&((t=z())!=null&&t.completed)&&n(a=>({...a,deliveryExpanded:!a.deliveryExpanded}))},children:[s.deliveryMethod&&((pt=z())!=null&&pt.completed)?e.jsx(P,{className:"w-6 h-6 text-green-500"}):e.jsx("span",{className:"w-6 h-6 rounded-full bg-primary text-white flex items-center justify-center text-sm",children:"2"}),"Доставка *"]}),s.deliveryExpanded?e.jsxs(ft,{value:s.deliveryMethod,onValueChange:t=>{t&&!s.deliveryMethod&&N({stage:"selected_delivery"}),n(a=>a.deliveryMethod===t&&t==="nova_poshta"&&a.novaPoshtaExpanded===!1?{...a,novaPoshtaExpanded:!0}:t==="pickup"?(N({stage:"filled_delivery"}),{...a,deliveryMethod:t,pickupCompleted:!0,deliveryExpanded:!1,novaPoshtaExpanded:void 0}):{...a,deliveryMethod:t,novaPoshtaExpanded:t==="nova_poshta"?!0:void 0})},className:"space-y-3",children:[e.jsxs("div",{className:"border rounded-xl transition-all",onClick:t=>{s.deliveryMethod==="nova_poshta"&&s.novaPoshtaExpanded===!1&&(t.stopPropagation(),n(a=>({...a,novaPoshtaExpanded:!0})))},children:[e.jsxs("label",{className:"flex flex-col gap-2 p-4 cursor-pointer hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{value:"nova_poshta",id:"nova_poshta"}),e.jsxs("div",{className:"font-medium flex items-center gap-2 flex-1",children:[e.jsx(je,{className:"w-5 h-5"}),Ie]}),e.jsx("div",{className:"text-sm font-medium",children:M>=W?e.jsx("span",{className:"text-green-600",children:"Безкоштовно"}):"від 60 ₴"})]}),e.jsx("div",{className:"ml-[28px]",children:(()=>{const t=et("nova_poshta"),o=s.deliveryMethod==="nova_poshta"&&s.novaPoshtaExpanded===!1&&(t==null?void 0:t.completed)&&t.city&&t.warehouse,r=s.deliveryMethod!=="nova_poshta"&&(t==null?void 0:t.completed)&&t.city&&t.warehouse;return o||r?e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("div",{className:"text-foreground",children:t.city}),e.jsx("div",{className:"text-foreground",children:t.warehouse})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:jt})})()})]}),s.deliveryMethod==="nova_poshta"&&s.novaPoshtaExpanded!==!1&&e.jsx("div",{className:"pl-4 pr-4 pb-4",children:e.jsx(Qt,{cityRef:s.novaPoshtaCityRef,warehouseRef:s.novaPoshtaDeliveryType==="PostOffice"?s.novaPoshtaPostOfficeWarehouseRef:s.novaPoshtaPostomatWarehouseRef,deliveryType:s.novaPoshtaDeliveryType,isExpanded:!0,onCityChange:t=>{n(a=>({...a,novaPoshtaCity:t?t.full_description_ua:"",novaPoshtaCityRef:t?t.ref:null,novaPoshtaPostOfficeWarehouse:"",novaPoshtaPostOfficeWarehouseRef:null,novaPoshtaPostOfficeCompleted:!1,novaPoshtaPostomatWarehouse:"",novaPoshtaPostomatWarehouseRef:null,novaPoshtaPostomatCompleted:!1}))},onWarehouseChange:t=>{n(a=>a.novaPoshtaDeliveryType==="PostOffice"?{...a,novaPoshtaPostOfficeWarehouse:t?t.description_ua:"",novaPoshtaPostOfficeWarehouseRef:t?t.ref:null,novaPoshtaPostOfficeCompleted:!!t}:{...a,novaPoshtaPostomatWarehouse:t?t.description_ua:"",novaPoshtaPostomatWarehouseRef:t?t.ref:null,novaPoshtaPostomatCompleted:!!t})},onDeliveryTypeChange:t=>{n(a=>t==="PostOffice"?{...a,novaPoshtaDeliveryType:t,novaPoshtaPostOfficeCompleted:!!a.novaPoshtaPostOfficeWarehouseRef}:{...a,novaPoshtaDeliveryType:t,novaPoshtaPostomatCompleted:!!a.novaPoshtaPostomatWarehouseRef})},onContinue:()=>{n(t=>({...t,novaPoshtaExpanded:!1,deliveryExpanded:!1,...t.novaPoshtaDeliveryType==="PostOffice"?{novaPoshtaPostOfficeCompleted:!0}:{novaPoshtaPostomatCompleted:!0}}))}})})]}),e.jsxs("div",{className:"border rounded-xl transition-all",onClick:t=>{s.deliveryMethod==="ukr_poshta"&&s.ukrPoshtaExpanded===!1&&(t.stopPropagation(),n(a=>({...a,ukrPoshtaExpanded:!0})))},children:[e.jsxs("label",{className:"flex flex-col gap-2 p-4 cursor-pointer hover:border-primary transition-colors w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{value:"ukr_poshta",id:"ukr_poshta"}),e.jsxs("div",{className:"font-medium flex items-center gap-2 flex-1",children:[e.jsx(ke,{className:"w-5 h-5"}),_e]}),e.jsx("div",{className:"text-sm font-medium",children:M>=W?e.jsx("span",{className:"text-green-600",children:"Безкоштовно"}):"від 45 грн"})]}),e.jsx("div",{className:"ml-[28px] w-full",children:(()=>{const t=et("ukr_poshta"),o=s.deliveryMethod==="ukr_poshta"&&s.ukrPoshtaExpanded===!1&&(t==null?void 0:t.completed)&&t.city,r=s.deliveryMethod!=="ukr_poshta"&&(t==null?void 0:t.completed)&&t.city;if(o||r){const p=t.city||(t.cityRegion?`${t.city} (${t.cityRegion})`:t.city),i=t.cityRegion?t.city.replace(` (${t.cityRegion})`,""):t.city,d=t.postalCode&&t.address?`${t.postalCode} ${i}, ${t.address}`:t.branch||"";return e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("div",{className:"text-foreground",children:p}),d&&e.jsx("div",{className:"text-foreground",children:d})]})}return e.jsx("div",{className:"text-sm text-muted-foreground",children:kt})})()})]}),s.deliveryMethod==="ukr_poshta"&&s.ukrPoshtaExpanded!==!1&&e.jsx("div",{className:"pl-4 pr-4 pb-4",children:e.jsx(Xt,{cityId:s.ukrPoshtaCityId,branchId:s.ukrPoshtaBranchId,savedCityName:s.ukrPoshtaCity,savedCityRegion:s.ukrPoshtaCityRegion,savedBranchName:s.ukrPoshtaBranch,savedBranchAddress:s.ukrPoshtaAddress,savedBranchPostalCode:s.ukrPoshtaPostalCode,isExpanded:!0,onCityChange:t=>{const a=t?t.region&&t.region.trim()!==""?`${t.name} (${t.region})`:`${t.name} (*)`:"";n(o=>({...o,ukrPoshtaCity:a,ukrPoshtaCityId:t?t.id:null,ukrPoshtaCityRegion:t&&t.region||"",ukrPoshtaBranch:"",ukrPoshtaBranchId:null,ukrPoshtaPostalCode:"",ukrPoshtaAddress:"",ukrPoshtaCompleted:!1}))},onBranchChange:t=>{n(a=>({...a,ukrPoshtaBranch:t?t.name:"",ukrPoshtaBranchId:t?t.id:null,ukrPoshtaPostalCode:t?t.postalCode:"",ukrPoshtaAddress:t?t.address:"",ukrPoshtaCompleted:!!t}))},onContinue:()=>{n(t=>({...t,ukrPoshtaExpanded:!1,ukrPoshtaCompleted:!0,deliveryExpanded:!1}))}})})]}),e.jsxs("div",{className:"border rounded-xl transition-all",children:[e.jsxs("label",{className:"flex flex-col gap-2 p-4 cursor-pointer hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{value:"pickup",id:"pickup"}),e.jsxs("div",{className:"font-medium flex items-center gap-2 flex-1",children:[e.jsx(be,{className:"w-5 h-5"}),De]}),e.jsx("div",{className:"text-sm font-medium",children:(()=>{const t=M>=W?{text:"Безкоштовно",price:0}:{text:"від 60 грн",price:60};return e.jsx("span",{className:t.price===0?"text-green-600":"",children:t.text})})()})]}),e.jsx("div",{className:"ml-[28px]",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:y.store_address||"м. Київ, вул. Урлівська 30"})})]}),s.deliveryMethod==="pickup"&&e.jsxs("div",{className:"pl-4 pr-4 pb-4",children:[e.jsx("div",{className:"font-medium mb-1",children:"Адреса самовивозу:"}),e.jsx("div",{className:"text-muted-foreground",children:y.store_address||"м. Київ, вул. Урлівська 30"}),y.store_working_hours_weekdays&&e.jsx("div",{className:"text-sm text-muted-foreground mt-2 whitespace-pre-line",children:y.store_working_hours_weekdays}),y.store_working_hours_weekend&&e.jsx("div",{className:"text-sm text-muted-foreground/60 mt-1 whitespace-pre-line",children:y.store_working_hours_weekend})]})]})]}):e.jsx("div",{className:"space-y-2",children:(()=>{const t=z();if(s.deliveryMethod==="nova_poshta"&&t)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),Ie]}),e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),n(o=>({...o,deliveryExpanded:!0})),setTimeout(()=>{var o;(o=ye.current)==null||o.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},150)},className:"text-muted-foreground hover:text-primary",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm",children:t.city}),e.jsx("div",{className:"text-sm",children:t.warehouse})]});if(s.deliveryMethod==="ukr_poshta"&&t){const a=t.city||(t.cityRegion?`${t.city} (${t.cityRegion})`:t.city),o=t.cityRegion?t.city.replace(` (${t.cityRegion})`,""):t.city,r=t.postalCode&&t.address?`${t.postalCode} ${o}, ${t.address}`:t.branch||"";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5"}),_e]}),e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),n(i=>({...i,deliveryExpanded:!0})),setTimeout(()=>{var i;(i=ye.current)==null||i.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},150)},className:"text-muted-foreground hover:text-primary",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm",children:a}),r&&e.jsx("div",{className:"text-sm",children:r})]})}else if(s.deliveryMethod==="pickup")return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),De]}),e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),n(o=>({...o,deliveryExpanded:!0})),setTimeout(()=>{var o;(o=ye.current)==null||o.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},150)},className:"text-muted-foreground hover:text-primary",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm",children:y.store_address||"м. Київ, вул. Урлівська 30"})]});return null})()})]}),e.jsxs("div",{className:"bg-card rounded-2xl p-6 shadow-soft space-y-4",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2 cursor-pointer",onClick:()=>{s.paymentCompleted&&n(t=>({...t,paymentExpanded:!t.paymentExpanded}))},children:[s.paymentCompleted?e.jsx(P,{className:"w-6 h-6 text-green-500"}):e.jsx("span",{className:"w-6 h-6 rounded-full bg-primary text-white flex items-center justify-center text-sm",children:"3"}),"Спосіб оплати *"]}),s.paymentCompleted&&!s.paymentExpanded?e.jsxs("div",{className:"space-y-2",children:[s.paymentMethod==="wayforpay"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5"}),Se]}),e.jsx("button",{type:"button",onClick:()=>{n(t=>({...t,paymentExpanded:!0})),setTimeout(()=>{var t;(t=Pe.current)==null||t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},150)},className:"text-muted-foreground hover:text-primary",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Te})]}),s.paymentMethod==="nalojka"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(yt,{className:"w-5 h-5"}),Fe]}),e.jsx("button",{type:"button",onClick:()=>{n(t=>({...t,paymentExpanded:!0})),setTimeout(()=>{var t;(t=Pe.current)==null||t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},150)},className:"text-muted-foreground hover:text-primary",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:We})]}),s.paymentMethod==="fopiban"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Pt,{className:"w-5 h-5"}),Oe]}),e.jsx("button",{type:"button",onClick:()=>{n(t=>({...t,paymentExpanded:!0})),setTimeout(()=>{var t;(t=Pe.current)==null||t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},150)},className:"text-muted-foreground hover:text-primary",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Me})]})]}):e.jsxs(ft,{value:s.paymentMethod,onValueChange:t=>{t&&!s.paymentMethod&&N({stage:"selected_payment"}),n(a=>({...a,paymentMethod:t,paymentCompleted:!0,paymentExpanded:!1}))},className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 p-4 border rounded-xl cursor-pointer hover:border-primary transition-colors",children:[e.jsx($,{value:"wayforpay",id:"wayforpay"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5"}),Se]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Te})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-4 border rounded-xl cursor-pointer hover:border-primary transition-colors",children:[e.jsx($,{value:"nalojka",id:"nalojka"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx(yt,{className:"w-5 h-5"}),Fe]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:We})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-4 border rounded-xl cursor-pointer hover:border-primary transition-colors",children:[e.jsx($,{value:"fopiban",id:"fopiban"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx(Pt,{className:"w-5 h-5"}),Oe]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Me})]})]})]})]}),e.jsx(E,{type:"button",variant:"outline",onClick:()=>{n(t=>({...t,deliveryMethod:"",deliveryExpanded:!0,paymentMethod:"",paymentCompleted:!1,paymentExpanded:!0,novaPoshtaCity:"",novaPoshtaCityRef:null,novaPoshtaPostOfficeWarehouse:"",novaPoshtaPostOfficeWarehouseRef:null,novaPoshtaPostOfficeCompleted:!1,novaPoshtaPostomatWarehouse:"",novaPoshtaPostomatWarehouseRef:null,novaPoshtaPostomatCompleted:!1,ukrPoshtaCity:"",ukrPoshtaCityId:null,ukrPoshtaCityRegion:"",ukrPoshtaBranch:"",ukrPoshtaBranchId:null,ukrPoshtaPostalCode:"",ukrPoshtaAddress:"",ukrPoshtaCompleted:!1,pickupCompleted:!1}))},className:"w-full rounded-xl border border-muted-foreground/30 text-muted-foreground hover:text-foreground hover:border-primary bg-transparent hover:bg-transparent active:bg-transparent",children:"Скинути вибрані способи"}),e.jsxs("div",{className:"bg-card rounded-2xl p-6 shadow-soft space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>{n(t=>({...t,commentExpanded:!t.commentExpanded}))},children:[e.jsx(k,{htmlFor:"comment",className:"cursor-pointer",children:"Коментар до замовлення"}),s.commentExpanded?e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(se,{className:"w-4 h-4 text-muted-foreground"})]}),s.commentExpanded?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{id:"comment",name:"comment",value:s.comment,onChange:zt,placeholder:"Введіть коментар",maxLength:254,className:"w-full min-h-[100px] p-3 border border-input rounded-xl resize-none focus:outline-none focus:border-primary focus-visible:border-primary focus-visible:ring-0 focus-visible:ring-offset-0 bg-background"}),e.jsxs("div",{className:"text-sm text-muted-foreground text-left",children:["Залишилось символів: ",254-s.comment.length]}),e.jsx(E,{type:"button",variant:"outline",className:"w-full rounded-xl border h-10 hover:border hover:bg-transparent hover:text-primary disabled:hover:text-primary disabled:opacity-50",onClick:()=>{n(t=>({...t,commentExpanded:!1}))},children:"Зберегти"})]}):s.comment&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.comment.length>100?s.comment.substring(0,100)+"...":s.comment})]})]})}),e.jsx("div",{className:"lg:col-span-1","data-order-summary":!0,children:e.jsxs("div",{className:"sticky top-24 space-y-4",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft order-items-container",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Замовлення"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[b.length," товара"]})]}),g.length>1?e.jsx("div",{className:"overflow-x-auto order-items-scroll",style:{paddingTop:"0.5rem",paddingRight:"14px",WebkitOverflowScrolling:"touch",marginRight:"-1rem"},children:e.jsx("ul",{className:"flex gap-4",style:{width:"max-content"},children:g.map((t,a)=>{const o=t.product,r=t.selectedOptions.map(l=>o.options.find(h=>h.code===l)).filter(Boolean),p=r.reduce((l,h)=>l+((h==null?void 0:h.price)||0),0),i=o.salePrice||o.basePrice,d=o.basePrice,x=o.salePrice&&o.salePrice<d,m=i+p;return e.jsx("li",{style:{flexBasis:"265px",flexShrink:0},children:e.jsx("div",{className:"bg-background rounded-xl p-3 border border-border",children:e.jsxs("div",{className:"flex gap-3",style:{alignContent:"space-between",marginLeft:"calc(4px / 2 * -1)",marginRight:"calc(4px / 2 * -1)",display:"flex",flexWrap:"wrap",minWidth:0},children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-[88px] h-[90px] rounded-lg overflow-hidden",children:e.jsx("img",{src:o.images[0],alt:o.name,className:"w-full h-full object-cover",loading:"lazy"})})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm mb-1 line-clamp-2",style:{fontSize:"0.875rem"},children:o.name}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-1",children:[t.quantity," шт.",r.length>0&&e.jsxs("span",{children:[" + ",r.length," ",r.length===1?"опція":"опції"]})]})]}),e.jsx("div",{className:"mt-auto",children:x?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold text-destructive",style:{fontSize:"0.875rem"},children:[m," ₴/шт."]}),e.jsxs("div",{className:"text-xs text-muted-foreground line-through",style:{fontSize:"0.75rem"},children:[d+p," ₴/шт."]})]}):e.jsxs("div",{className:"text-sm font-semibold",style:{fontSize:"0.875rem"},children:[m," ₴/шт."]})})]})]})})},t.id||`${t.productId}_${a}`)})})}):g.length===1?e.jsx("div",{children:g.map((t,a)=>{const o=t.product,r=t.selectedOptions.map(l=>o.options.find(h=>h.code===l)).filter(Boolean),p=r.reduce((l,h)=>l+((h==null?void 0:h.price)||0),0),i=o.salePrice||o.basePrice,d=o.basePrice,x=o.salePrice&&o.salePrice<d,m=i+p;return e.jsx("div",{className:"bg-background rounded-xl p-3 border border-border",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-[88px] h-[90px] rounded-lg overflow-hidden",children:e.jsx("img",{src:o.images[0],alt:o.name,className:"w-full h-full object-cover",loading:"lazy"})})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm mb-1 line-clamp-2",style:{fontSize:"0.875rem"},children:o.name}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-1",children:[t.quantity," шт.",r.length>0&&e.jsxs("span",{children:[" + ",r.length," ",r.length===1?"опція":"опції"]})]})]}),e.jsx("div",{className:"mt-auto",children:x?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold text-destructive",style:{fontSize:"0.875rem"},children:[m," ₴/шт."]}),e.jsxs("div",{className:"text-xs text-muted-foreground line-through",style:{fontSize:"0.75rem"},children:[d+p," ₴/шт."]})]}):e.jsxs("div",{className:"text-sm font-semibold",style:{fontSize:"0.875rem"},children:[m," ₴/шт."]})})]})]})},t.id||`${t.productId}_${a}`)})}):null]})}),e.jsxs("div",{className:"bg-card rounded-2xl p-6 shadow-soft space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Вартість замовлення:"}),e.jsxs("span",{children:[Ne(U())," ₴"]})]}),(oe()>0||st()>0)&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Знижка:"}),e.jsxs("span",{className:"text-red-600",children:["-",Ne(ge())," ₴"]})]}),s.deliveryMethod&&X&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-2",children:[s.deliveryMethod==="nova_poshta"&&e.jsx(je,{className:"w-4 h-4"}),s.deliveryMethod==="ukr_poshta"&&e.jsx(ke,{className:"w-4 h-4"}),s.deliveryMethod==="pickup"&&e.jsx(be,{className:"w-4 h-4"}),Vt]}),e.jsx("span",{className:X.price===0?"text-green-600":"",children:X.text})]}),X.showFree&&e.jsxs("div",{className:"text-sm text-green-600",children:["Безкоштовна доставка від ",W," ₴"]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[e.jsx("span",{children:M>=W?"До оплати з доставкою:":"До оплати без доставки:"}),e.jsxs("span",{className:"text-primary",children:[Ne(M)," ₴"]})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(E,{type:"submit",size:"lg",className:"w-full rounded-xl",disabled:Re,onClick:tt,children:Re?"Обробка...":"Оформити замовлення"})}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4 border-t justify-center text-muted-foreground",style:{fontSize:"0.85rem"},children:[e.jsx("span",{children:"🔒 Безпечна оплата"}),e.jsx("span",{children:"📦 Швидка доставка"}),e.jsx("span",{children:"↩️ 14 днів повернення"})]})]}),e.jsxs("div",{className:"bg-card/50 rounded-2xl p-4 shadow-soft space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>wt(!pe),children:[e.jsx("h3",{className:"font-medium text-muted-foreground text-sm",children:"Ввести промокод"}),pe?e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(se,{className:"w-4 h-4 text-muted-foreground"})]}),pe&&e.jsx("div",{className:"space-y-3",children:R?e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:R.message})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{type:"text",placeholder:"Промокод",value:Y,onChange:t=>{Ve(t.target.value),Q("")},className:`rounded-xl ${xe?"border-red-500":""}`,onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),at())}}),xe&&e.jsx("p",{className:"text-sm text-red-500",children:xe}),e.jsx(E,{type:"button",variant:"outline",onClick:at,disabled:!Y.trim()||Ue,className:"w-full rounded-xl border h-10 hover:border hover:bg-transparent hover:text-primary disabled:hover:text-primary disabled:opacity-50",children:Ue?"Застосування...":"Застосувати"})]})})]}),e.jsxs("div",{className:"space-y-3",style:{fontSize:"0.8rem"},children:[e.jsx("p",{className:"text-muted-foreground",children:"Натискаючи кнопку «Оформити замовлення», я погоджуюсь з правилами та умовами нижче"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>Rt(!fe),children:[e.jsx("span",{className:"font-medium",children:"Правила та умови"}),fe?e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(se,{className:"w-4 h-4 text-muted-foreground"})]}),fe&&e.jsxs("div",{className:"pt-2 space-y-2 text-muted-foreground",children:[e.jsx("p",{children:"Оформлюючи/оплачуючи замовлення, користувач підтверджує, що надає:"}),e.jsxs("p",{children:["Згоду з ",e.jsx("a",{href:"/privacy-policy",target:"_blank",className:"text-primary hover:underline",children:"Політикою конфіденційності"})," та ",e.jsx("a",{href:"/terms-of-use",target:"_blank",className:"text-primary hover:underline",children:"Угодою користувача"}),"."]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>Et(!ve),children:[e.jsx("span",{className:"font-medium",children:"*Отримувач коштів"}),ve?e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(se,{className:"w-4 h-4 text-muted-foreground"})]}),ve&&e.jsx("div",{className:"pt-2 text-muted-foreground",children:e.jsx("p",{children:"за замовлення: ФОП Пітальов Олександр Миколайович, 3078718311, UA383052990000026008046715224"})})]})]})]})]})})]})]})]})]})};export{Es as default};
