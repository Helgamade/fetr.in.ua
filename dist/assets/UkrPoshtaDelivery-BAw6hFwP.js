import{c as He,o as et,h as re,m as z,i as le,N as tt,P as Y,k as K,j as rt,l as ot,$ as ge,b as w,n as he,Y as V,Z as $}from"./index-qIZ-igm2.js";import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as o}from"./chunk-charts-BaLkbnPn.js";import{u as ve}from"./index-ZeZSZmiz.js";import{C as Q}from"./check-CX-rtqWT.js";import{I as H}from"./input-DvTeUCr4.js";import{u as ye}from"./index-D4-djExh.js";import{C as st}from"./circle-DMipOzOT.js";import{B as be}from"./button-jMkIzXt0.js";import{C as ee}from"./chevron-down-8V8CEeyD.js";import{S as te}from"./search-BnA5AzqW.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Vt=He("pencil",nt);var ae="rovingFocusGroup.onEntryFocus",at={bubbles:!1,cancelable:!0},X="RovingFocusGroup",[ie,Ne,it]=et(X),[ct,Ce]=re(X,[it]),[lt,dt]=ct(X),Ie=o.forwardRef((t,r)=>e.jsx(ie.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(ie.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(ut,{...t,ref:r})})}));Ie.displayName=X;var ut=o.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:s,orientation:i,loop:u=!1,dir:f,currentTabStopId:y,defaultCurrentTabStopId:I,onCurrentTabStopIdChange:p,onEntryFocus:h,preventScrollOnEntryFocus:x=!1,...g}=t,N=o.useRef(null),v=z(r,N),c=ye(f),[k,l]=le({prop:y,defaultProp:I??null,onChange:p,caller:X}),[a,C]=o.useState(!1),b=tt(h),j=Ne(s),E=o.useRef(!1),[D,R]=o.useState(0);return o.useEffect(()=>{const S=N.current;if(S)return S.addEventListener(ae,b),()=>S.removeEventListener(ae,b)},[b]),e.jsx(lt,{scope:s,orientation:i,dir:c,loop:u,currentTabStopId:k,onItemFocus:o.useCallback(S=>l(S),[l]),onItemShiftTab:o.useCallback(()=>C(!0),[]),onFocusableItemAdd:o.useCallback(()=>R(S=>S+1),[]),onFocusableItemRemove:o.useCallback(()=>R(S=>S-1),[]),children:e.jsx(Y.div,{tabIndex:a||D===0?-1:0,"data-orientation":i,...g,ref:v,style:{outline:"none",...t.style},onMouseDown:K(t.onMouseDown,()=>{E.current=!0}),onFocus:K(t.onFocus,S=>{const _=!E.current;if(S.target===S.currentTarget&&_&&!a){const L=new CustomEvent(ae,at);if(S.currentTarget.dispatchEvent(L),!L.defaultPrevented){const A=j().filter(U=>U.focusable),G=A.find(U=>U.active),d=A.find(U=>U.id===k),Z=[G,d,...A].filter(Boolean).map(U=>U.ref.current);Se(Z,x)}}E.current=!1}),onBlur:K(t.onBlur,()=>C(!1))})})}),ke="RovingFocusGroupItem",je=o.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:s,focusable:i=!0,active:u=!1,tabStopId:f,children:y,...I}=t,p=rt(),h=f||p,x=dt(ke,s),g=x.currentTabStopId===h,N=Ne(s),{onFocusableItemAdd:v,onFocusableItemRemove:c,currentTabStopId:k}=x;return o.useEffect(()=>{if(i)return v(),()=>c()},[i,v,c]),e.jsx(ie.ItemSlot,{scope:s,id:h,focusable:i,active:u,children:e.jsx(Y.span,{tabIndex:g?0:-1,"data-orientation":x.orientation,...I,ref:r,onMouseDown:K(t.onMouseDown,l=>{i?x.onItemFocus(h):l.preventDefault()}),onFocus:K(t.onFocus,()=>x.onItemFocus(h)),onKeyDown:K(t.onKeyDown,l=>{if(l.key==="Tab"&&l.shiftKey){x.onItemShiftTab();return}if(l.target!==l.currentTarget)return;const a=pt(l,x.orientation,x.dir);if(a!==void 0){if(l.metaKey||l.ctrlKey||l.altKey||l.shiftKey)return;l.preventDefault();let b=N().filter(j=>j.focusable).map(j=>j.ref.current);if(a==="last")b.reverse();else if(a==="prev"||a==="next"){a==="prev"&&b.reverse();const j=b.indexOf(l.currentTarget);b=x.loop?ht(b,j+1):b.slice(j+1)}setTimeout(()=>Se(b))}}),children:typeof y=="function"?y({isCurrentTabStop:g,hasTabStop:k!=null}):y})})});je.displayName=ke;var ft={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function mt(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function pt(t,r,s){const i=mt(t.key,s);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(i))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(i)))return ft[i]}function Se(t,r=!1){const s=document.activeElement;for(const i of t)if(i===s||(i.focus({preventScroll:r}),document.activeElement!==s))return}function ht(t,r){return t.map((s,i)=>t[(r+i)%t.length])}var xt=Ie,gt=je,de="Radio",[vt,Pe]=re(de),[yt,bt]=vt(de),we=o.forwardRef((t,r)=>{const{__scopeRadio:s,name:i,checked:u=!1,required:f,disabled:y,value:I="on",onCheck:p,form:h,...x}=t,[g,N]=o.useState(null),v=z(r,l=>N(l)),c=o.useRef(!1),k=g?h||!!g.closest("form"):!0;return e.jsxs(yt,{scope:s,checked:u,disabled:y,children:[e.jsx(Y.button,{type:"button",role:"radio","aria-checked":u,"data-state":_e(u),"data-disabled":y?"":void 0,disabled:y,value:I,...x,ref:v,onClick:K(t.onClick,l=>{u||p==null||p(),k&&(c.current=l.isPropagationStopped(),c.current||l.stopPropagation())})}),k&&e.jsx(De,{control:g,bubbles:!c.current,name:i,value:I,checked:u,required:f,disabled:y,form:h,style:{transform:"translateX(-100%)"}})]})});we.displayName=de;var Re="RadioIndicator",Ee=o.forwardRef((t,r)=>{const{__scopeRadio:s,forceMount:i,...u}=t,f=bt(Re,s);return e.jsx(ot,{present:i||f.checked,children:e.jsx(Y.span,{"data-state":_e(f.checked),"data-disabled":f.disabled?"":void 0,...u,ref:r})})});Ee.displayName=Re;var Nt="RadioBubbleInput",De=o.forwardRef(({__scopeRadio:t,control:r,checked:s,bubbles:i=!0,...u},f)=>{const y=o.useRef(null),I=z(y,f),p=ve(s),h=ge(r);return o.useEffect(()=>{const x=y.current;if(!x)return;const g=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(g,"checked").set;if(p!==s&&v){const c=new Event("click",{bubbles:i});v.call(x,s),x.dispatchEvent(c)}},[p,s,i]),e.jsx(Y.input,{type:"radio","aria-hidden":!0,defaultChecked:s,...u,tabIndex:-1,ref:I,style:{...u.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});De.displayName=Nt;function _e(t){return t?"checked":"unchecked"}var Ct=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],oe="RadioGroup",[It,zt]=re(oe,[Ce,Pe]),Fe=Ce(),Ae=Pe(),[kt,jt]=It(oe),Te=o.forwardRef((t,r)=>{const{__scopeRadioGroup:s,name:i,defaultValue:u,value:f,required:y=!1,disabled:I=!1,orientation:p,dir:h,loop:x=!0,onValueChange:g,...N}=t,v=Fe(s),c=ye(h),[k,l]=le({prop:f,defaultProp:u??null,onChange:g,caller:oe});return e.jsx(kt,{scope:s,name:i,required:y,disabled:I,value:k,onValueChange:l,children:e.jsx(xt,{asChild:!0,...v,orientation:p,dir:c,loop:x,children:e.jsx(Y.div,{role:"radiogroup","aria-required":y,"aria-orientation":p,"data-disabled":I?"":void 0,dir:c,...N,ref:r})})})});Te.displayName=oe;var Ue="RadioGroupItem",Oe=o.forwardRef((t,r)=>{const{__scopeRadioGroup:s,disabled:i,...u}=t,f=jt(Ue,s),y=f.disabled||i,I=Fe(s),p=Ae(s),h=o.useRef(null),x=z(r,h),g=f.value===u.value,N=o.useRef(!1);return o.useEffect(()=>{const v=k=>{Ct.includes(k.key)&&(N.current=!0)},c=()=>N.current=!1;return document.addEventListener("keydown",v),document.addEventListener("keyup",c),()=>{document.removeEventListener("keydown",v),document.removeEventListener("keyup",c)}},[]),e.jsx(gt,{asChild:!0,...I,focusable:!y,active:g,children:e.jsx(we,{disabled:y,required:f.required,checked:g,...p,...u,name:f.name,ref:x,onCheck:()=>f.onValueChange(u.value),onKeyDown:K(v=>{v.key==="Enter"&&v.preventDefault()}),onFocus:K(u.onFocus,()=>{var v;N.current&&((v=h.current)==null||v.click())})})})});Oe.displayName=Ue;var St="RadioGroupIndicator",Me=o.forwardRef((t,r)=>{const{__scopeRadioGroup:s,...i}=t,u=Ae(s);return e.jsx(Ee,{...u,...i,ref:r})});Me.displayName=St;var Le=Te,$e=Oe,Pt=Me;const Ge=o.forwardRef(({className:t,...r},s)=>e.jsx(Le,{className:w("grid gap-2",t),...r,ref:s}));Ge.displayName=Le.displayName;const ce=o.forwardRef(({className:t,...r},s)=>e.jsx($e,{ref:s,className:w("aspect-square h-4 w-4 rounded-full border border-input text-primary ring-offset-background focus:outline-none focus-visible:ring-0 focus-visible:ring-offset-0 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:border-primary",t),...r,children:e.jsx(Pt,{className:"flex items-center justify-center",children:e.jsx(st,{className:"h-2.5 w-2.5 fill-current text-current"})})}));ce.displayName=$e.displayName;function xe(t,r,{checkForDefaultPrevented:s=!0}={}){return function(u){if(t==null||t(u),s===!1||!u.defaultPrevented)return r==null?void 0:r(u)}}function wt(t,r){return o.useReducer((s,i)=>r[s][i]??s,t)}var Be=t=>{const{present:r,children:s}=t,i=Rt(r),u=typeof s=="function"?s({present:i.isPresent}):o.Children.only(s),f=z(i.ref,Et(u));return typeof s=="function"||i.isPresent?o.cloneElement(u,{ref:f}):null};Be.displayName="Presence";function Rt(t){const[r,s]=o.useState(),i=o.useRef(null),u=o.useRef(t),f=o.useRef("none"),y=t?"mounted":"unmounted",[I,p]=wt(y,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return o.useEffect(()=>{const h=J(i.current);f.current=I==="mounted"?h:"none"},[I]),he(()=>{const h=i.current,x=u.current;if(x!==t){const N=f.current,v=J(h);t?p("MOUNT"):v==="none"||(h==null?void 0:h.display)==="none"?p("UNMOUNT"):p(x&&N!==v?"ANIMATION_OUT":"UNMOUNT"),u.current=t}},[t,p]),he(()=>{if(r){let h;const x=r.ownerDocument.defaultView??window,g=v=>{const k=J(i.current).includes(CSS.escape(v.animationName));if(v.target===r&&k&&(p("ANIMATION_END"),!u.current)){const l=r.style.animationFillMode;r.style.animationFillMode="forwards",h=x.setTimeout(()=>{r.style.animationFillMode==="forwards"&&(r.style.animationFillMode=l)})}},N=v=>{v.target===r&&(f.current=J(i.current))};return r.addEventListener("animationstart",N),r.addEventListener("animationcancel",g),r.addEventListener("animationend",g),()=>{x.clearTimeout(h),r.removeEventListener("animationstart",N),r.removeEventListener("animationcancel",g),r.removeEventListener("animationend",g)}}else p("ANIMATION_END")},[r,p]),{isPresent:["mounted","unmountSuspended"].includes(I),ref:o.useCallback(h=>{i.current=h?getComputedStyle(h):null,s(h)},[])}}function J(t){return(t==null?void 0:t.animationName)||"none"}function Et(t){var i,u;let r=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,s=r&&"isReactWarning"in r&&r.isReactWarning;return s?t.ref:(r=(u=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:u.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var se="Checkbox",[Dt,Qt]=re(se),[_t,ue]=Dt(se);function Ft(t){const{__scopeCheckbox:r,checked:s,children:i,defaultChecked:u,disabled:f,form:y,name:I,onCheckedChange:p,required:h,value:x="on",internal_do_not_use_render:g}=t,[N,v]=le({prop:s,defaultProp:u??!1,onChange:p,caller:se}),[c,k]=o.useState(null),[l,a]=o.useState(null),C=o.useRef(!1),b=c?!!y||!!c.closest("form"):!0,j={checked:N,disabled:f,setChecked:v,control:c,setControl:k,name:I,form:y,value:x,hasConsumerStoppedPropagationRef:C,required:h,defaultChecked:q(u)?!1:u,isFormControl:b,bubbleInput:l,setBubbleInput:a};return e.jsx(_t,{scope:r,...j,children:At(g)?g(j):i})}var Ke="CheckboxTrigger",Ye=o.forwardRef(({__scopeCheckbox:t,onKeyDown:r,onClick:s,...i},u)=>{const{control:f,value:y,disabled:I,checked:p,required:h,setControl:x,setChecked:g,hasConsumerStoppedPropagationRef:N,isFormControl:v,bubbleInput:c}=ue(Ke,t),k=z(u,x),l=o.useRef(p);return o.useEffect(()=>{const a=f==null?void 0:f.form;if(a){const C=()=>g(l.current);return a.addEventListener("reset",C),()=>a.removeEventListener("reset",C)}},[f,g]),e.jsx(Y.button,{type:"button",role:"checkbox","aria-checked":q(p)?"mixed":p,"aria-required":h,"data-state":Qe(p),"data-disabled":I?"":void 0,disabled:I,value:y,...i,ref:k,onKeyDown:xe(r,a=>{a.key==="Enter"&&a.preventDefault()}),onClick:xe(s,a=>{g(C=>q(C)?!0:!C),c&&v&&(N.current=a.isPropagationStopped(),N.current||a.stopPropagation())})})});Ye.displayName=Ke;var fe=o.forwardRef((t,r)=>{const{__scopeCheckbox:s,name:i,checked:u,defaultChecked:f,required:y,disabled:I,value:p,onCheckedChange:h,form:x,...g}=t;return e.jsx(Ft,{__scopeCheckbox:s,checked:u,defaultChecked:f,disabled:I,required:y,onCheckedChange:h,name:i,form:x,value:p,internal_do_not_use_render:({isFormControl:N})=>e.jsxs(e.Fragment,{children:[e.jsx(Ye,{...g,ref:r,__scopeCheckbox:s}),N&&e.jsx(ze,{__scopeCheckbox:s})]})})});fe.displayName=se;var qe="CheckboxIndicator",We=o.forwardRef((t,r)=>{const{__scopeCheckbox:s,forceMount:i,...u}=t,f=ue(qe,s);return e.jsx(Be,{present:i||q(f.checked)||f.checked===!0,children:e.jsx(Y.span,{"data-state":Qe(f.checked),"data-disabled":f.disabled?"":void 0,...u,ref:r,style:{pointerEvents:"none",...t.style}})})});We.displayName=qe;var Ve="CheckboxBubbleInput",ze=o.forwardRef(({__scopeCheckbox:t,...r},s)=>{const{control:i,hasConsumerStoppedPropagationRef:u,checked:f,defaultChecked:y,required:I,disabled:p,name:h,value:x,form:g,bubbleInput:N,setBubbleInput:v}=ue(Ve,t),c=z(s,v),k=ve(f),l=ge(i);o.useEffect(()=>{const C=N;if(!C)return;const b=window.HTMLInputElement.prototype,E=Object.getOwnPropertyDescriptor(b,"checked").set,D=!u.current;if(k!==f&&E){const R=new Event("click",{bubbles:D});C.indeterminate=q(f),E.call(C,q(f)?!1:f),C.dispatchEvent(R)}},[N,k,f,u]);const a=o.useRef(q(f)?!1:f);return e.jsx(Y.input,{type:"checkbox","aria-hidden":!0,defaultChecked:y??a.current,required:I,disabled:p,name:h,value:x,form:g,...r,tabIndex:-1,ref:c,style:{...r.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ze.displayName=Ve;function At(t){return typeof t=="function"}function q(t){return t==="indeterminate"}function Qe(t){return q(t)?"indeterminate":t?"checked":"unchecked"}const Tt=o.forwardRef(({className:t,...r},s)=>e.jsx(fe,{ref:s,className:w("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-0 focus-visible:ring-offset-0 disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(We,{className:w("flex items-center justify-center text-current"),children:e.jsx(Q,{className:"h-4 w-4"})})}));Tt.displayName=fe.displayName;const Xt=({cityRef:t,warehouseRef:r,deliveryType:s,isExpanded:i=!0,onCityChange:u,onWarehouseChange:f,onDeliveryTypeChange:y,onContinue:I})=>{const[p,h]=o.useState([]),[x,g]=o.useState([]),[N,v]=o.useState([]),[c,k]=o.useState(null),[l,a]=o.useState(null),[C,b]=o.useState(!1),[j,E]=o.useState(!1),[D,R]=o.useState(""),[S,_]=o.useState("");o.useEffect(()=>{V.getPopularCities().then(h).catch(console.error)},[]),o.useEffect(()=>{t?V.getCity(t).then(d=>{k(d)}).catch(console.error):k(null)},[t]),o.useEffect(()=>{r&&c?V.getWarehouse(r).then(d=>{a(d)}).catch(console.error):a(null)},[r,c]),o.useEffect(()=>{if(D.length>=2){const d=setTimeout(()=>{V.searchCities(D).then(g).catch(console.error)},300);return()=>clearTimeout(d)}else g([])},[D]),o.useEffect(()=>{c&&(console.log("üîÑ [NovaPoshtaDelivery] Loading warehouses for city:",{cityRef:c.ref,cityName:c.description_ua,deliveryType:s}),b(!1),R(""),g([]),E(!1),_(""),V.getWarehouses(c.ref,s).then(d=>{console.log(`‚úÖ [NovaPoshtaDelivery] Loaded ${d.length} warehouses for city ${c.ref}`),d.length>0&&console.log("üì¶ [NovaPoshtaDelivery] Sample warehouse:",d[0]),v(d)}).catch(d=>{console.error("‚ùå [NovaPoshtaDelivery] Error loading warehouses:",d)}))},[c,s]),o.useEffect(()=>{j&&c&&(N.length===0||S)&&(console.log("üîÑ [NovaPoshtaDelivery] Loading warehouses on dropdown open"),V.getWarehouses(c.ref,s,S||void 0).then(d=>{console.log(`‚úÖ [NovaPoshtaDelivery] Loaded ${d.length} warehouses on open`),v(d)}).catch(d=>{console.error("‚ùå [NovaPoshtaDelivery] Error loading warehouses on open:",d)}))},[j]),o.useEffect(()=>{if(j&&c&&S.length>=2){const d=setTimeout(()=>{V.getWarehouses(c.ref,s,S).then(T=>{console.log(`‚úÖ [NovaPoshtaDelivery] Search found ${T.length} warehouses`),v(T)}).catch(T=>{console.error("‚ùå [NovaPoshtaDelivery] Search error:",T)})},300);return()=>clearTimeout(d)}},[S,j]);const L=d=>{k(d),a(null),u(d),f(null),b(!1),R("")},A=d=>{a(d),f(d),E(!1),_("")},G=D.length>=2?x:p;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3 ml-[28px]",children:e.jsxs(Ge,{value:s,onValueChange:d=>y(d),className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ce,{value:"PostOffice",id:"postoffice"}),e.jsx("span",{children:"–£ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ce,{value:"Postomat",id:"postomat"}),e.jsx("span",{children:"–£ –ø–æ—à—Ç–æ–º–∞—Ç"})]})]})}),e.jsxs("fieldset",{className:"space-y-2",children:[e.jsxs("legend",{className:"flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{children:"–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:w("flex h-10 w-full items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm cursor-pointer","hover:border-primary transition-colors",!c&&"opacity-60"),onClick:()=>{b(!C),C||R("")},children:[e.jsx("span",{className:c?"text-foreground":"text-muted-foreground",children:c?c.full_description_ua:"–í–∏–±–µ—Ä—ñ—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç"}),e.jsx(ee,{className:w("h-4 w-4 transition-transform text-muted-foreground",C&&"rotate-180")})]}),C&&e.jsxs("div",{className:"border rounded-xl bg-background overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{type:"text",placeholder:"–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É –≤—ñ–¥ 3-—Ö –±—É–∫–≤",value:D,onChange:d=>R(d.target.value),className:"pl-10",autoFocus:!0,onClick:d=>d.stopPropagation()})]})}),D.length<2&&p.length>0&&e.jsx("div",{className:"p-3 border-b",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:p.slice(0,5).map(d=>e.jsx("button",{type:"button",onClick:T=>{T.stopPropagation(),L(d)},className:"px-3 py-1.5 text-sm border rounded-lg",children:d.description_ua},d.ref))})}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:G.length>0?e.jsx("div",{className:"p-2",children:G.map(d=>e.jsxs("button",{type:"button",onClick:T=>{T.stopPropagation(),L(d)},className:w("w-full flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer text-left",(c==null?void 0:c.ref)===d.ref&&"text-primary font-medium"),children:[(c==null?void 0:c.ref)===d.ref&&e.jsx(Q,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:w("flex-1",(c==null?void 0:c.ref)===d.ref&&"text-primary"),children:d.full_description_ua})]},d.ref))}):D.length>=2?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"}):e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞"})})]})]})]}),c&&e.jsxs("fieldset",{className:"space-y-2",children:[e.jsxs("legend",{className:"flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{children:s==="PostOffice"?"–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è":"–ü–æ—à—Ç–æ–º–∞—Ç"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:w("flex min-h-10 w-full items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm cursor-pointer","hover:border-primary transition-colors",!c&&"opacity-60"),onClick:()=>{E(!j),j||_("")},children:[e.jsx("span",{className:w("flex-1 break-words pr-2",l?"text-foreground":"text-muted-foreground"),children:l?l.description_ua:s==="PostOffice"?"–í–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è":"–í–∏–±–µ—Ä—ñ—Ç—å –ø–æ—à—Ç–æ–º–∞—Ç"}),e.jsx(ee,{className:w("h-4 w-4 transition-transform text-muted-foreground flex-shrink-0",j&&"rotate-180")})]}),j&&e.jsxs("div",{className:"border rounded-xl bg-background overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{type:"text",placeholder:s==="PostOffice"?"–í–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è":"–í–∏–±–µ—Ä—ñ—Ç—å –ø–æ—à—Ç–æ–º–∞—Ç",value:S,onChange:d=>_(d.target.value),className:"pl-10 rounded-xl",autoFocus:!0,onClick:d=>d.stopPropagation()})]})}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:N.length>0?e.jsx("ul",{className:"p-2 space-y-1",children:N.map(d=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:T=>{T.stopPropagation(),A(d)},className:w("w-full flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer text-left",(l==null?void 0:l.ref)===d.ref&&"text-primary font-medium"),children:[(l==null?void 0:l.ref)===d.ref&&e.jsx(Q,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:w("flex-1 text-sm",(l==null?void 0:l.ref)===d.ref&&"text-primary"),children:d.description_ua})]})},d.ref))}):e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:S.length>=2?"–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ":"–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è..."})})]})]})]}),i&&I&&e.jsx("div",{className:"pt-4",children:e.jsx(be,{type:"button",onClick:I,disabled:!c||!l,variant:"outline",className:"w-full rounded-xl border h-10 hover:border hover:bg-transparent hover:text-primary disabled:hover:text-primary disabled:opacity-50",children:"–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏"})})]})},Zt=({cityId:t,branchId:r,savedCityName:s,savedCityRegion:i,savedBranchName:u,savedBranchAddress:f,savedBranchPostalCode:y,isExpanded:I=!0,onCityChange:p,onBranchChange:h,onContinue:x})=>{const[g,N]=o.useState([]),[v,c]=o.useState([]),[k,l]=o.useState([]),[a,C]=o.useState(null),[b,j]=o.useState(null);o.useEffect(()=>{if(t&&s&&!a){let n=s,m=i||"";const P=s.match(/^(.+?)\s*\((.+?)\)$/);if(P){n=P[1].trim();const O=P[2].trim();O==="*"?m="":m=O}const F=parseInt(t.toString(),10);if(isNaN(F)||F<=0){console.log(`üîç [UkrPoshtaDelivery] Saved cityId "${t}" is not numeric, searching via API for "${n}"...`),$.searchCities(n).then(O=>{const ne=M=>M?M.replace(/\s*–æ–±–ª\.?\s*$/i,"").trim():"",pe=ne(m),W=O.find(M=>{const Xe=M.name.toLowerCase()===n.toLowerCase(),Ze=pe?ne(M.region||"")===pe:!0,Je=M.cityId&&!isNaN(parseInt(M.cityId.toString(),10));return Xe&&Ze&&Je});if(W&&W.cityId){console.log(`‚úÖ [UkrPoshtaDelivery] Found numeric CITY_ID ${W.cityId} for saved city "${n}"`);const M={id:W.cityId.toString(),name:W.name,postalCode:"",region:W.region||m,cityId:W.cityId.toString()};C(M),p(M)}else console.warn(`‚ö†Ô∏è [UkrPoshtaDelivery] Could not find numeric CITY_ID for saved city "${n}"`),C({id:t,name:n,postalCode:"",region:m,cityId:t})}).catch(O=>{console.error(`‚ùå [UkrPoshtaDelivery] Error searching for saved city "${n}":`,O),C({id:t,name:n,postalCode:"",region:m,cityId:t})});return}const B={id:t,name:n,postalCode:"",region:m,cityId:t};C(B),console.log("‚ö° [UkrPoshtaDelivery] Instant city display from saved data:",B)}},[t,s,i,a,p]),o.useEffect(()=>{if(r&&u&&!b&&a){const n={id:r,name:u,address:f||"",postalCode:y||"",cityId:a.id};j(n),console.log("‚ö° [UkrPoshtaDelivery] Instant branch display from saved data:",n)}},[r,u,f,y,b,a]);const[E,D]=o.useState(!1),[R,S]=o.useState(!1),[_,L]=o.useState(""),[A,G]=o.useState("");o.useEffect(()=>{$.getPopularCities().then(N).catch(console.error)},[]),o.useEffect(()=>{if(t){const n=parseInt(t.toString(),10);if(isNaN(n)||n<=0){console.warn(`‚ö†Ô∏è [UkrPoshtaDelivery] Invalid cityId (not a numeric CITY_ID): ${t}. Skipping API call.`),C(null);return}console.log(`üîç [UkrPoshtaDelivery] Loading city by ID: ${t}`),$.getCity(t).then(m=>{console.log("‚úÖ [UkrPoshtaDelivery] Loaded city:",m),C(m)}).catch(m=>{m.message&&m.message.includes("City not found")?console.warn(`‚ö†Ô∏è [UkrPoshtaDelivery] City with ID ${t} not found in API. This may be normal if the city was removed or ID changed.`):console.error(`‚ùå [UkrPoshtaDelivery] Error loading city ${t}:`,m),C(null)})}else C(null)},[t]),o.useEffect(()=>{if(r&&a){const n=a.cityId||a.id;$.getBranch(r,n).then(m=>{j(m)}).catch(console.error)}else j(null)},[r,a]),o.useEffect(()=>{if(_.length>=2){const n=setTimeout(()=>{console.log("üîç [UkrPoshtaDelivery] Searching cities for:",_),$.searchCities(_).then(m=>{console.log(`‚úÖ [UkrPoshtaDelivery] Found ${m.length} cities:`,m),c(m)}).catch(m=>{console.error("‚ùå [UkrPoshtaDelivery] Error searching cities:",m),c([])})},300);return()=>clearTimeout(n)}else c([])},[_]),o.useEffect(()=>{if(a){const n=a.cityId,m=n?parseInt(n.toString(),10):null;if(!m||isNaN(m)){console.warn("‚ö†Ô∏è [UkrPoshtaDelivery] City does not have valid CITY_ID, trying to get it from API:",{cityName:a.name,cityId:n,id:a.id}),a.name?$.searchCities(a.name).then(P=>{const F=P.find(B=>B.name.toLowerCase()===a.name.toLowerCase()&&B.cityId&&!isNaN(parseInt(B.cityId.toString(),10)));if(F&&F.cityId){console.log("‚úÖ [UkrPoshtaDelivery] Found CITY_ID for city:",F);const B={...a,cityId:F.cityId};C(B),p(B),$.getBranches(F.cityId).then(O=>{console.log(`‚úÖ [UkrPoshtaDelivery] Loaded ${O.length} branches for city ${F.cityId}`),l(O)}).catch(O=>{console.error("‚ùå [UkrPoshtaDelivery] Error loading branches:",O),l([])})}else console.error("‚ùå [UkrPoshtaDelivery] Could not find CITY_ID for city:",a.name),l([])}).catch(P=>{console.error("‚ùå [UkrPoshtaDelivery] Error searching for city:",P),l([])}):l([]);return}console.log("üîÑ [UkrPoshtaDelivery] Loading branches for city:",{cityId:m,cityName:a.name}),D(!1),L(""),c([]),S(!1),G(""),$.getBranches(m.toString()).then(P=>{console.log(`‚úÖ [UkrPoshtaDelivery] Loaded ${P.length} branches for city ${m}`),P.length>0&&console.log("üì¶ [UkrPoshtaDelivery] Sample branch:",P[0]),l(P)}).catch(P=>{console.error("‚ùå [UkrPoshtaDelivery] Error loading branches:",P),l([])})}},[a]),o.useEffect(()=>{if(R&&a&&(k.length===0||A)){const n=a.cityId,m=n?parseInt(n.toString(),10):null;if(!m||isNaN(m)){console.warn("‚ö†Ô∏è [UkrPoshtaDelivery] Cannot load branches: invalid CITY_ID"),l([]);return}console.log("üîÑ [UkrPoshtaDelivery] Loading branches on dropdown open"),$.getBranches(m.toString(),A||void 0).then(P=>{console.log(`‚úÖ [UkrPoshtaDelivery] Loaded ${P.length} branches on open`),l(P)}).catch(P=>{console.error("‚ùå [UkrPoshtaDelivery] Error loading branches on open:",P),l([])})}},[R]),o.useEffect(()=>{if(R&&a&&A.length>=2){const n=a.cityId,m=n?parseInt(n.toString(),10):null;if(!m||isNaN(m)){console.warn("‚ö†Ô∏è [UkrPoshtaDelivery] Cannot search branches: invalid CITY_ID"),l([]);return}const P=setTimeout(()=>{$.getBranches(m.toString(),A).then(F=>{console.log(`‚úÖ [UkrPoshtaDelivery] Search found ${F.length} branches`),l(F)}).catch(F=>{console.error("‚ùå [UkrPoshtaDelivery] Search error:",F),l([])})},300);return()=>clearTimeout(P)}},[A,R]);const d=async n=>{let m=n;const P=n.cityId?parseInt(n.cityId.toString(),10):null;!P||isNaN(P)?(console.warn(`‚ö†Ô∏è [UkrPoshtaDelivery] City "${n.name}" has no numeric CITY_ID. This should not happen for popular cities from DB.`),m={...n,displayName:me(n)}):m={...n,id:n.cityId.toString(),cityId:n.cityId.toString(),displayName:me(n)},C(m),j(null),p(m),h(null),D(!1),L("")},T=n=>{j(n),h(n),S(!1),G("")},Z=_.length>=2?v:g,U=n=>!n.region||n.region.trim()===""?`${n.name} (*)`:`${n.name} (${n.region})`,me=n=>U(n);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("fieldset",{className:"space-y-2",children:[e.jsxs("legend",{className:"flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{children:"–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:w("flex min-h-10 w-full items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm cursor-pointer","hover:border-primary transition-colors",!a&&"opacity-60"),onClick:()=>{D(!E),E||L("")},children:[e.jsx("span",{className:w("flex-1 break-words pr-2",a?"text-foreground":"text-muted-foreground"),children:a?U(a):"–í–∏–±–µ—Ä—ñ—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç"}),e.jsx(ee,{className:w("h-4 w-4 transition-transform text-muted-foreground flex-shrink-0",E&&"rotate-180")})]}),E&&e.jsxs("div",{className:"border rounded-xl bg-background overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{type:"text",placeholder:"–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É –≤—ñ–¥ 3-—Ö –±—É–∫–≤",value:_,onChange:n=>L(n.target.value),className:"pl-10",autoFocus:!0,onClick:n=>n.stopPropagation()})]})}),_.length<2&&g.length>0&&e.jsx("div",{className:"p-3 border-b",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:g.slice(0,5).map(n=>e.jsx("button",{type:"button",onClick:m=>{m.stopPropagation(),d(n)},className:"px-3 py-1.5 text-sm border rounded-lg",children:U(n)},n.id))})}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:Z.length>0?e.jsx("div",{className:"p-2",children:Z.map(n=>e.jsxs("button",{type:"button",onClick:m=>{m.stopPropagation(),d(n)},className:w("w-full flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer text-left",(a==null?void 0:a.id)===n.id&&"text-primary font-medium"),children:[(a==null?void 0:a.id)===n.id&&e.jsx(Q,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:w("flex-1",(a==null?void 0:a.id)===n.id&&"text-primary"),children:U(n)})]},n.id))}):_.length>=2?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"}):e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞"})})]})]})]}),a&&e.jsxs("fieldset",{className:"space-y-2",children:[e.jsxs("legend",{className:"flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{children:"–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:w("flex min-h-10 w-full items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm cursor-pointer","hover:border-primary transition-colors",!a&&"opacity-60"),onClick:()=>{S(!R),R||G("")},children:[e.jsx("span",{className:w("flex-1 break-words pr-2",b?"text-foreground":"text-muted-foreground"),children:b?`${b.name}, ${b.address}`:"–í–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è"}),e.jsx(ee,{className:w("h-4 w-4 transition-transform text-muted-foreground flex-shrink-0",R&&"rotate-180")})]}),R&&e.jsxs("div",{className:"border rounded-xl bg-background overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{type:"text",placeholder:"–í–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è",value:A,onChange:n=>G(n.target.value),className:"pl-10 rounded-xl",autoFocus:!0,onClick:n=>n.stopPropagation()})]})}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:k.length>0?e.jsx("ul",{className:"p-2 space-y-1",children:k.map(n=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:m=>{m.stopPropagation(),T(n)},className:w("w-full flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer text-left",(b==null?void 0:b.id)===n.id&&"text-primary font-medium"),children:[(b==null?void 0:b.id)===n.id&&e.jsx(Q,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsxs("span",{className:w("flex-1 text-sm",(b==null?void 0:b.id)===n.id&&"text-primary"),children:[n.name,", ",n.address]})]})},n.id))}):e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:A.length>=2?"–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ":"–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è..."})})]})]})]}),I&&x&&e.jsx("div",{className:"pt-4",children:e.jsx(be,{type:"button",onClick:x,disabled:!a||!b,variant:"outline",className:"w-full rounded-xl border h-10 hover:border hover:bg-transparent hover:text-primary disabled:hover:text-primary disabled:opacity-50",children:"–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏"})})]})};export{Tt as C,Xt as N,Vt as P,Ge as R,Zt as U,ce as a};
