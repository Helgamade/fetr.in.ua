import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as j}from"./chunk-charts-BaLkbnPn.js";import{u as z,a as B,b as M,c as U}from"./useFAQs-DNifB0eo.js";import{C as w,a as $,b as H,d as y}from"./card-BflDPH_v.js";import{I as _}from"./input-D93KF8x4.js";import{T as R}from"./textarea-UjcpLEoS.js";import{B as c}from"./button-NrqM-Eov.js";import{L as v}from"./label-CUjGEuR_.js";import{D as G,a as J,b as K,c as V,d as W}from"./dialog-M76gbJny.js";import{S as X}from"./switch-BCq8M6Fn.js";import{B as Y}from"./badge-DJfTr8PX.js";import{z as Z}from"./index-CmBNacJt.js";import{P as q,T as ee}from"./trash-2-CIB2onwG.js";import{S as se}from"./search-DESSt1gA.js";import{C as re}from"./chevron-up-CMy3vpJ8.js";import{C as te}from"./chevron-down-DICVbr64.js";import{E as ie}from"./eye-off-CC13dhJU.js";import{E as ae}from"./eye-CgjlZpH_.js";import{S as ne}from"./square-pen-CaQzSHUZ.js";import"./index-CK4iyky9.js";import"./Combination-mbMryq0B.js";import"./index-ZeZSZmiz.js";function Se(){const{toast:i}=Z(),{data:g=[],isLoading:C}=z(!1),b=B(),d=M(),N=U(),[p,F]=j.useState(""),[r,m]=j.useState(null),[Q,x]=j.useState(!1),[S,A]=j.useState(null),l=[...g].sort((s,t)=>s.sort_order-t.sort_order),f=l.filter(s=>s.question.toLowerCase().includes(p.toLowerCase())||s.answer.toLowerCase().includes(p.toLowerCase())),P=()=>{m({id:0,question:"",answer:"",sort_order:g.length>0?Math.max(...g.map(s=>s.sort_order))+1:0,is_published:!0}),x(!0)},D=s=>{m({...s}),x(!0)},O=async()=>{var s;if(r){if(!r.question.trim()||!r.answer.trim()){i({title:"Помилка",description:"Заповніть питання та відповідь",variant:"destructive"});return}try{const t=r.sort_order||0,a=r.id===0?-1:((s=l.find(u=>u.id===r.id))==null?void 0:s.sort_order)||-1;if(r.id!==0&&a!==t){const n=l.filter(o=>o.id===r.id?!1:a<t?o.sort_order>a&&o.sort_order<=t:o.sort_order>=t&&o.sort_order<a).map(o=>{const L=a<t?o.sort_order-1:o.sort_order+1;return d.mutateAsync({id:o.id,data:{sort_order:L}})});await Promise.all(n)}const h={question:r.question.trim(),answer:r.answer.trim(),sort_order:t,is_published:r.is_published??!0};r.id===0?(await b.mutateAsync(h),i({title:"Створено",description:"FAQ успішно створено"})):(await d.mutateAsync({id:r.id,data:h}),i({title:"Оновлено",description:"FAQ успішно оновлено"})),x(!1),m(null)}catch(t){i({title:"Помилка",description:t.message||"Не вдалося зберегти FAQ",variant:"destructive"})}}},k=async s=>{if(confirm(`Ви впевнені, що хочете видалити питання "${s.question}"?`))try{await N.mutateAsync(s.id),i({title:"Видалено",description:"FAQ успішно видалено"})}catch(t){i({title:"Помилка",description:t.message||"Не вдалося видалити FAQ",variant:"destructive"})}},T=async s=>{A(s.id);try{await d.mutateAsync({id:s.id,data:{is_published:!s.is_published}}),i({title:s.is_published?"Знято з публікації":"Опубліковано",description:`FAQ "${s.question}" ${s.is_published?"знято з публікації":"опубліковано"}`})}catch(t){i({title:"Помилка",description:t.message||"Не вдалося змінити статус публікації",variant:"destructive"})}finally{A(null)}},I=async s=>{const t=l.findIndex(n=>n.id===s.id);if(t<=0)return;const a=l[t-1],h=a.sort_order,u=s.sort_order;try{await Promise.all([d.mutateAsync({id:s.id,data:{sort_order:h}}),d.mutateAsync({id:a.id,data:{sort_order:u}})]),i({title:"Порядок оновлено",description:"FAQ переміщено вгору"})}catch(n){i({title:"Помилка",description:n.message||"Не вдалося змінити порядок",variant:"destructive"})}},E=async s=>{const t=l.findIndex(n=>n.id===s.id);if(t>=l.length-1)return;const a=l[t+1],h=a.sort_order,u=s.sort_order;try{await Promise.all([d.mutateAsync({id:s.id,data:{sort_order:h}}),d.mutateAsync({id:a.id,data:{sort_order:u}})]),i({title:"Порядок оновлено",description:"FAQ переміщено вниз"})}catch(n){i({title:"Помилка",description:n.message||"Не вдалося змінити порядок",variant:"destructive"})}};return C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження FAQ..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{children:"Часті питання"}),e.jsxs(c,{onClick:P,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Додати питання"]})]})}),e.jsxs(y,{children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_,{placeholder:"Пошук по питанню або відповіді...",value:p,onChange:s=>F(s.target.value),className:"pl-9"})]}),e.jsx("div",{className:"space-y-4",children:f.length>0?f.map((s,t)=>e.jsx(w,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!s.is_published&&e.jsx(Y,{variant:"secondary",children:"Неопубліковано"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Порядок: ",s.sort_order]})]}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:s.question}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:s.answer})]})}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{variant:"outline",size:"icon",onClick:()=>I(s),disabled:t===0,children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(c,{variant:"outline",size:"icon",onClick:()=>E(s),disabled:t===f.length-1,children:e.jsx(te,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>T(s),disabled:S===s.id,children:s.is_published?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Зняти з публікації"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Опублікувати"]})}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>D(s),children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Редагувати"]}),e.jsxs(c,{variant:"destructive",size:"sm",onClick:()=>k(s),disabled:N.isPending,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Видалити"]})]})]})]})})},s.id)):e.jsx(w,{children:e.jsx(y,{className:"py-12 text-center text-muted-foreground",children:p?"FAQ не знайдено":"FAQ поки немає"})})})]})]}),e.jsx(G,{open:Q,onOpenChange:x,children:e.jsxs(J,{className:"sm:max-w-[600px]",children:[e.jsx(K,{children:e.jsx(V,{children:(r==null?void 0:r.id)===0?"Додати нове питання":"Редагувати питання"})}),r&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"question",children:"Питання *"}),e.jsx(_,{id:"question",value:r.question,onChange:s=>m({...r,question:s.target.value}),placeholder:"Введіть питання"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"answer",children:"Відповідь *"}),e.jsx(R,{id:"answer",value:r.answer,onChange:s=>m({...r,answer:s.target.value}),rows:6,placeholder:"Введіть відповідь"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"sort_order",children:"Порядок сортування"}),e.jsx(_,{id:"sort_order",type:"number",value:r.sort_order,onChange:s=>m({...r,sort_order:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{id:"is_published",checked:r.is_published??!0,onCheckedChange:s=>m({...r,is_published:s})}),e.jsx(v,{htmlFor:"is_published",children:"Опубліковано"})]})]}),e.jsxs(W,{children:[e.jsx(c,{variant:"outline",onClick:()=>x(!1),children:"Скасувати"}),e.jsx(c,{onClick:O,disabled:b.isPending||d.isPending,children:"Зберегти"})]})]})})]})}export{Se as FAQ};
