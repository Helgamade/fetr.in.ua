import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as o}from"./chunk-charts-BaLkbnPn.js";import{B as n}from"./button-CodXzzhy.js";import{I as f}from"./input-DPFfF9lC.js";import{C as v,d as N,a as D,b as E}from"./card-BUzjQjSo.js";import{D as F,a as O,b as z,c as P,d as T}from"./dialog-X5PAv_yP.js";import{L as h}from"./label-CKumXRUT.js";import{T as le}from"./textarea-RwrUlOJP.js";import{S as U}from"./switch-CuGfkSir.js";import{z as ne}from"./index-BsdWhFFq.js";import{u as ce,a as de,b as oe,c as me,d as he,e as ue,f as pe,g as xe}from"./useGalleries-BDGVy7FG.js";import{S as ge}from"./search-DlYklUcN.js";import{P as je,T as L}from"./trash-2-BdyClQqt.js";import{C as fe}from"./chevron-up-ChQmRf41.js";import{C as ve}from"./chevron-down-CQEw1GoF.js";import{S as R}from"./square-pen-CkiUQDVx.js";import{U as Ne}from"./upload-Djksq5lm.js";import{I as Ce}from"./image-Dinw4szJ.js";import"./index-C67KGPVS.js";import"./Combination-Cp-xnfep.js";import"./index-ZeZSZmiz.js";function He(){const{data:c=[],isLoading:$}=ce(!1),q=de(),b=oe(),B=me(),H=he(),Q=ue(),M=pe(),[w,A]=o.useState(""),[a,m]=o.useState(null),[l,S]=o.useState(null),[i,u]=o.useState(null),[J,p]=o.useState(!1),[K,C]=o.useState(!1),[y,I]=o.useState(null),_=o.useRef({}),{toast:r}=ne(),{data:d}=xe(l||0,!1),G=c.filter(s=>s.name.toLowerCase().includes(w.toLowerCase())),V=()=>{m({id:0,name:"",sort_order:c.length,is_published:!0,created_at:"",updated_at:""}),p(!0)},W=s=>{m({...s}),p(!0)},X=()=>{if(!a)return;if(!a.name){r({title:"Помилка",description:"Введіть назву галереї",variant:"destructive"});return}const s={name:a.name,sort_order:a.sort_order||0,is_published:a.is_published};a.id===0?q.mutate(s,{onSuccess:()=>{r({title:"Створено",description:"Галерею успішно створено"}),p(!1),m(null)},onError:t=>{r({title:"Помилка",description:t.message||"Не вдалося створити галерею",variant:"destructive"})}}):b.mutate({id:a.id,data:s},{onSuccess:()=>{r({title:"Збережено",description:"Галерею успішно оновлено"}),p(!1),m(null)},onError:t=>{r({title:"Помилка",description:t.message||"Не вдалося оновити галерею",variant:"destructive"})}})},Y=s=>{confirm(`Ви впевнені, що хочете видалити галерею "${s.name}"? Всі фотографії також будуть видалені.`)&&B.mutate(s.id,{onSuccess:()=>{r({title:"Видалено",description:`Галерею "${s.name}" видалено`,variant:"destructive"}),l===s.id&&S(null)},onError:t=>{r({title:"Помилка",description:t.message||"Не вдалося видалити галерею",variant:"destructive"})}})},Z=(s,t)=>{var g;const x=(g=t.target.files)==null?void 0:g[0];x&&(I(s),H.mutate({galleryId:s,file:x},{onSuccess:()=>{r({title:"Завантажено",description:"Фотографію успішно завантажено"}),I(null),_.current[s]&&(_.current[s].value="")},onError:j=>{r({title:"Помилка",description:j.message||"Не вдалося завантажити фотографію",variant:"destructive"}),I(null)}}))},ee=s=>{u({...s}),C(!0)},se=()=>{!i||!l||Q.mutate({galleryId:l,imageId:i.id,data:{title:i.title||void 0,description:i.description||void 0,sort_order:i.sort_order,is_published:i.is_published}},{onSuccess:()=>{r({title:"Збережено",description:"Фотографію успішно оновлено"}),C(!1),u(null)},onError:s=>{r({title:"Помилка",description:s.message||"Не вдалося оновити фотографію",variant:"destructive"})}})},te=s=>{l&&confirm("Ви впевнені, що хочете видалити цю фотографію?")&&M.mutate({galleryId:l,imageId:s.id},{onSuccess:()=>{r({title:"Видалено",description:"Фотографію успішно видалено",variant:"destructive"})},onError:t=>{r({title:"Помилка",description:t.message||"Не вдалося видалити фотографію",variant:"destructive"})}})},k=(s,t)=>{const x=c.findIndex(re=>re.id===s.id);if(x===-1)return;const g=t==="up"?x-1:x+1;if(g<0||g>=c.length)return;const j=c[g],ae=j.sort_order,ie=s.sort_order;b.mutate({id:s.id,data:{...s,sort_order:ae}},{onSuccess:()=>{b.mutate({id:j.id,data:{...j,sort_order:ie}},{onSuccess:()=>{r({title:"Оновлено",description:"Порядок галереї змінено"})}})}})};return $?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження галерей..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(f,{placeholder:"Пошук галерей...",value:w,onChange:s=>A(s.target.value),className:"pl-9"})]}),e.jsxs(n,{onClick:V,children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Додати галерею"]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-4",children:G.length>0?G.map(s=>e.jsxs(v,{className:`cursor-pointer transition-colors ${l===s.id?"ring-2 ring-primary":""}`,onClick:()=>S(s.id),children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),k(s,"up")},disabled:c.findIndex(t=>t.id===s.id)===0,children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),k(s,"down")},disabled:c.findIndex(t=>t.id===s.id)===c.length-1,children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),W(s)},children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),Y(s)},children:e.jsx(L,{className:"h-4 w-4"})})]})]}),e.jsxs(N,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.imagesCount||0," фотографій"]}),!s.is_published&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Не опубліковано"})]})]},s.id)):e.jsx(v,{children:e.jsx(N,{className:"py-8 text-center text-muted-foreground",children:"Галерей не знайдено"})})}),e.jsx("div",{className:"lg:col-span-2",children:l?e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(E,{children:(d==null?void 0:d.name)||"Галерея"})}),e.jsxs(N,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{ref:s=>_.current[l]=s,type:"file",accept:"image/*",className:"hidden",onChange:s=>Z(l,s)}),e.jsx(n,{onClick:()=>{var s;return(s=_.current[l])==null?void 0:s.click()},disabled:y===l,children:y===l?e.jsx(e.Fragment,{children:"Завантаження..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Додати фотографію"]})})]}),d!=null&&d.images&&d.images.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:d.images.map(s=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"aspect-square relative overflow-hidden rounded-lg",children:[e.jsx("img",{src:s.url,alt:s.title||"Gallery image",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx(n,{variant:"secondary",size:"icon",onClick:()=>ee(s),children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(n,{variant:"destructive",size:"icon",onClick:()=>te(s),children:e.jsx(L,{className:"h-4 w-4"})})]}),!s.is_published&&e.jsx("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white text-xs px-2 py-1 rounded",children:"Не опубліковано"})]}),s.title&&e.jsx("p",{className:"text-sm font-medium mt-2 truncate",children:s.title})]},s.id))}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ce,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Поки що немає фотографій у цій галереї"}),e.jsx("p",{className:"text-sm mt-2",children:'Натисніть "Додати фотографію" щоб почати'})]})]})]}):e.jsx(v,{children:e.jsx(N,{className:"py-12 text-center text-muted-foreground",children:"Оберіть галерею для перегляду фотографій"})})})]}),e.jsx(F,{open:J,onOpenChange:p,children:e.jsxs(O,{className:"sm:max-w-[425px]",children:[e.jsx(z,{children:e.jsx(P,{children:(a==null?void 0:a.id)===0?"Додати нову галерею":"Редагувати галерею"})}),a&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"name",className:"text-right",children:"Назва"}),e.jsx(f,{id:"name",value:a.name,onChange:s=>m({...a,name:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"sort_order",className:"text-right",children:"Порядок"}),e.jsx(f,{id:"sort_order",type:"number",value:a.sort_order,onChange:s=>m({...a,sort_order:parseInt(s.target.value)||0}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"is_published",className:"text-right",children:"Опубліковано"}),e.jsx(U,{id:"is_published",checked:a.is_published,onCheckedChange:s=>m({...a,is_published:s}),className:"col-span-3"})]})]}),e.jsxs(T,{children:[e.jsx(n,{variant:"outline",onClick:()=>p(!1),children:"Скасувати"}),e.jsx(n,{onClick:X,children:"Зберегти"})]})]})}),e.jsx(F,{open:K,onOpenChange:C,children:e.jsxs(O,{className:"sm:max-w-[525px]",children:[e.jsx(z,{children:e.jsx(P,{children:"Редагувати фотографію"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:i.url,alt:i.title||"Gallery image",className:"w-full h-64 object-cover rounded-lg"})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"image_title",className:"text-right",children:"Назва"}),e.jsx(f,{id:"image_title",value:i.title||"",onChange:s=>u({...i,title:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(h,{htmlFor:"image_description",className:"text-right",children:"Опис"}),e.jsx(le,{id:"image_description",value:i.description||"",onChange:s=>u({...i,description:s.target.value}),className:"col-span-3",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"image_sort_order",className:"text-right",children:"Порядок"}),e.jsx(f,{id:"image_sort_order",type:"number",value:i.sort_order,onChange:s=>u({...i,sort_order:parseInt(s.target.value)||0}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"image_is_published",className:"text-right",children:"Опубліковано"}),e.jsx(U,{id:"image_is_published",checked:i.is_published,onCheckedChange:s=>u({...i,is_published:s}),className:"col-span-3"})]})]})]}),e.jsxs(T,{children:[e.jsx(n,{variant:"outline",onClick:()=>C(!1),children:"Скасувати"}),e.jsx(n,{onClick:se,children:"Зберегти"})]})]})})]})}export{He as Galleries};
