import{r as y,j as e}from"./chunk-react-CHUe_c_M.js";import{B as m}from"./button-Dirq6-S7.js";import{I as b}from"./input-E_DkKYix.js";import{C as Q,a as R,b as Y,c as _,d as G}from"./card-DcmemaXX.js";import{L as g}from"./label-CUlRyR4d.js";import{S as J}from"./switch-C5BnPKBx.js";import{S as M,a as W,b as X,c as Z,d as F}from"./select-CsJALA_M.js";import{f as K}from"./index-Dv87KhRC.js";import{D as ee,a as se,b as te,c as ae,d as re}from"./dialog-CQ-l8du7.js";import{u as le,a as ne,b as ie,c as ce,d as oe}from"./useComparison-DxNLB8yb.js";import{a as de}from"./chunk-query-BDB5idE8.js";import{bs as he,a_ as me,bt as ue,aY as pe}from"./chunk-vendor-C_GYGcpd.js";import"./chunk-lottie-DoMt_38f.js";import"./chunk-radix-BYx9rzOz.js";import"./chunk-router-BMV24Bow.js";function Ee(){const{toast:n}=K(),E=de(),{data:C,isLoading:V}=le(),I=ne(),L=ie(),T=ce(),z=oe(),[t,o]=y.useState(null),[U,d]=y.useState(!1),[r,h]=y.useState({key:"",label:"",type:"text",sortOrder:0}),[v,k]=y.useState({}),[O,S]=y.useState(!1);if(V||!C)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження..."})});const{features:w,products:N}=C,D=(s,a,u)=>{k(l=>({...l,[s]:{...l[s],[a]:u}}))},B=async()=>{if(!C)return;const s=[];if(Object.entries(v).forEach(([a,u])=>{const l=w.find(i=>i.key===a);l&&Object.entries(u).forEach(([i,p])=>{const c=parseInt(i),x=N.find(j=>j.id===c);if(!x)return;const f=l.values[x.code]??null;p!==f&&s.push({featureKey:a,productId:c,value:p})})}),s.length===0){n({title:"Немає змін",description:"Немає незбережених змін"});return}S(!0);try{for(const a of s)await I.mutateAsync(a);n({title:"Збережено",description:`Успішно збережено ${s.length} ${s.length===1?"значення":"значень"}`}),k({}),await E.invalidateQueries({queryKey:["comparison"]})}catch(a){n({title:"Помилка",description:a.message||"Не вдалося зберегти значення",variant:"destructive"})}finally{S(!1)}},$=()=>{if(!r.key||!r.label){n({title:"Помилка",description:"Заповніть всі обов'язкові поля",variant:"destructive"});return}L.mutate({key:r.key,label:r.label,type:r.type,sortOrder:r.sortOrder},{onSuccess:()=>{n({title:"Успіх",description:"Параметр додано"}),h({key:"",label:"",type:"text",sortOrder:0}),d(!1)},onError:s=>{n({title:"Помилка",description:s.message||"Не вдалося створити параметр",variant:"destructive"})}})},q=s=>{o(s),d(!0)},A=()=>{t&&T.mutate({key:t.key,label:t.label,type:t.type,sortOrder:t.sortOrder},{onSuccess:()=>{n({title:"Успіх",description:"Параметр оновлено"}),o(null),d(!1)},onError:s=>{n({title:"Помилка",description:s.message||"Не вдалося оновити параметр",variant:"destructive"})}})},H=s=>{confirm("Ви впевнені, що хочете видалити цей параметр?")&&z.mutate(s,{onSuccess:()=>{n({title:"Успіх",description:"Параметр видалено"})},onError:a=>{n({title:"Помилка",description:a.message||"Не вдалося видалити параметр",variant:"destructive"})}})},P=Object.keys(v).length>0&&Object.values(v).some(s=>Object.keys(s).length>0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Таблиця порівняння"}),e.jsx("p",{className:"text-muted-foreground",children:"Керування параметрами порівняння товарів"})]}),e.jsxs("div",{className:"flex gap-2",children:[P&&e.jsxs(m,{variant:"outline",onClick:B,disabled:O,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),O?"Збереження...":"Зберегти зміни"]}),e.jsxs(m,{onClick:()=>d(!0),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Додати параметр"]})]})]}),e.jsxs(Q,{children:[e.jsxs(R,{children:[e.jsx(Y,{children:"Параметри порівняння"}),e.jsx(_,{children:"Редагуйте значення параметрів для кожного товару"})]}),e.jsx(G,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 font-semibold sticky left-0 bg-background z-10 min-w-[200px]",children:"Параметр"}),e.jsx("th",{className:"text-center p-3 font-semibold min-w-[80px]",children:"Порядок"}),N.map(s=>e.jsx("th",{className:"text-center p-3 font-semibold min-w-[150px]",children:s.name},s.id)),e.jsx("th",{className:"p-3 w-[100px]"})]})}),e.jsx("tbody",{children:w.map((s,a)=>{const u=s.type==="boolean";return e.jsxs("tr",{className:a%2===0?"bg-muted/50":"",children:[e.jsxs("td",{className:"p-3 sticky left-0 bg-inherit z-10 font-medium",children:[s.label,e.jsx(m,{variant:"ghost",size:"sm",className:"ml-2 h-6 w-6 p-0",onClick:()=>q(s),children:e.jsx(ue,{className:"h-3 w-3"})})]}),e.jsx("td",{className:"p-3 text-center",children:s.sortOrder}),N.map(l=>{var f;const i=(f=v[s.key])==null?void 0:f[l.id],p=s.values[l.code]??null,c=i!==void 0?i:p,x=i!==void 0&&i!==p;return e.jsx("td",{className:"p-3",children:u?e.jsx("div",{className:"flex justify-center",children:e.jsx(J,{checked:c===!0,onCheckedChange:j=>D(s.key,l.id,j)})}):e.jsxs("div",{className:"relative",children:[e.jsx(b,{value:(c==null?void 0:c.toString())||"",onChange:j=>D(s.key,l.id,j.target.value||null),placeholder:"Введіть значення",className:`w-full ${x?"ring-2 ring-primary":""}`}),x&&e.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-primary rounded-full"})]})},l.id)}),e.jsx("td",{className:"p-3",children:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>H(s.key),children:e.jsx(pe,{className:"h-4 w-4 text-destructive"})})})]},s.key)})})]})})})]}),e.jsx(ee,{open:U,onOpenChange:d,children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsx(ae,{children:t?"Редагувати параметр":"Додати параметр"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"key",children:"Ключ (латиниця, без пробілів)"}),e.jsx(b,{id:"key",value:(t==null?void 0:t.key)||r.key,onChange:s=>{t||h({...r,key:s.target.value.toLowerCase().replace(/\s+/g,"-")})},disabled:!!t,placeholder:"colors"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"label",children:"Назва параметра"}),e.jsx(b,{id:"label",value:(t==null?void 0:t.label)||r.label,onChange:s=>{t?o({...t,label:s.target.value}):h({...r,label:s.target.value})},placeholder:"Кількість кольорів фетру"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"type",children:"Тип параметра"}),e.jsxs(M,{value:(t==null?void 0:t.type)||r.type,onValueChange:s=>{t?o({...t,type:s}):h({...r,type:s})},children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Виберіть тип"})}),e.jsxs(Z,{children:[e.jsx(F,{value:"text",children:"Текст"}),e.jsx(F,{value:"boolean",children:"Булеве значення (Так/Ні)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"sortOrder",children:"Порядок сортування"}),e.jsx(b,{id:"sortOrder",type:"number",value:(t==null?void 0:t.sortOrder)??r.sortOrder,onChange:s=>{const a=parseInt(s.target.value)||0;t?o({...t,sortOrder:a}):h({...r,sortOrder:a})}})]})]}),e.jsxs(re,{children:[e.jsx(m,{variant:"outline",onClick:()=>{d(!1),o(null),h({key:"",label:"",type:"text",sortOrder:0})},children:"Скасувати"}),e.jsx(m,{onClick:t?A:$,children:t?"Зберегти":"Додати"})]})]})})]})}export{Ee as Comparison};
