import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as p}from"./chunk-charts-BaLkbnPn.js";import{B as u}from"./button-DbOqy-bd.js";import{I as x}from"./input-CX5tNebo.js";import{C as v,d as N}from"./card-hmVZsDUq.js";import{B as L}from"./badge-C3GZfeW2.js";import{D as T,a as B,b as E,c as Q,d as R}from"./dialog-C08eaag5.js";import{L as h}from"./label-C5UElfPr.js";import{T as z}from"./textarea-qGHGkmRy.js";import{f as K,h as b,i as y,a3 as f,B as A,X as U}from"./index-D_0WsTs2.js";import{S as $}from"./search-DwN3ncs1.js";import{P as H,T as X}from"./trash-2-CKJaomP5.js";import{I as G}from"./image-B40kUbrB.js";import{S as J}from"./square-pen-GT-FYehh.js";import"./index-CbFhp7S4.js";import"./Combination-Cynz0wEz.js";function V(){return K({queryKey:["materials"],queryFn:()=>f.getAll()})}function W(){const n=b();return y({mutationFn:l=>f.create(l),onSuccess:()=>{n.invalidateQueries({queryKey:["materials"]})}})}function Y(){const n=b();return y({mutationFn:({id:l,data:m})=>f.update(l,m),onSuccess:()=>{n.invalidateQueries({queryKey:["materials"]})}})}function Z(){const n=b();return y({mutationFn:l=>f.delete(l),onSuccess:()=>{n.invalidateQueries({queryKey:["materials"]})}})}function xe(){const{data:n=[],isLoading:l}=V(),m=W(),j=Y(),S=Z(),[g,F]=p.useState(""),[r,t]=p.useState(null),[M,d]=p.useState(!1),c=p.useRef(null),{toast:a}=A(),w=n.filter(s=>{var i;return s.name.toLowerCase().includes(g.toLowerCase())||((i=s.description)==null?void 0:i.toLowerCase().includes(g.toLowerCase()))}),D=()=>{t({id:0,name:"",description:"",image:null,thumbnail:null,sortOrder:0}),d(!0)},O=s=>{t({...s,imagePreview:s.thumbnail||s.image||null,imageFile:null}),d(!0)},k=s=>{var P;const i=(P=s.target.files)==null?void 0:P[0];if(!i)return;if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(i.type)){a({title:"Помилка",description:"Тільки зображення (jpeg, jpg, png, gif, webp) дозволені!",variant:"destructive"});return}if(i.size>10*1024*1024){a({title:"Помилка",description:"Розмір файлу не повинен перевищувати 10MB",variant:"destructive"});return}const o=new FileReader;o.onloadend=()=>{t({...r,imageFile:i,imagePreview:o.result})},o.readAsDataURL(i)},q=()=>{if(!r)return;if(!r.name.trim()){a({title:"Помилка",description:"Заповніть назву матеріалу",variant:"destructive"});return}const s={name:r.name,description:r.description||void 0,image:r.imageFile||void 0,sortOrder:r.sortOrder||0};r.id===0?m.mutate(s,{onSuccess:()=>{a({title:"Створено",description:"Матеріал успішно створено"}),d(!1),t(null),c.current&&(c.current.value="")},onError:i=>{a({title:"Помилка",description:i.message||"Не вдалося створити матеріал",variant:"destructive"})}}):j.mutate({id:r.id,data:s},{onSuccess:()=>{a({title:"Збережено",description:"Матеріал успішно оновлено"}),d(!1),t(null),c.current&&(c.current.value="")},onError:i=>{a({title:"Помилка",description:i.message||"Не вдалося оновити матеріал",variant:"destructive"})}})},I=s=>{confirm(`Видалити матеріал "${s.name}"?`)&&S.mutate(s.id,{onSuccess:()=>{a({title:"Видалено",description:`Матеріал "${s.name}" видалено`,variant:"destructive"})},onError:i=>{a({title:"Помилка",description:i.message||"Не вдалося видалити матеріал",variant:"destructive"})}})};return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження матеріалів..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Пошук матеріалів...",value:g,onChange:s=>F(s.target.value),className:"pl-9"})]}),e.jsxs(u,{onClick:D,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Додати матеріал"]})]})})}),e.jsxs("div",{className:"grid gap-4",children:[w.map(s=>e.jsx(v,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[s.thumbnail&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:s.thumbnail,alt:s.name,className:"w-20 h-20 object-cover rounded-lg border"})}),!s.thumbnail&&s.image&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:s.image,alt:s.name,className:"w-20 h-20 object-cover rounded-lg border"})}),!s.thumbnail&&!s.image&&e.jsx("div",{className:"flex-shrink-0 w-20 h-20 bg-muted rounded-lg border flex items-center justify-center",children:e.jsx(G,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.description}),s.products&&s.products.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.products.map(i=>{const C=o=>o.includes("Стартовий")?"bg-blue-100 text-blue-800 border-blue-200":o.includes("Оптимальний")?"bg-green-100 text-green-800 border-green-200":o.includes("Преміум")?"bg-purple-100 text-purple-800 border-purple-200":"bg-secondary text-secondary-foreground";return e.jsx(L,{variant:"outline",className:C(i.name),children:i.name},i.id)})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>O(s),children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>I(s),children:e.jsx(X,{className:"h-4 w-4"})})]})]})})},s.id)),w.length===0&&e.jsx(v,{children:e.jsx(N,{className:"pt-6",children:e.jsx("div",{className:"text-center text-muted-foreground py-8",children:g?"Матеріали не знайдено":"Матеріали відсутні. Додайте перший матеріал."})})})]}),r&&e.jsx(T,{open:M,onOpenChange:d,children:e.jsxs(B,{className:"max-w-2xl",children:[e.jsx(E,{children:e.jsx(Q,{children:r.id===0?"Додати матеріал":"Редагувати матеріал"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"name",children:"Назва *"}),e.jsx(x,{id:"name",value:r.name,onChange:s=>t({...r,name:s.target.value}),placeholder:"Набір ниток – 20 шт"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Опис"}),e.jsx(z,{id:"description",value:r.description||"",onChange:s=>t({...r,description:s.target.value}),placeholder:"Набір ниток Peri, Китай",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"sortOrder",children:"Порядок сортування"}),e.jsx(x,{id:"sortOrder",type:"number",min:"0",value:r.sortOrder||0,onChange:s=>t({...r,sortOrder:parseInt(s.target.value)||0}),placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"image",children:"Зображення"}),r.imagePreview&&e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("img",{src:r.imagePreview,alt:"Preview",className:"w-full h-auto rounded-lg border"}),e.jsx(u,{variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{t({...r,imageFile:null,imagePreview:null}),c.current&&(c.current.value="")},children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsx(x,{id:"image",type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",ref:c,onChange:k,className:"cursor-pointer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Рекомендований розмір: 200×200px. Буде автоматично створено мініатюру."})]})]}),e.jsxs(R,{children:[e.jsx(u,{variant:"outline",onClick:()=>d(!1),children:"Скасувати"}),e.jsx(u,{onClick:q,disabled:m.isPending||j.isPending,children:m.isPending||j.isPending?"Збереження...":"Зберегти"})]})]})})]})}export{xe as Materials};
