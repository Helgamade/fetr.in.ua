import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as y}from"./chunk-charts-BaLkbnPn.js";import{B as A}from"./button-DQ1C11GY.js";import{B as z}from"./badge-CgkKlTsq.js";import{I as B}from"./input-CZNIRAwH.js";import{C as x,a as h,b as p,d as u}from"./card-CNOs6Zs8.js";import{c as E,D as U,f as K,F as J,e as Q,C as R,i as W,z as S,H as Y}from"./index-BeOWP8DU.js";import{A as G}from"./arrow-left-D8hye27w.js";import{C as V}from"./calendar-D7iJmJxJ.js";import{P as X}from"./package-DVKSTdG7.js";import{M as Z}from"./map-pin-LGipSZ7f.js";import{C as ee}from"./check-D-x7vzGj.js";import{C as se}from"./copy-qgjtOSzL.js";import{C as te}from"./credit-card-B9Xxi3xo.js";import{C as re}from"./circle-CMoWpalN.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],de=E("circle-check",ae),ie={created:"Замовлення оформлено",accepted:"Прийнято",paid:"Оплачено",packed:"Спаковано",shipped:"Відправлено",arrived:"Прибуло",completed:"Залишити відгук",processing:"В обробці",assembled:"Зібрано",in_transit:"В дорозі"},le={created:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",accepted:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",packed:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",shipped:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200",arrived:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200",completed:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",assembled:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200",in_transit:"bg-violet-100 text-violet-800 dark:bg-violet-900 dark:text-violet-200"},ne={nova_poshta:"Нова Пошта",ukrposhta:"Укрпошта",pickup:"Самовивіз"},I=a=>{const d=typeof a=="string"?new Date(a):a,i=String(d.getHours()).padStart(2,"0"),j=String(d.getMinutes()).padStart(2,"0"),g=String(d.getDate()).padStart(2,"0"),s=String(d.getMonth()+1).padStart(2,"0"),b=d.getFullYear();return`${i}:${j}, ${g}.${s}.${b}`},ce=a=>{const d=[],i=typeof a.createdAt=="string"?new Date(a.createdAt):a.createdAt;return d.push({date:i,text:"Статус изменен: Новый",completed:!0}),d};function Ce(){const{id:a}=U(),d=K(),{user:i}=J(),{data:j=[]}=Q(),{toast:g}=R(),[s,b]=y.useState(null),[F,T]=y.useState(!0),[_,N]=y.useState(!1),{data:w=[]}=W({queryKey:["order-history",a],queryFn:()=>S.getHistory(a),enabled:!!a});y.useEffect(()=>{a&&S.getOrder(a).then(t=>{if((i==null?void 0:i.role)!=="admin"&&t.user_id&&t.user_id!==(i==null?void 0:i.id)){d("/user/orders");return}b(t)}).catch(t=>{console.error("Error loading order:",t),d("/user/orders")}).finally(()=>T(!1))},[a,i,d]);const $=t=>{var l;return((l=j.find(r=>r.code===t))==null?void 0:l.name)||t},O=async()=>{if(s!=null&&s.deliveryTtn)try{await navigator.clipboard.writeText(s.deliveryTtn),N(!0),g({title:"Скопійовано",description:"ТТН скопійовано в буфер обміну"}),setTimeout(()=>N(!1),2e3)}catch{g({title:"Помилка",description:"Не вдалося скопіювати ТТН",variant:"destructive"})}};if(F)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження замовлення..."})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30",children:e.jsx("div",{className:"text-muted-foreground",children:"Замовлення не знайдено"})});const k=w.length>0?w.map(t=>({date:typeof t.date=="string"?new Date(t.date):t.date,text:t.text,completed:t.completed,user:t.user||null})):ce(s),C=s.orderNumber||s.id||a||"";return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsxs("title",{children:["Замовлення ",C," | FetrInUA"]}),e.jsx("meta",{property:"og:title",content:`Замовлення ${C} | FetrInUA`})]}),e.jsx("div",{className:"min-h-screen bg-muted/30",children:e.jsxs("div",{className:"container max-w-7xl mx-auto space-y-6 p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>d("/user/orders"),children:e.jsx(G,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("h1",{className:"text-2xl font-semibold",children:["Замовлення ",s.id]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx(z,{className:le[s.status],children:ie[s.status]}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(V,{className:"h-4 w-4"}),I(s.createdAt)]})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(p,{children:["Товари в замовленні (",s.items.length,")"]})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-4",children:s.items.map((t,l)=>{const r=j.find(c=>c.code===t.productId),n=(r==null?void 0:r.basePrice)||0,f=r==null?void 0:r.salePrice,v=f&&f<n,P=f||n,D=v?Math.round((n-(f||0))/n*100):0,H=t.selectedOptions.reduce((c,o)=>{const m=r==null?void 0:r.options.find(q=>q.code===o);return c+((m==null?void 0:m.price)||0)},0),L=(P+H)*t.quantity,M=`${t.productId}_${l}_${JSON.stringify([...t.selectedOptions].sort())}`;return e.jsx("div",{className:"pb-4 border-b last:border-0 last:pb-0",children:e.jsxs("div",{className:"flex gap-3 sm:gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:r!=null&&r.images&&r.images.length>0?e.jsx("img",{src:r.images[0],alt:r.name,className:"w-16 h-16 sm:w-20 sm:h-20 object-cover rounded"}):e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-muted rounded flex items-center justify-center",children:e.jsx(X,{className:"h-6 w-6 sm:h-8 sm:w-8 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[v&&e.jsxs("div",{className:"bg-yellow-500 text-white text-xs font-bold px-2 py-0.5 rounded-full flex-shrink-0",children:["-",D,"%"]}),e.jsx("div",{className:"font-medium text-base sm:text-lg flex-1 min-w-0",children:$(t.productId)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"text-sm sm:text-base text-muted-foreground",children:["Кількість: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[t.quantity," шт."]})]}),e.jsx("div",{className:"flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:[n," ₴"]}),e.jsxs("span",{className:"text-base sm:text-lg font-bold",children:[P," ₴"]})]}):e.jsxs("span",{className:"text-base sm:text-lg font-bold",children:[n," ₴"]})})]}),t.selectedOptions.length>0&&e.jsxs("div",{className:"mb-2 mt-2",children:[e.jsx("div",{className:"text-xs sm:text-sm font-semibold text-foreground mb-2",children:"Додаткові опції:"}),e.jsx("div",{className:"space-y-1.5",children:t.selectedOptions.map(c=>{const o=r==null?void 0:r.options.find(m=>m.code===c);return o?e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm bg-primary/10 border border-primary/20 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:o.name}),e.jsxs("span",{className:"font-bold text-primary",children:["+",o.price," ₴"]})]},c):null})})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium",children:"Сума за товар:"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-primary",children:[L.toFixed(0)," ₴"]})]})})]})]})},M)})})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Доставка"]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:ne[s.delivery.method]}),s.delivery.city&&e.jsxs("div",{className:"text-sm",children:["м. ",s.delivery.city]}),s.delivery.warehouse&&e.jsx("div",{className:"text-sm",children:s.delivery.warehouse}),s.delivery.address&&e.jsx("div",{className:"text-sm",children:s.delivery.address}),s.delivery.postIndex&&e.jsxs("div",{className:"text-sm",children:["Індекс: ",s.delivery.postIndex]}),s.deliveryTtn&&(s.delivery.method==="nova_poshta"||s.delivery.method==="ukrposhta")&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"ТТН"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{value:s.deliveryTtn,readOnly:!0,className:"flex-1 font-mono"}),e.jsx(A,{onClick:O,variant:"outline",size:"icon",className:"flex-shrink-0",children:_?e.jsx(ee,{className:"h-4 w-4 text-green-600"}):e.jsx(se,{className:"h-4 w-4"})})]})]})]})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Оплата"]})}),e.jsx(u,{children:e.jsxs("div",{className:"text-sm",children:[s.payment.method==="wayforpay"&&"Онлайн оплата (WayForPay)",s.payment.method==="nalojka"&&"Оплата при отриманні",s.payment.method==="fopiban"&&"Оплата на рахунок ФОП"]})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(p,{children:"Історія замовлення"})}),e.jsx(u,{children:e.jsx("div",{className:"relative",children:k.map((t,l)=>e.jsxs("div",{className:"relative pl-8 pb-6 last:pb-0",children:[l<k.length-1&&e.jsx("div",{className:"absolute left-3 top-6 bottom-0 w-0.5 bg-border"}),e.jsx("div",{className:"absolute left-0 top-1",children:t.completed?e.jsx(de,{className:"h-6 w-6 text-primary fill-primary/20"}):e.jsx(re,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:[I(t.date),t.user&&e.jsxs("span",{className:"text-muted-foreground ml-2",children:[", ",t.user]})]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:t.text})]})]},l))})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(p,{children:"Підсумок"})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Товари (",s.items.length,")"]}),e.jsxs("span",{children:["₴",s.subtotal]})]}),s.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Знижка"}),e.jsxs("span",{children:["-₴",s.discount]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Доставка"}),e.jsx("span",{children:s.deliveryCost>0?`₴${s.deliveryCost}`:"Безкоштовно"})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2 mt-2",children:[e.jsx("span",{children:"Всього"}),e.jsxs("span",{children:["₴",s.total]})]})]})})]})})]}),e.jsx("div",{className:"border-t border-border my-8"}),e.jsxs("footer",{className:"text-center space-y-2 pb-8",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"© 2026 FetrInUA. Всі права захищені"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Зроблено з ❤️ в Україні"})]})]})})]})}export{Ce as default};
