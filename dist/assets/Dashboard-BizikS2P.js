import{j as e}from"./chunk-react-CHUe_c_M.js";import{C as i,a as n,b as c,d as o,c as R}from"./card-DcmemaXX.js";import{B as p}from"./badge-CTncAuPo.js";import{u as X}from"./useOrders-BQm_7tpr.js";import{u as Y}from"./useTexts-sen_TcVY.js";import{d as z}from"./index-Dv87KhRC.js";import{u as H}from"./chunk-query-BDB5idE8.js";import{bg as J,b8 as Q,bh as Z,ab as ee,bi as se,bj as te,aJ as f,bk as ae,bl as re}from"./chunk-vendor-C_GYGcpd.js";import{R as T,L as de,C as $,X as L,Y as B,T as O,a as le,B as ie,b as ne}from"./chunk-charts-BYFY3lFy.js";import"./chunk-lottie-DoMt_38f.js";import"./chunk-radix-BYx9rzOz.js";import"./chunk-router-BMV24Bow.js";const ce={created:"Замовлення оформлено",accepted:"Прийнято",paid:"Оплачено",packed:"Спаковано",shipped:"Відправлено",arrived:"Прибуло",completed:"Залишити відгук"},oe={direct:"Прямий перехід",google:"Google",facebook:"Facebook",instagram:"Instagram",telegram:"Telegram",viber:"Viber"},me={direct:"bg-gray-400",google:"bg-blue-500",facebook:"bg-blue-700",instagram:"bg-pink-500",telegram:"bg-sky-500",viber:"bg-violet-500"};function we(){var k,w,C,S,D;const{data:d=[],isLoading:A}=X(),{data:U=[]}=z(),{data:j=[]}=Y(),{data:x}=H({queryKey:["dashboard-traffic"],queryFn:async()=>{const s=await fetch("/api/analytics/stats",{credentials:"include"});return s.ok?s.json():null},staleTime:5*60*1e3}),l=d.length,g=d.reduce((s,t)=>s+(Number(t.total)||0),0),F=l>0?g/l:0;d.filter(s=>s.status==="completed").length;const E=new Set(d.map(s=>{var t;return(t=s.customer)==null?void 0:t.phone}).filter(Boolean)).size,I=[{title:"Загальний дохід",value:`₴${Number(g).toFixed(2)}`,change:"+0%",trend:"up",icon:J},{title:"Замовлень",value:l,change:"+0%",trend:"up",icon:Q},{title:"Середній чек",value:`₴${Number(F).toFixed(2)}`,change:"+0%",trend:"up",icon:Z},{title:"Постійних клієнтів",value:E,change:"+0%",trend:"up",icon:ee}],v=["created","accepted","paid","packed","shipped","arrived","completed"],N=d.reduce((s,t)=>(v.includes(t.status)&&(s[t.status]=(s[t.status]||0)+1),s),{}),K=v.filter(s=>N[s]!==void 0),M=d.reduce((s,t)=>{var r;const a=((r=t.payment)==null?void 0:r.method)||"unknown";return s[a]=(s[a]||0)+1,s},{}),P=d.reduce((s,t)=>{var r;const a=((r=t.delivery)==null?void 0:r.method)||"unknown";return s[a]=(s[a]||0)+1,s},{}),q={nova_poshta:"Нова Пошта",ukrposhta:"Укрпошта",pickup:"Самовивіз",unknown:"Невідомо"},_=((k=j.find(s=>s.key==="checkout.payment.wayforpay.title"))==null?void 0:k.value)||"Онлайн оплата",G=((w=j.find(s=>s.key==="checkout.payment.nalojka.title"))==null?void 0:w.value)||"Оплата при отриманні",V=((C=j.find(s=>s.key==="checkout.payment.fop.title"))==null?void 0:C.value)||"Оплата на рахунок ФОП",W={wayforpay:_,nalojka:G,fopiban:V,unknown:"Невідомо"},u=new Map;d.forEach(s=>{var t;(t=s.items)==null||t.forEach(a=>{const r=U.find(h=>h.code===a.productId),m=(r==null?void 0:r.name)||a.productId;if(u.has(a.productId)){const h=u.get(a.productId);h.count+=a.quantity}else u.set(a.productId,{name:m,count:a.quantity})})});const y=Array.from(u.values()).sort((s,t)=>t.count-s.count).slice(0,5),b=Array.from({length:7},(s,t)=>{const a=new Date;a.setDate(a.getDate()-(6-t));const r=d.filter(m=>new Date(m.createdAt).toDateString()===a.toDateString());return{date:a.toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit"}),revenue:r.reduce((m,h)=>m+(Number(h.total)||0),0),orders:r.length}});return A?e.jsx("div",{className:"p-6",children:"Завантаження..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:I.map(s=>e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:s.title}),e.jsx(s.icon,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.value}),e.jsxs("div",{className:`flex items-center text-sm ${s.trend==="up"?"text-green-600":"text-red-600"}`,children:[s.trend==="up"?e.jsx(se,{className:"h-4 w-4 mr-1"}):e.jsx(te,{className:"h-4 w-4 mr-1"}),s.change," за місяць"]})]})]},s.title))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{children:"Дохід за тиждень"})}),e.jsx(o,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(de,{data:b,children:[e.jsx($,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(L,{dataKey:"date",className:"text-xs"}),e.jsx(B,{className:"text-xs"}),e.jsx(O,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:s=>[`₴${Number(s).toFixed(2)}`,"Дохід"]}),e.jsx(le,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))"}})]})})})})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{children:"Замовлення за тиждень"})}),e.jsx(o,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(ie,{data:b,children:[e.jsx($,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(L,{dataKey:"date",className:"text-xs"}),e.jsx(B,{className:"text-xs"}),e.jsx(O,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:s=>[s,"Замовлень"]}),e.jsx(ne,{dataKey:"orders",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{children:"Топ товари"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:y.length>0?y.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.count," продажів"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold",children:[s.count," шт."]})})]},s.name)):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Немає даних про топ товари"})})})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{children:"Замовлення за статусом"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:K.map(s=>{const t=N[s]||0;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm",children:ce[s]||s})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${l>0?t/l*100:0}%`}})}),e.jsx("span",{className:"text-sm font-medium w-8 text-right",children:t})]})]},s)})})})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{children:"Замовлення за способом оплати"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(M).map(([s,t])=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm",children:W[s]||s})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${l>0?t/l*100:0}%`}})}),e.jsx("span",{className:"text-sm font-medium w-8 text-right",children:t})]})]},s))})})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{children:"Замовлення за способом доставки"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(P).map(([s,t])=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm",children:q[s]||s})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${l>0?t/l*100:0}%`}})}),e.jsx("span",{className:"text-sm font-medium w-8 text-right",children:t})]})]},s))})})]})]}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-muted-foreground"}),"Джерела трафіку (30 днів)"]}),e.jsx(R,{children:"Звідки приходять відвідувачі"})]}),e.jsx(o,{children:((S=x.trafficSources)==null?void 0:S.length)>0?e.jsx("div",{className:"space-y-3",children:(()=>{const s=x.trafficSources.reduce((t,a)=>t+Number(a.sessions),0);return x.trafficSources.slice(0,8).map(t=>{const a=t.source||"direct",r=s>0?Math.round(Number(t.sessions)/s*100):0,m=me[a]||"bg-emerald-500";return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full flex-shrink-0 ${m}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:oe[a]||a}),t.medium&&e.jsx(p,{variant:"outline",className:"text-xs px-1 py-0",children:t.medium})]}),e.jsx("div",{className:"w-full h-1.5 bg-muted rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${m}`,style:{width:`${r}%`}})})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:"text-sm font-semibold",children:t.sessions}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r,"%"]})]})]},`${a}-${t.medium}`)})})()}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Немає даних за цей період"})})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-muted-foreground"}),"Рекламні кампанії (30 днів)"]}),e.jsx(R,{children:"Статистика по UTM-кампаніях"})]}),e.jsx(o,{children:((D=x.utmCampaigns)==null?void 0:D.length)>0?e.jsx("div",{className:"space-y-3",children:x.utmCampaigns.slice(0,8).map(s=>e.jsxs("div",{className:"flex items-start justify-between gap-3 pb-2 border-b last:border-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:s.campaign}),e.jsxs("div",{className:"flex gap-1.5 mt-0.5 flex-wrap",children:[s.source&&e.jsx(p,{variant:"secondary",className:"text-xs px-1.5 py-0",children:s.source}),s.medium&&e.jsx(p,{variant:"outline",className:"text-xs px-1.5 py-0",children:s.medium})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("div",{className:"text-sm font-semibold",children:[s.sessions," сес."]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.users," користувачів"]})]})]},s.campaign))}):e.jsxs("p",{className:"text-sm text-muted-foreground text-center py-4",children:["Даних по кампаніях ще немає.",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Додайте UTM-мітки до рекламних посилань"})]})})]})]})]})}export{we as Dashboard};
