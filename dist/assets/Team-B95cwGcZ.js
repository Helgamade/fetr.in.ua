import{r as x,j as e}from"./chunk-react-CHUe_c_M.js";import{B as l}from"./button-Dirq6-S7.js";import{I as m}from"./input-E_DkKYix.js";import{C as g,a as z,b as P,d as N}from"./card-DcmemaXX.js";import{D as R,a as q,b as B,c as H,d as Q}from"./dialog-CQ-l8du7.js";import{L as c}from"./label-CUlRyR4d.js";import{T as Y}from"./textarea-BBXtoPox.js";import{S as $}from"./switch-C5BnPKBx.js";import{f as A}from"./index-Dv87KhRC.js";import{u as G,a as J,b as K,c as V}from"./useTeam-BZpeqaVP.js";import{bm as W,a_ as X,aM as Z,ax as ee,bo as se,aY as te,a8 as ae,bp as re}from"./chunk-vendor-C_GYGcpd.js";import"./chunk-lottie-DoMt_38f.js";import"./chunk-radix-BYx9rzOz.js";import"./chunk-query-BDB5idE8.js";import"./chunk-router-BMV24Bow.js";function Ne(){const{toast:n}=A(),[f,S]=x.useState(""),[t,i]=x.useState(null),[b,d]=x.useState(!1),[C,w]=x.useState(!1),p=x.useRef(null),{data:o=[],isLoading:D}=G(!1),k=J(),h=K(),y=V(),I=()=>{i({id:0,name:"",role:"",photo:null,description:"",sort_order:0,is_active:!0}),d(!0)},M=s=>{i({...s}),d(!0)},T=()=>{if(!t)return;if(!t.name||!t.role){n({title:"Помилка",description:"Ім'я та посада обов'язкові",variant:"destructive"});return}const s={name:t.name,role:t.role,photo:t.photo,description:t.description||null,sort_order:t.sort_order||0,is_active:t.is_active};t.id===0?k.mutate(s,{onSuccess:()=>{n({title:"Створено",description:"Члена команди успішно створено"}),d(!1),i(null)},onError:a=>{n({title:"Помилка",description:a.message||"Не вдалося створити члена команди",variant:"destructive"})}}):h.mutate({id:t.id,data:s},{onSuccess:()=>{n({title:"Оновлено",description:"Члена команди успішно оновлено"}),d(!1),i(null)},onError:a=>{n({title:"Помилка",description:a.message||"Не вдалося оновити члена команди",variant:"destructive"})}})},F=s=>{confirm(`Ви впевнені, що хочете видалити "${s.name}"?`)&&y.mutate(s.id,{onSuccess:()=>{n({title:"Видалено",description:"Члена команди успішно видалено",variant:"destructive"})},onError:a=>{n({title:"Помилка",description:a.message||"Не вдалося видалити члена команди",variant:"destructive"})}})},L=async s=>{w(!0);try{const a=new FormData;a.append("image",s);const r=await fetch("/api/team/upload-image",{method:"POST",body:a});if(!r.ok)throw new Error("Не вдалося завантажити зображення");const u=await r.json();t&&i({...t,photo:u.url}),n({title:"Успіх",description:"Зображення завантажено"})}catch(a){n({title:"Помилка",description:a.message||"Не вдалося завантажити зображення",variant:"destructive"})}finally{w(!1)}},E=s=>{var r;const a=(r=s.target.files)==null?void 0:r[0];a&&L(a),p.current&&(p.current.value="")},O=s=>{const a=o.findIndex(v=>v.id===s.id);if(a<=0)return;const r=o[a-1],u=r.sort_order,j=s.sort_order;h.mutate({id:s.id,data:{...s,sort_order:u}}),h.mutate({id:r.id,data:{...r,sort_order:j}})},U=s=>{const a=o.findIndex(v=>v.id===s.id);if(a>=o.length-1)return;const r=o[a+1],u=r.sort_order,j=s.sort_order;h.mutate({id:s.id,data:{...s,sort_order:u}}),h.mutate({id:r.id,data:{...r,sort_order:j}})},_=o.filter(s=>s.name.toLowerCase().includes(f.toLowerCase())||s.role.toLowerCase().includes(f.toLowerCase()));return D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження команди..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(z,{children:e.jsx(P,{children:"Наша команда"})}),e.jsx(N,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Пошук по імені або посаді...",value:f,onChange:s=>S(s.target.value),className:"pl-9"})]}),e.jsxs(l,{onClick:I,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Додати члена команди"]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:_.map(s=>e.jsxs(g,{className:"overflow-hidden",children:[e.jsxs("div",{className:"aspect-square relative bg-muted",children:[s.photo?e.jsx("img",{src:s.photo,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:"Немає фото"}),!s.is_active&&e.jsx("div",{className:"absolute top-2 right-2 bg-destructive text-destructive-foreground px-2 py-1 rounded text-xs font-semibold",children:"Неактивний"})]}),e.jsxs(N,{className:"pt-4",children:[e.jsx("h3",{className:"font-semibold text-base mb-1",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:s.role}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{variant:"outline",size:"icon",onClick:()=>O(s),disabled:o.findIndex(a=>a.id===s.id)===0,children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"icon",onClick:()=>U(s),disabled:o.findIndex(a=>a.id===s.id)===o.length-1,children:e.jsx(ee,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",size:"icon",onClick:()=>M(s),children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(l,{variant:"destructive",size:"icon",onClick:()=>F(s),disabled:y.isPending,children:e.jsx(te,{className:"h-4 w-4"})})]})]})]})]},s.id))}),_.length===0&&e.jsx(g,{children:e.jsx(N,{className:"py-12 text-center text-muted-foreground",children:"Членів команди не знайдено"})}),e.jsx(R,{open:b,onOpenChange:d,children:e.jsxs(q,{className:"sm:max-w-[600px]",children:[e.jsx(B,{children:e.jsx(H,{children:(t==null?void 0:t.id)===0?"Додати нового члена команди":"Редагувати члена команди"})}),t&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Ім'я *"}),e.jsx(m,{id:"name",value:t.name,onChange:s=>i({...t,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"role",children:"Посада *"}),e.jsx(m,{id:"role",value:t.role,onChange:s=>i({...t,role:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"photo",children:"Фото"}),e.jsxs("div",{className:"flex items-center gap-4",children:[t.photo&&e.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden bg-muted flex-shrink-0",children:e.jsx("img",{src:t.photo,alt:"Preview",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{id:"photo",value:t.photo||"",onChange:s=>i({...t,photo:s.target.value}),placeholder:"URL зображення або завантажте файл"}),e.jsx(l,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>{var s;return(s=p.current)==null?void 0:s.click()},disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2 animate-spin"}),"Завантаження..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Завантажити з комп'ютера"]})}),e.jsx("input",{ref:p,type:"file",accept:"image/*",className:"hidden",onChange:E})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Опис"}),e.jsx(Y,{id:"description",value:t.description||"",onChange:s=>i({...t,description:s.target.value}),rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"sort_order",children:"Порядок сортування"}),e.jsx(m,{id:"sort_order",type:"number",value:t.sort_order,onChange:s=>i({...t,sort_order:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"is_active",checked:t.is_active,onCheckedChange:s=>i({...t,is_active:s})}),e.jsx(c,{htmlFor:"is_active",children:"Активний"})]})]}),e.jsxs(Q,{children:[e.jsx(l,{variant:"outline",onClick:()=>d(!1),children:"Скасувати"}),e.jsx(l,{onClick:T,children:"Зберегти"})]})]})})]})}export{Ne as Team};
