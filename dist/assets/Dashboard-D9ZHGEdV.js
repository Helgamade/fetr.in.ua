import{j as e}from"./chunk-lottie-CUWK48HK.js";import{C as n,a as l,b as c,d as o,c as T}from"./card-hmVZsDUq.js";import{B as f}from"./badge-C3GZfeW2.js";import{u as W}from"./useOrders-BDCuqV9E.js";import{u as X}from"./useTexts-B3kGWpp3.js";import{c as p,e as Y,f as Q}from"./index-D_0WsTs2.js";import{S as J}from"./shopping-cart-DxZqKqo9.js";import{T as Z,G as ee}from"./trending-up-B6s5qRQw.js";import{U as se}from"./users-BxZWrCo7.js";import{f as A,L as te,C as L,X as M,Y as _,T as R,h as ae,B as re,i as de}from"./chunk-charts-BaLkbnPn.js";import{P as g}from"./package-k1v3jaGb.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],ne=p("arrow-down-right",ie);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],ce=p("arrow-up-right",le);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],me=p("dollar-sign",oe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],he=p("megaphone",xe),ue={created:"Замовлення оформлено",accepted:"Прийнято",paid:"Оплачено",packed:"Спаковано",shipped:"Відправлено",arrived:"Прибуло",completed:"Залишити відгук"},pe={direct:"Прямий перехід",google:"Google",facebook:"Facebook",instagram:"Instagram",telegram:"Telegram",viber:"Viber"},je={direct:"bg-gray-400",google:"bg-blue-500",facebook:"bg-blue-700",instagram:"bg-pink-500",telegram:"bg-sky-500",viber:"bg-violet-500"};function $e(){var w,C,S,D,$;const{data:d=[],isLoading:B}=W(),{data:O=[]}=Y(),{data:j=[]}=X(),{data:x}=Q({queryKey:["dashboard-traffic"],queryFn:async()=>{const s=await fetch("/api/analytics/stats",{credentials:"include"});return s.ok?s.json():null},staleTime:5*60*1e3}),i=d.length,v=d.reduce((s,t)=>s+(Number(t.total)||0),0),q=i>0?v/i:0;d.filter(s=>s.status==="completed").length;const U=new Set(d.map(s=>{var t;return(t=s.customer)==null?void 0:t.phone}).filter(Boolean)).size,F=[{title:"Загальний дохід",value:`₴${Number(v).toFixed(2)}`,change:"+0%",trend:"up",icon:me},{title:"Замовлень",value:i,change:"+0%",trend:"up",icon:J},{title:"Середній чек",value:`₴${Number(q).toFixed(2)}`,change:"+0%",trend:"up",icon:Z},{title:"Постійних клієнтів",value:U,change:"+0%",trend:"up",icon:se}],N=["created","accepted","paid","packed","shipped","arrived","completed"],y=d.reduce((s,t)=>(N.includes(t.status)&&(s[t.status]=(s[t.status]||0)+1),s),{}),I=N.filter(s=>y[s]!==void 0),E=d.reduce((s,t)=>{var r;const a=((r=t.payment)==null?void 0:r.method)||"unknown";return s[a]=(s[a]||0)+1,s},{}),P=d.reduce((s,t)=>{var r;const a=((r=t.delivery)==null?void 0:r.method)||"unknown";return s[a]=(s[a]||0)+1,s},{}),H={nova_poshta:"Нова Пошта",ukrposhta:"Укрпошта",pickup:"Самовивіз",unknown:"Невідомо"},K=((w=j.find(s=>s.key==="checkout.payment.wayforpay.title"))==null?void 0:w.value)||"Онлайн оплата",G=((C=j.find(s=>s.key==="checkout.payment.nalojka.title"))==null?void 0:C.value)||"Оплата при отриманні",z=((S=j.find(s=>s.key==="checkout.payment.fop.title"))==null?void 0:S.value)||"Оплата на рахунок ФОП",V={wayforpay:K,nalojka:G,fopiban:z,unknown:"Невідомо"},u=new Map;d.forEach(s=>{var t;(t=s.items)==null||t.forEach(a=>{const r=O.find(h=>h.code===a.productId),m=(r==null?void 0:r.name)||a.productId;if(u.has(a.productId)){const h=u.get(a.productId);h.count+=a.quantity}else u.set(a.productId,{name:m,count:a.quantity})})});const b=Array.from(u.values()).sort((s,t)=>t.count-s.count).slice(0,5),k=Array.from({length:7},(s,t)=>{const a=new Date;a.setDate(a.getDate()-(6-t));const r=d.filter(m=>new Date(m.createdAt).toDateString()===a.toDateString());return{date:a.toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit"}),revenue:r.reduce((m,h)=>m+(Number(h.total)||0),0),orders:r.length}});return B?e.jsx("div",{className:"p-6",children:"Завантаження..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:F.map(s=>e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:s.title}),e.jsx(s.icon,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.value}),e.jsxs("div",{className:`flex items-center text-sm ${s.trend==="up"?"text-green-600":"text-red-600"}`,children:[s.trend==="up"?e.jsx(ce,{className:"h-4 w-4 mr-1"}):e.jsx(ne,{className:"h-4 w-4 mr-1"}),s.change," за місяць"]})]})]},s.title))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(c,{children:"Дохід за тиждень"})}),e.jsx(o,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(te,{data:k,children:[e.jsx(L,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(M,{dataKey:"date",className:"text-xs"}),e.jsx(_,{className:"text-xs"}),e.jsx(R,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:s=>[`₴${Number(s).toFixed(2)}`,"Дохід"]}),e.jsx(ae,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))"}})]})})})})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(c,{children:"Замовлення за тиждень"})}),e.jsx(o,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(re,{data:k,children:[e.jsx(L,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(M,{dataKey:"date",className:"text-xs"}),e.jsx(_,{className:"text-xs"}),e.jsx(R,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:s=>[s,"Замовлень"]}),e.jsx(de,{dataKey:"orders",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(c,{children:"Топ товари"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:b.length>0?b.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.count," продажів"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold",children:[s.count," шт."]})})]},s.name)):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Немає даних про топ товари"})})})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(c,{children:"Замовлення за статусом"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:I.map(s=>{const t=y[s]||0;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm",children:ue[s]||s})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${i>0?t/i*100:0}%`}})}),e.jsx("span",{className:"text-sm font-medium w-8 text-right",children:t})]})]},s)})})})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(c,{children:"Замовлення за способом оплати"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(E).map(([s,t])=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm",children:V[s]||s})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${i>0?t/i*100:0}%`}})}),e.jsx("span",{className:"text-sm font-medium w-8 text-right",children:t})]})]},s))})})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(c,{children:"Замовлення за способом доставки"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(P).map(([s,t])=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm",children:H[s]||s})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${i>0?t/i*100:0}%`}})}),e.jsx("span",{className:"text-sm font-medium w-8 text-right",children:t})]})]},s))})})]})]}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}),"Джерела трафіку (30 днів)"]}),e.jsx(T,{children:"Звідки приходять відвідувачі"})]}),e.jsx(o,{children:((D=x.trafficSources)==null?void 0:D.length)>0?e.jsx("div",{className:"space-y-3",children:(()=>{const s=x.trafficSources.reduce((t,a)=>t+Number(a.sessions),0);return x.trafficSources.slice(0,8).map(t=>{const a=t.source||"direct",r=s>0?Math.round(Number(t.sessions)/s*100):0,m=je[a]||"bg-emerald-500";return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full flex-shrink-0 ${m}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:pe[a]||a}),t.medium&&e.jsx(f,{variant:"outline",className:"text-xs px-1 py-0",children:t.medium})]}),e.jsx("div",{className:"w-full h-1.5 bg-muted rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${m}`,style:{width:`${r}%`}})})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:"text-sm font-semibold",children:t.sessions}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r,"%"]})]})]},`${a}-${t.medium}`)})})()}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Немає даних за цей період"})})]}),e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-muted-foreground"}),"Рекламні кампанії (30 днів)"]}),e.jsx(T,{children:"Статистика по UTM-кампаніях"})]}),e.jsx(o,{children:(($=x.utmCampaigns)==null?void 0:$.length)>0?e.jsx("div",{className:"space-y-3",children:x.utmCampaigns.slice(0,8).map(s=>e.jsxs("div",{className:"flex items-start justify-between gap-3 pb-2 border-b last:border-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:s.campaign}),e.jsxs("div",{className:"flex gap-1.5 mt-0.5 flex-wrap",children:[s.source&&e.jsx(f,{variant:"secondary",className:"text-xs px-1.5 py-0",children:s.source}),s.medium&&e.jsx(f,{variant:"outline",className:"text-xs px-1.5 py-0",children:s.medium})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("div",{className:"text-sm font-semibold",children:[s.sessions," сес."]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.users," користувачів"]})]})]},s.campaign))}):e.jsxs("p",{className:"text-sm text-muted-foreground text-center py-4",children:["Даних по кампаніях ще немає.",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Додайте UTM-мітки до рекламних посилань"})]})})]})]})]})}export{$e as Dashboard};
