import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as x}from"./chunk-charts-BaLkbnPn.js";import{B as o}from"./button-NrqM-Eov.js";import{I as g}from"./input-D93KF8x4.js";import{T as M}from"./textarea-UjcpLEoS.js";import{C as _,d as N}from"./card-BflDPH_v.js";import{D as B,a as R,b as q,c as Q,d as A}from"./dialog-M76gbJny.js";import{L as h}from"./label-CUjGEuR_.js";import{S as H}from"./switch-BCq8M6Fn.js";import{z as X,B as G,X as J}from"./index-CmBNacJt.js";import{u as K,a as V,b as W,c as Y,E as Z}from"./useInstagram-fMMJWq0d.js";import{S as $}from"./search-DESSt1gA.js";import{P as ee,T as se}from"./trash-2-CIB2onwG.js";import{C as te}from"./chevron-up-CMy3vpJ8.js";import{C as ae}from"./chevron-down-DICVbr64.js";import{S as re}from"./square-pen-CaQzSHUZ.js";import{U as ie}from"./upload-CW_91bKi.js";import"./index-CK4iyky9.js";import"./Combination-mbMryq0B.js";import"./index-ZeZSZmiz.js";function ye(){const{toast:n}=X(),[w,k]=x.useState(""),[t,i]=x.useState(null),[S,m]=x.useState(!1),[C,I]=x.useState(!1),p=x.useRef(null),{data:c=[],isLoading:D}=K(),b=V(),u=W(),y=Y(),f=c.filter(s=>s.instagram_url.toLowerCase().includes(w.toLowerCase())),P=()=>{i({id:0,image_url:"",description:"",instagram_url:"",likes_count:0,comments_count:0,sort_order:c.length>0?Math.max(...c.map(s=>s.sort_order))+1:0,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),m(!0)},O=s=>{i({...s}),m(!0)},E=()=>{if(!t)return;if(!t.image_url){n({title:"Помилка",description:"Зображення обов'язкове",variant:"destructive"});return}const s={image_url:t.image_url,description:t.description||null,instagram_url:t.instagram_url||"",likes_count:t.likes_count||0,comments_count:t.comments_count||0,sort_order:t.sort_order||0,is_active:t.is_active};t.id===0?b.mutate(s,{onSuccess:()=>{n({title:"Створено",description:"Пост Instagram успішно створено"}),m(!1),i(null)},onError:a=>{n({title:"Помилка",description:a.message||"Не вдалося створити пост",variant:"destructive"})}}):u.mutate({id:t.id,data:s},{onSuccess:()=>{n({title:"Оновлено",description:"Пост Instagram успішно оновлено"}),m(!1),i(null)},onError:a=>{n({title:"Помилка",description:a.message||"Не вдалося оновити пост",variant:"destructive"})}})},F=s=>{confirm("Ви впевнені, що хочете видалити цей пост Instagram?")&&y.mutate(s.id,{onSuccess:()=>{n({title:"Видалено",description:"Пост Instagram успішно видалено",variant:"destructive"})},onError:a=>{n({title:"Помилка",description:a.message||"Не вдалося видалити пост",variant:"destructive"})}})},T=async s=>{I(!0);const a=new FormData;a.append("image",s);try{const r=await fetch("/api/instagram/upload-image",{method:"POST",body:a});if(!r.ok)throw new Error("Помилка завантаження файлу");const l=await r.json();i({...t,image_url:l.url}),n({title:"Успішно",description:"Зображення завантажено"})}catch(r){n({title:"Помилка",description:r.message||"Не вдалося завантажити зображення",variant:"destructive"})}finally{I(!1)}},L=s=>{var r;const a=(r=s.target.files)==null?void 0:r[0];a&&T(a),p.current&&(p.current.value="")},U=s=>{const a=c.findIndex(r=>r.id===s.id);if(a>0){const r=[...c],l=r[a],d=r[a-1],j=d.sort_order,v=l.sort_order;u.mutate({id:l.id,data:{...l,sort_order:j}}),u.mutate({id:d.id,data:{...d,sort_order:v}})}},z=s=>{const a=c.findIndex(r=>r.id===s.id);if(a<c.length-1){const r=[...c],l=r[a],d=r[a+1],j=d.sort_order,v=l.sort_order;u.mutate({id:l.id,data:{...l,sort_order:j}}),u.mutate({id:d.id,data:{...d,sort_order:v}})}};return D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження постів Instagram..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(g,{placeholder:"Пошук постів Instagram...",value:w,onChange:s=>k(s.target.value),className:"pl-9"})]}),e.jsxs(o,{onClick:P,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Додати пост Instagram"]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:f.length>0?f.map((s,a)=>e.jsx(_,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative aspect-square w-full rounded-lg overflow-hidden bg-muted",children:s.image_url?e.jsx("img",{src:s.image_url,alt:"Instagram post",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:"Немає зображення"})}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:s.likes_count}),e.jsx("span",{className:"text-muted-foreground",children:"лайків"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:s.comments_count}),e.jsx("span",{className:"text-muted-foreground",children:"коментарів"})]})]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("a",{href:s.instagram_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline text-sm",children:[e.jsx(Z,{className:"h-4 w-4"}),"Відкрити в Instagram"]})}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"icon",onClick:()=>U(s),disabled:a===0,children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"icon",onClick:()=>z(s),disabled:a===f.length-1,children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"icon",onClick:()=>O(s),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(o,{variant:"destructive",size:"icon",onClick:()=>F(s),disabled:y.isPending,children:e.jsx(se,{className:"h-4 w-4"})})]})]})]})})},s.id)):e.jsx(_,{className:"col-span-full",children:e.jsx(N,{className:"py-12 text-center text-muted-foreground",children:"Постів Instagram не знайдено"})})}),e.jsx(B,{open:S,onOpenChange:m,children:e.jsxs(R,{className:"sm:max-w-[600px]",children:[e.jsx(q,{children:e.jsx(Q,{children:(t==null?void 0:t.id)===0?"Додати новий пост Instagram":"Редагувати пост Instagram"})}),t&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"image_url",children:"Зображення"}),e.jsxs("div",{className:"flex items-center gap-4",children:[t.image_url&&e.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden flex-shrink-0 border border-border",children:e.jsx("img",{src:t.image_url,alt:"Post",className:"w-full h-full object-cover"})}),e.jsx(g,{type:"file",ref:p,onChange:L,className:"hidden",accept:"image/jpeg,image/png,image/gif,image/webp"}),e.jsxs(o,{type:"button",variant:"outline",onClick:()=>{var s;return(s=p.current)==null?void 0:s.click()},disabled:C,children:[C?e.jsx(G,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Завантажити з комп'ютера"]}),t.image_url&&e.jsx(o,{type:"button",variant:"destructive",size:"icon",onClick:()=>i({...t,image_url:""}),children:e.jsx(J,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"image_url_text",children:"Або вставте посилання на зображення"}),e.jsx(g,{id:"image_url_text",value:t.image_url,onChange:s=>i({...t,image_url:s.target.value}),placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Опис до зображення (відображається в галереї)"}),e.jsx(M,{id:"description",value:t.description||"",onChange:s=>i({...t,description:s.target.value}),placeholder:"Опис до зображення...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"likes_count",children:"Кількість лайків"}),e.jsx(g,{id:"likes_count",type:"number",min:"0",value:t.likes_count,onChange:s=>i({...t,likes_count:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"comments_count",children:"Кількість коментарів"}),e.jsx(g,{id:"comments_count",type:"number",min:"0",value:t.comments_count,onChange:s=>i({...t,comments_count:parseInt(s.target.value)||0})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"is_active",checked:t.is_active,onCheckedChange:s=>i({...t,is_active:s})}),e.jsx(h,{htmlFor:"is_active",children:"Активний"})]})]}),e.jsxs(A,{children:[e.jsx(o,{variant:"outline",onClick:()=>m(!1),children:"Скасувати"}),e.jsx(o,{onClick:E,disabled:b.isPending||u.isPending,children:"Зберегти"})]})]})})]})}export{ye as Instagram};
