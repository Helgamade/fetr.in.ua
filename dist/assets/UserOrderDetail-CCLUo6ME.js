import{r as b,j as e}from"./chunk-react-CHUe_c_M.js";import{B as S}from"./button-Dirq6-S7.js";import{B as E}from"./badge-CTncAuPo.js";import{I as M}from"./input-E_DkKYix.js";import{C as x,a as h,b as p,d as u}from"./card-DcmemaXX.js";import{h as U,d as K,f as z,o as A}from"./index-Dv87KhRC.js";import{u as J}from"./chunk-query-BDB5idE8.js";import{aI as Q,aK as R,b0 as W,aJ as Y,aF as G,ao as V,aO as X,aQ as Z,b1 as ee,b2 as se}from"./chunk-vendor-C_GYGcpd.js";import{d as te,b as ae}from"./chunk-router-BMV24Bow.js";import"./chunk-lottie-DoMt_38f.js";import"./chunk-radix-BYx9rzOz.js";const re={created:"Замовлення оформлено",accepted:"Прийнято",paid:"Оплачено",packed:"Спаковано",shipped:"Відправлено",arrived:"Прибуло",completed:"Залишити відгук",processing:"В обробці",assembled:"Зібрано",in_transit:"В дорозі"},de={created:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",accepted:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",packed:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",shipped:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200",arrived:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200",completed:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",assembled:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200",in_transit:"bg-violet-100 text-violet-800 dark:bg-violet-900 dark:text-violet-200"},le={nova_poshta:"Нова Пошта",ukrposhta:"Укрпошта",pickup:"Самовивіз"},I=r=>{const d=typeof r=="string"?new Date(r):r,l=String(d.getHours()).padStart(2,"0"),j=String(d.getMinutes()).padStart(2,"0"),g=String(d.getDate()).padStart(2,"0"),s=String(d.getMonth()+1).padStart(2,"0"),y=d.getFullYear();return`${l}:${j}, ${g}.${s}.${y}`},ne=r=>{const d=[],l=typeof r.createdAt=="string"?new Date(r.createdAt):r.createdAt;return d.push({date:l,text:"Статус изменен: Новый",completed:!0}),d};function be(){const{id:r}=te(),d=ae(),{user:l}=U(),{data:j=[]}=K(),{toast:g}=z(),[s,y]=b.useState(null),[F,O]=b.useState(!0),[T,N]=b.useState(!1),{data:w=[]}=J({queryKey:["order-history",r],queryFn:()=>A.getHistory(r),enabled:!!r});b.useEffect(()=>{r&&A.getOrder(r).then(t=>{if((l==null?void 0:l.role)!=="admin"&&t.user_id&&t.user_id!==(l==null?void 0:l.id)){d("/user/orders");return}y(t)}).catch(t=>{console.error("Error loading order:",t),d("/user/orders")}).finally(()=>O(!1))},[r,l,d]);const $=t=>{var n;return((n=j.find(a=>a.code===t))==null?void 0:n.name)||t},_=async()=>{if(s!=null&&s.deliveryTtn)try{await navigator.clipboard.writeText(s.deliveryTtn),N(!0),g({title:"Скопійовано",description:"ТТН скопійовано в буфер обміну"}),setTimeout(()=>N(!1),2e3)}catch{g({title:"Помилка",description:"Не вдалося скопіювати ТТН",variant:"destructive"})}};if(F)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження замовлення..."})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30",children:e.jsx("div",{className:"text-muted-foreground",children:"Замовлення не знайдено"})});const k=w.length>0?w.map(t=>({date:typeof t.date=="string"?new Date(t.date):t.date,text:t.text,completed:t.completed,user:t.user||null})):ne(s),C=s.orderNumber||s.id||r||"";return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsxs("title",{children:["Замовлення ",C," | FetrInUA"]}),e.jsx("meta",{property:"og:title",content:`Замовлення ${C} | FetrInUA`})]}),e.jsx("div",{className:"min-h-screen bg-muted/30",children:e.jsxs("div",{className:"container max-w-7xl mx-auto space-y-6 p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>d("/user/orders"),children:e.jsx(R,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("h1",{className:"text-2xl font-semibold",children:["Замовлення ",s.id]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx(E,{className:de[s.status],children:re[s.status]}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(W,{className:"h-4 w-4"}),I(s.createdAt)]})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(p,{children:["Товари в замовленні (",s.items.length,")"]})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-4",children:s.items.map((t,n)=>{const a=j.find(c=>c.code===t.productId),i=(a==null?void 0:a.basePrice)||0,f=a==null?void 0:a.salePrice,v=f&&f<i,P=f||i,D=v?Math.round((i-(f||0))/i*100):0,H=t.selectedOptions.reduce((c,o)=>{const m=a==null?void 0:a.options.find(B=>B.code===o);return c+((m==null?void 0:m.price)||0)},0),L=(P+H)*t.quantity,q=`${t.productId}_${n}_${JSON.stringify([...t.selectedOptions].sort())}`;return e.jsx("div",{className:"pb-4 border-b last:border-0 last:pb-0",children:e.jsxs("div",{className:"flex gap-3 sm:gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:a!=null&&a.images&&a.images.length>0?e.jsx("img",{src:a.images[0],alt:a.name,className:"w-16 h-16 sm:w-20 sm:h-20 object-cover rounded"}):e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-muted rounded flex items-center justify-center",children:e.jsx(Y,{className:"h-6 w-6 sm:h-8 sm:w-8 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[v&&e.jsxs("div",{className:"bg-yellow-500 text-white text-xs font-bold px-2 py-0.5 rounded-full flex-shrink-0",children:["-",D,"%"]}),e.jsx("div",{className:"font-medium text-base sm:text-lg flex-1 min-w-0",children:$(t.productId)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"text-sm sm:text-base text-muted-foreground",children:["Кількість: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[t.quantity," шт."]})]}),e.jsx("div",{className:"flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:[i," ₴"]}),e.jsxs("span",{className:"text-base sm:text-lg font-bold",children:[P," ₴"]})]}):e.jsxs("span",{className:"text-base sm:text-lg font-bold",children:[i," ₴"]})})]}),t.selectedOptions.length>0&&e.jsxs("div",{className:"mb-2 mt-2",children:[e.jsx("div",{className:"text-xs sm:text-sm font-semibold text-foreground mb-2",children:"Додаткові опції:"}),e.jsx("div",{className:"space-y-1.5",children:t.selectedOptions.map(c=>{const o=a==null?void 0:a.options.find(m=>m.code===c);return o?e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm bg-primary/10 border border-primary/20 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:o.name}),e.jsxs("span",{className:"font-bold text-primary",children:["+",o.price," ₴"]})]},c):null})})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium",children:"Сума за товар:"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-primary",children:[L.toFixed(0)," ₴"]})]})})]})]})},q)})})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Доставка"]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:le[s.delivery.method]}),s.delivery.city&&e.jsxs("div",{className:"text-sm",children:["м. ",s.delivery.city]}),s.delivery.warehouse&&e.jsx("div",{className:"text-sm",children:s.delivery.warehouse}),s.delivery.address&&e.jsx("div",{className:"text-sm",children:s.delivery.address}),s.delivery.postIndex&&e.jsxs("div",{className:"text-sm",children:["Індекс: ",s.delivery.postIndex]}),s.deliveryTtn&&(s.delivery.method==="nova_poshta"||s.delivery.method==="ukrposhta")&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"ТТН"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{value:s.deliveryTtn,readOnly:!0,className:"flex-1 font-mono"}),e.jsx(S,{onClick:_,variant:"outline",size:"icon",className:"flex-shrink-0",children:T?e.jsx(V,{className:"h-4 w-4 text-green-600"}):e.jsx(X,{className:"h-4 w-4"})})]})]})]})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Оплата"]})}),e.jsx(u,{children:e.jsxs("div",{className:"text-sm",children:[s.payment.method==="wayforpay"&&"Онлайн оплата (WayForPay)",s.payment.method==="nalojka"&&"Оплата при отриманні",s.payment.method==="fopiban"&&"Оплата на рахунок ФОП"]})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(p,{children:"Історія замовлення"})}),e.jsx(u,{children:e.jsx("div",{className:"relative",children:k.map((t,n)=>e.jsxs("div",{className:"relative pl-8 pb-6 last:pb-0",children:[n<k.length-1&&e.jsx("div",{className:"absolute left-3 top-6 bottom-0 w-0.5 bg-border"}),e.jsx("div",{className:"absolute left-0 top-1",children:t.completed?e.jsx(ee,{className:"h-6 w-6 text-primary fill-primary/20"}):e.jsx(se,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:[I(t.date),t.user&&e.jsxs("span",{className:"text-muted-foreground ml-2",children:[", ",t.user]})]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:t.text})]})]},n))})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(p,{children:"Підсумок"})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Товари (",s.items.length,")"]}),e.jsxs("span",{children:["₴",s.subtotal]})]}),s.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Знижка"}),e.jsxs("span",{children:["-₴",s.discount]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Доставка"}),e.jsx("span",{children:s.deliveryCost>0?`₴${s.deliveryCost}`:"Безкоштовно"})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2 mt-2",children:[e.jsx("span",{children:"Всього"}),e.jsxs("span",{children:["₴",s.total]})]})]})})]})})]}),e.jsx("div",{className:"border-t border-border my-8"}),e.jsxs("footer",{className:"text-center space-y-2 pb-8",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"© 2026 FetrInUA. Всі права захищені"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Зроблено з ❤️ в Україні"})]})]})})]})}export{be as default};
