import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as o}from"./chunk-charts-BaLkbnPn.js";import{y as L,d as M,H as _,b as y,X as H,g as j,r as S}from"./index-BjXaBgmo.js";import{H as Q,F as V,C as O,a as W,b as $,c as K}from"./StickyMobileCTA-BMd9h6E-.js";import{B as P}from"./button-D3cQCCEg.js";import{I as U}from"./input-C3NEDR3i.js";import{T as X}from"./textarea-Cn730VP7.js";import{S as C,a as k,b as F,c as R,d as i}from"./select-D303mAPg.js";import{P as G,a as J,b as g,c as Y,d as Z,e as ee,f as se}from"./pagination-Bhbly5oG.js";import{Q as te,M as ae,f as re,s as A,a as le,v as ie}from"./dateFormat-C20R5uBd.js";import{S as N}from"./star-Bb6VRZDH.js";import{S as ne}from"./messengerLinks-BhrEU1Fr.js";import"./useTranslation-DcbU_14Z.js";import"./useTexts-DXIl-694.js";import"./usePublicSettings-CUuUBk-v.js";import"./avatar-DHv6vdY2.js";import"./phone-N_YdqoKH.js";import"./user-CZXgQhXl.js";import"./package-ZQ84Hb20.js";import"./file-text-Dq17xsj0.js";import"./layout-dashboard-RC3jY4ms.js";import"./log-out-C11oWuBO.js";import"./usePages-BQ-zutn_.js";import"./truck-ltxAGg2A.js";import"./credit-card-DZGhVfYh.js";import"./instagram-BsfeMgUd.js";import"./mail-CQUJ_1FW.js";import"./trash-2-3MVibN0X.js";import"./minus-C9-FA0ZT.js";import"./eye-zspDbk_9.js";import"./users-ClOIby1u.js";import"./index-D4-djExh.js";import"./Combination-zJfmSFo9.js";import"./index-ZeZSZmiz.js";import"./chevron-down-DH6QkIwA.js";import"./chevron-up-DHOwsJkj.js";import"./check-DhU38tEw.js";import"./chevron-left-D8tlV_Pz.js";import"./chevron-right-CPShFtJY.js";function Ke(){const[v,b]=L(),[x,D]=o.useState("all"),[u,E]=o.useState("newest"),[a,f]=o.useState(1),[I,h]=o.useState(!1),[r,p]=o.useState({name:"",text:"",rating:5}),{data:n,isLoading:T,refetch:z}=M({queryKey:["reviews-all",x,u,a],queryFn:()=>S.getAllWithFilters({rating:x!=="all"?parseInt(x):void 0,sort:u,page:a,limit:20})}),w=(n==null?void 0:n.reviews)||[],c=(n==null?void 0:n.stats)||{total:0,averageRating:0,byRating:{5:0,4:0,3:0,2:0,1:0}},m=(n==null?void 0:n.pagination)||{page:1,limit:20,total:0,totalPages:1};o.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[a]),o.useEffect(()=>{f(1)},[x,u]),o.useEffect(()=>{if(v.has("add")){h(!0);const s=new URLSearchParams(v);s.delete("add"),b(s,{replace:!0})}},[v,b]);const q=async s=>{s.preventDefault();const t=A(r.name.trim()),l=le(r.text.trim(),2e3),d=ie(r.rating);if(!t||t.length<2){j.error("Помилка",{description:"Ім'я має містити мінімум 2 символи (тільки літери)"});return}if(!l||l.length<10){j.error("Помилка",{description:"Текст відгуку має містити мінімум 10 символів"});return}try{await S.create({name:t,text:l,rating:d,is_approved:!1}),j.success("Дякуємо за відгук!",{description:"Ваш відгук буде опублікований після модерації"}),h(!1),p({name:"",text:"",rating:5}),z()}catch(B){j.error("Помилка",{description:B.message||"Не вдалося відправити відгук. Спробуйте пізніше."})}};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx("title",{children:"Відгуки - Fetr.in.ua"}),e.jsx("meta",{name:"description",content:"Відгуки наших клієнтів про товари з фетру"})]}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Q,{}),e.jsx("main",{children:e.jsx("section",{className:"py-20 bg-peach/30",children:e.jsxs("div",{className:"container-tight",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-accent/20 text-accent-foreground mb-4",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Відгуки клієнтів"})]}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-heading font-bold text-foreground mb-4",children:"Відгуки"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto mb-8",children:"Що кажуть наші клієнти про наші товари"})]}),c.total>0&&e.jsxs("div",{className:"glass-card p-6 mb-12",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-2xl font-heading font-bold text-foreground mb-2",children:["Оцінка користувачів ",c.averageRating.toFixed(2),"/5"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(N,{className:"w-5 h-5 text-accent fill-accent"}),e.jsxs("span",{className:"text-muted-foreground",children:["на основі ",c.total," ",c.total===1?"відгук":c.total<5?"відгуки":"відгуків"]})]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:[5,4,3,2,1].map(s=>{const t=c.byRating[s]||0,l=c.total>0?t/c.total*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-12 text-sm font-medium",children:[s," зірок"]}),e.jsx("div",{className:"flex-1 h-6 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-300",style:{width:`${l}%`}})}),e.jsx("div",{className:"w-8 text-sm text-muted-foreground text-right",children:t})]},s)})}),e.jsx("div",{className:"text-center",children:e.jsxs(P,{variant:"hero",onClick:()=>h(!0),children:[e.jsx(ae,{className:"w-5 h-5 mr-2"}),"Написати відгук"]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-8",children:[e.jsxs(C,{value:x,onValueChange:D,children:[e.jsx(k,{className:"w-full sm:w-[200px]",children:e.jsx(F,{placeholder:"Фільтр по рейтингу"})}),e.jsxs(R,{children:[e.jsx(i,{value:"all",children:"Всі оцінки"}),e.jsx(i,{value:"5",children:"5 зірок"}),e.jsx(i,{value:"4",children:"4 зірки"}),e.jsx(i,{value:"3",children:"3 зірки"}),e.jsx(i,{value:"2",children:"2 зірки"}),e.jsx(i,{value:"1",children:"1 зірка"})]})]}),e.jsxs(C,{value:u,onValueChange:E,children:[e.jsx(k,{className:"w-full sm:w-[200px]",children:e.jsx(F,{placeholder:"Сортування"})}),e.jsxs(R,{children:[e.jsx(i,{value:"newest",children:"Спочатку нові"}),e.jsx(i,{value:"oldest",children:"Спочатку старі"}),e.jsx(i,{value:"rating_high",children:"За рейтингом (високий)"}),e.jsx(i,{value:"rating_low",children:"За рейтингом (низький)"})]})]})]}),T?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Завантаження..."}):w.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Відгуків не знайдено"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:w.map((s,t)=>e.jsx("div",{className:"glass-card p-6 hover-lift animate-fade-in",style:{animationDelay:`${t*.1}s`},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-bold text-primary",children:s.name[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-heading font-bold",children:s.name}),s.rating&&s.rating>0&&e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((l,d)=>e.jsx(N,{className:y("w-4 h-4",d<s.rating?"text-accent fill-accent":"text-muted")},d))})]}),e.jsx("p",{className:"text-muted-foreground",children:s.text}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground/60",children:re(s.createdAt)}),e.jsx("span",{className:"text-xs py-0.5 px-2 rounded-full bg-success/10",style:{color:"#609f7a"},children:"✓ Підтверджено"})]})]})]})},s.id))}),m.totalPages>1&&e.jsx("div",{className:"w-full px-4 overflow-x-auto",children:e.jsx(G,{className:"w-full",children:e.jsxs(J,{className:"w-full",children:[e.jsx(g,{children:e.jsx(Y,{onClick:s=>{s.preventDefault(),a>1&&f(a-1)},className:a<=1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:m.totalPages},(s,t)=>t+1).map(s=>{if(!(s===1||s===m.totalPages||s>=a-1&&s<=a+1)){const l=s===a-2&&a>3,d=s===a+2&&a<m.totalPages-2;return l||d?e.jsx(g,{children:e.jsx(Z,{})},s):null}return e.jsx(g,{children:e.jsx(ee,{onClick:l=>{l.preventDefault(),f(s)},isActive:s===a,className:"cursor-pointer",children:s})},s)}),e.jsx(g,{children:e.jsx(se,{onClick:s=>{s.preventDefault(),a<m.totalPages&&f(a+1)},className:a>=m.totalPages?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]})})}),e.jsx(V,{}),e.jsx(O,{}),e.jsx(W,{}),e.jsx($,{}),e.jsx(K,{})]}),I&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-foreground/60 backdrop-blur-sm",onClick:()=>h(!1)}),e.jsxs("div",{className:"relative w-full max-w-md bg-card rounded-2xl p-6 animate-scale-in",children:[e.jsx("button",{onClick:()=>h(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-muted flex items-center justify-center hover:bg-muted/80 transition-colors",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx("h3",{className:"text-xl font-heading font-bold mb-4",children:"Залишити відгук"}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ваше ім'я"}),e.jsx(U,{value:r.name,onChange:s=>{const t=A(s.target.value);p({...r,name:t})},required:!0,maxLength:100}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Мінімум 2 символи, тільки літери, пробіли, дефіси та апострофи"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Оцінка"}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>p({...r,rating:s}),className:"p-1",children:e.jsx(N,{className:y("w-8 h-8 transition-colors",s<=r.rating?"text-accent fill-accent":"text-muted hover:text-accent/50")})},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ваш відгук"}),e.jsx(X,{value:r.text,onChange:s=>{let t=s.target.value;t.length>2e3&&(t=t.substring(0,2e3)),p({...r,text:t})},placeholder:"Розкажіть про ваш досвід...",rows:4,required:!0,maxLength:2e3}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Мінімум 10 символів, максимум 2000 символів (",r.text.length,"/2000)"]})]}),e.jsxs(P,{type:"submit",variant:"hero",className:"w-full",children:[e.jsx(ne,{className:"w-4 h-4"}),"Надіслати відгук"]})]})]})]})]})}export{Ke as default};
