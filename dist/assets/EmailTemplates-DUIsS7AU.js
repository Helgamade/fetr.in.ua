import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as o}from"./chunk-charts-BaLkbnPn.js";import{B as h}from"./button-EEmuFWA-.js";import{I as g}from"./input-BuHwatQT.js";import{C as _,a as N,b as w,c as E,d as T}from"./card-CIwTft0q.js";import{L as c}from"./label-CXOHvVzs.js";import{T as C}from"./textarea-C56I3K6q.js";import{S as Q}from"./switch-BgXjj55R.js";import{c as z,z as A,e as B,d as D,f as k,as as p}from"./index-gEcsbEFT.js";import{E as K}from"./eye-off-ARkndbXj.js";import{E as V}from"./eye-fCz_RZrs.js";import{S as W}from"./save-D8Zy3Obt.js";import"./index-ZeZSZmiz.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],R=z("test-tube",O),x=[{value:"order_created_admin",label:"Нове замовлення (адмін)",description:"Відправляється адміністратору при створенні нового замовлення"},{value:"order_created_customer",label:"Замовлення прийнято (клієнт)",description:"Відправляється клієнту при створенні замовлення"},{value:"order_paid_admin",label:"Замовлення оплачено (адмін)",description:"Відправляється адміністратору при оплаті замовлення"},{value:"order_paid_customer",label:"Оплата підтверджена (клієнт)",description:"Відправляється клієнту при підтвердженні оплати"},{value:"order_status_changed",label:"Статус замовлення змінено",description:"Відправляється клієнту при зміні статусу замовлення"},{value:"review_created_admin",label:"Новий відгук (адмін)",description:"Відправляється адміністратору при створенні нового відгуку"},{value:"review_approved",label:"Відгук опубліковано",description:"Відправляється клієнту при публікації відгуку"}];function le(){var y,f;const{toast:i}=A(),L=B(),[r,S]=o.useState(x[0].value),[l,d]=o.useState({}),[n,M]=o.useState(""),[m,F]=o.useState(!1),{data:u=[],isLoading:P}=D({queryKey:["email-templates"],queryFn:()=>p.getAll()}),v=k({mutationFn:({eventType:s,data:t})=>p.update(s,{subject:t.subject||"",body_html:t.body_html||"",body_text:t.body_text||null,is_active:t.is_active!==void 0?t.is_active:!0,description:t.description||null}),onSuccess:()=>{L.invalidateQueries({queryKey:["email-templates"]}),i({title:"Шаблон збережено",description:"Шаблон email успішно оновлено"})},onError:s=>{i({title:"Помилка",description:s.message||"Не вдалося зберегти шаблон",variant:"destructive"})}}),j=k({mutationFn:({eventType:s,testEmail:t,testData:q})=>p.test(s,t,q),onSuccess:()=>{i({title:"Тестовий email відправлено",description:"Перевірте вашу пошту"})},onError:s=>{i({title:"Помилка",description:s.message||"Не вдалося відправити тестовий email",variant:"destructive"})}});o.useEffect(()=>{if(u.length>0){const s={};u.forEach(t=>{s[t.event_type]={subject:t.subject,body_html:t.body_html,body_text:t.body_text,is_active:t.is_active,description:t.description}}),d(s)}},[u]);const b=u.find(s=>s.event_type===r),a=l[r]||{},H=()=>{if(!b)return;const s=a;if(!s.subject||!s.body_html){i({title:"Помилка",description:"Тема та HTML тіло обов'язкові",variant:"destructive"});return}v.mutate({eventType:r,data:s})},I=()=>{if(!n.trim()){i({title:"Помилка",description:"Введіть email для тесту",variant:"destructive"});return}const s={orderNumber:"305328",customerName:"Іван Петренко",customerPhone:"+380501234567",customerEmail:n,total:"1500.00",status:"Замовлення оформлено",deliveryMethod:"Нова Пошта",deliveryCity:"Київ",deliveryWarehouse:"Відділення №1",paymentMethod:"Онлайн оплата",orderLink:"https://fetr.in.ua/admin/orders/305328",trackingLink:"https://fetr.in.ua/order/1234567890",reviewerName:"Олена Коваленко",rating:"5",reviewText:"Чудовий товар, рекомендую!",reviewLink:"https://fetr.in.ua/reviews"};j.mutate({eventType:r,testEmail:n,testData:s})};return P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження шаблонів..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Шаблони Email сповіщень"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Налаштуйте шаблони для автоматичних email сповіщень"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(_,{children:[e.jsxs(N,{children:[e.jsx(w,{children:"Типи подій"}),e.jsx(E,{children:"Виберіть тип події для редагування"})]}),e.jsx(T,{className:"space-y-2",children:x.map(s=>e.jsxs("button",{onClick:()=>S(s.value),className:`w-full text-left p-3 rounded-lg border transition-colors ${r===s.value?"border-primary bg-primary/10":"border-border hover:bg-muted"}`,children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.description})]},s.value))})]}),e.jsx("div",{className:"lg:col-span-2 space-y-4",children:b&&e.jsxs(_,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(w,{children:(y=x.find(s=>s.value===r))==null?void 0:y.label}),e.jsx(E,{children:(f=x.find(s=>s.value===r))==null?void 0:f.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{checked:a.is_active!==!1,onCheckedChange:s=>d({...l,[r]:{...a,is_active:s}})}),e.jsx(c,{children:"Активний"})]})]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"subject",children:"Тема листа"}),e.jsx(g,{id:"subject",value:a.subject||"",onChange:s=>d({...l,[r]:{...a,subject:s.target.value}}),placeholder:"Тема email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{htmlFor:"body_html",children:"HTML тіло листа"}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>F(!m),children:[m?e.jsx(K,{className:"h-4 w-4"}):e.jsx(V,{className:"h-4 w-4"}),m?"Приховати":"Показати"," превью"]})]}),m?e.jsx("div",{className:"border rounded-lg p-4 bg-muted",dangerouslySetInnerHTML:{__html:a.body_html||""}}):e.jsx(C,{id:"body_html",value:a.body_html||"",onChange:s=>d({...l,[r]:{...a,body_html:s.target.value}}),placeholder:"HTML тіло листа",rows:12,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"body_text",children:"Текстова версія (опціонально)"}),e.jsx(C,{id:"body_text",value:a.body_text||"",onChange:s=>d({...l,[r]:{...a,body_text:s.target.value}}),placeholder:"Текстова версія листа",rows:6,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Доступні змінні для шаблонів:"}),e.jsx("div",{className:"text-xs text-muted-foreground bg-muted p-3 rounded-lg font-mono",children:r.includes("order")?e.jsxs(e.Fragment,{children:["{{orderNumber}}"," - номер замовлення",e.jsx("br",{}),"{{customerName}}"," - ім'я клієнта",e.jsx("br",{}),"{{customerPhone}}"," - телефон клієнта",e.jsx("br",{}),"{{customerEmail}}"," - email клієнта",e.jsx("br",{}),"{{total}}"," - сума замовлення",e.jsx("br",{}),"{{status}}"," - статус замовлення",e.jsx("br",{}),"{{deliveryMethod}}"," - спосіб доставки",e.jsx("br",{}),"{{deliveryCity}}"," - місто доставки",e.jsx("br",{}),"{{deliveryWarehouse}}"," - відділення",e.jsx("br",{}),"{{paymentMethod}}"," - спосіб оплати",e.jsx("br",{}),"{{orderLink}}"," - посилання на замовлення",e.jsx("br",{}),"{{trackingLink}}"," - посилання для відстеження",e.jsx("br",{}),"{{#if customerEmail}}...{{/if}}"," - умовний блок"]}):e.jsxs(e.Fragment,{children:["{{reviewerName}}"," - ім'я автора відгуку",e.jsx("br",{}),"{{rating}}"," - рейтинг",e.jsx("br",{}),"{{reviewText}}"," - текст відгуку",e.jsx("br",{}),"{{reviewLink}}"," - посилання на відгук"]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{onClick:H,disabled:v.isPending,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Зберегти шаблон"]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(g,{type:"email",placeholder:"Email для тесту",value:n,onChange:s=>M(s.target.value),className:"max-w-xs"}),e.jsxs(h,{variant:"outline",onClick:I,disabled:j.isPending||!n.trim(),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Відправити тест"]})]})]})]})]})})]})]})}export{le as EmailTemplates};
