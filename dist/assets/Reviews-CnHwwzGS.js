import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as d}from"./chunk-charts-BaLkbnPn.js";import{P as he,a as ue,b as q,c as xe,d as pe,e as ge,f as je}from"./pagination-Old6NldZ.js";import{B as j}from"./button-WoImrPHC.js";import{I as B}from"./input-BlCC0BnH.js";import{C as A,d as F}from"./card-C5bj8P7E.js";import{B as ee}from"./badge-DFmqiw83.js";import{S as I,a as M,b as E,c as $,d as x}from"./select-CrERlPs1.js";import{D as fe,a as ve,b as Ne,c as Se,d as ye}from"./dialog-DSQupkP_.js";import{L as v}from"./label-BPI6rffZ.js";import{T as Ce}from"./textarea-M2-0D7MP.js";import{S as te}from"./switch-C_WgwLJk.js";import{z as we,e as De,d as be,f as U,b as se,r as G}from"./index-BFwkAQ6-.js";import{S as ke}from"./search-vA16La6e.js";import{P as Pe,T as _e}from"./trash-2-CkU4Rfb4.js";import{C as ae}from"./check-eef6YP1K.js";import{E as ne}from"./eye-off-CxrTYBuO.js";import{S as le}from"./star-C8eKrc8R.js";import{S as Ae}from"./square-pen-D-oLRBbU.js";import"./chevron-left-CBhJ6Yh4.js";import"./chevron-right-c8aYCoWs.js";import"./index-D4-djExh.js";import"./Combination-DN6d7d6I.js";import"./index-ZeZSZmiz.js";import"./chevron-down-w3iiB741.js";import"./chevron-up-D-N2e3lZ.js";import"./index-x3De1gta.js";const Fe=[{value:0,label:"Січень"},{value:1,label:"Лютий"},{value:2,label:"Березень"},{value:3,label:"Квітень"},{value:4,label:"Травень"},{value:5,label:"Червень"},{value:6,label:"Липень"},{value:7,label:"Серпень"},{value:8,label:"Вересень"},{value:9,label:"Жовтень"},{value:10,label:"Листопад"},{value:11,label:"Грудень"}];function J(o,l){return new Date(o,l+1,0).getDate()}function Ie(){const o=[];for(let l=2027;l>=2013;l--)o.push(l);return o}function Me({label:o,value:l,onChange:N,id:b}){const h=l||new Date,[y,s]=d.useState(h.getDate()),[r,T]=d.useState(h.getMonth()),[m,c]=d.useState(h.getFullYear()),[u,f]=d.useState(()=>{const a=String(h.getHours()).padStart(2,"0"),n=String(h.getMinutes()).padStart(2,"0");return`${a}:${n}`}),L=d.useMemo(()=>J(m,r),[m,r]),C=d.useMemo(()=>Ie(),[]);d.useEffect(()=>{if(l){const a=l.getDate(),n=l.getMonth(),k=l.getFullYear(),P=String(l.getHours()).padStart(2,"0"),_=String(l.getMinutes()).padStart(2,"0");s(a),T(n),c(k),f(`${P}:${_}`)}},[l]);const w=d.useCallback((a,n,k,P)=>{const[_,p]=P.split(":"),Y=new Date(k,n,a,parseInt(_)||0,parseInt(p)||0,0,0);N(Y)},[N]),S=a=>{const n=Math.min(a,L);s(n),w(n,r,m,u)},Q=a=>{T(a);const n=Math.min(y,J(m,a));s(n),w(n,a,m,u)},R=a=>{c(a);const n=Math.min(y,J(a,r));s(n),w(n,r,a,u)},z=a=>{const n=a.target.value;f(n),w(y,r,m,n)};return l&&l.toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 flex-1",children:[o&&e.jsx(v,{htmlFor:b||"date-picker",className:"px-1",children:o}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{value:y.toString(),onValueChange:a=>S(parseInt(a)),children:[e.jsx(M,{className:"w-[80px]",children:e.jsx(E,{placeholder:"День"})}),e.jsx($,{children:Array.from({length:L},(a,n)=>n+1).map(a=>e.jsx(x,{value:a.toString(),children:String(a).padStart(2,"0")},a))})]}),e.jsxs(I,{value:r.toString(),onValueChange:a=>Q(parseInt(a)),children:[e.jsx(M,{className:"flex-1",children:e.jsx(E,{placeholder:"Місяць"})}),e.jsx($,{children:Fe.map(a=>e.jsx(x,{value:a.value.toString(),children:a.label},a.value))})]}),e.jsxs(I,{value:m.toString(),onValueChange:a=>R(parseInt(a)),children:[e.jsx(M,{className:"w-[100px]",children:e.jsx(E,{placeholder:"Рік"})}),e.jsx($,{className:"max-h-[200px]",children:C.map(a=>e.jsx(x,{value:a.toString(),children:a},a))})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 w-32",children:[e.jsx(v,{htmlFor:`${b||"time"}-picker`,className:"px-1",children:"Час"}),e.jsx(B,{type:"time",id:`${b||"time"}-picker`,value:u,onChange:z,className:"bg-background"})]})]})}function it(){const{toast:o}=we(),l=De(),[N,b]=d.useState(""),[h,y]=d.useState("all"),[s,r]=d.useState(null),[T,m]=d.useState(!1),[c,u]=d.useState(1),[f,L]=d.useState(20),{data:C=[],isLoading:w}=be({queryKey:["reviews","all"],queryFn:async()=>{const t=await fetch("/api/reviews/all");if(!t.ok)throw new Error("Failed to fetch reviews");return(await t.json()).map(i=>({...i,is_approved:!!i.is_approved,featured:!!i.featured,createdAt:new Date(i.created_at||i.createdAt),updatedAt:new Date(i.updated_at||i.updatedAt)}))}}),S=U({mutationFn:({id:t,data:g})=>G.update(t,g),onSuccess:()=>{l.invalidateQueries({queryKey:["reviews"]}),o({title:"Оновлено",description:"Відгук успішно оновлено"}),m(!1),r(null)},onError:t=>{o({title:"Помилка",description:t.message||"Не вдалося оновити відгук",variant:"destructive"})}}),Q=U({mutationFn:t=>G.create(t),onSuccess:()=>{l.invalidateQueries({queryKey:["reviews"]}),o({title:"Створено",description:"Відгук успішно створено"}),m(!1),r(null)},onError:t=>{o({title:"Помилка",description:t.message||"Не вдалося створити відгук",variant:"destructive"})}}),R=U({mutationFn:t=>G.delete(t),onSuccess:()=>{l.invalidateQueries({queryKey:["reviews"]}),o({title:"Видалено",description:"Відгук успішно видалено",variant:"destructive"})},onError:t=>{o({title:"Помилка",description:t.message||"Не вдалося видалити відгук",variant:"destructive"})}}),z=()=>{r({id:0,name:"",text:"",rating:5,photo:null,is_approved:!0,featured:!1,createdAt:new Date,updatedAt:new Date}),m(!0)},a=t=>{r({...t}),m(!0)},n=()=>{if(!s)return;if(!s.name||!s.text){o({title:"Помилка",description:"Заповніть всі обов'язкові поля",variant:"destructive"});return}const t=s.createdAt instanceof Date?s.createdAt:new Date(s.createdAt),g=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),O=String(t.getDate()).padStart(2,"0"),ce=String(t.getHours()).padStart(2,"0"),oe=String(t.getMinutes()).padStart(2,"0"),de=String(t.getSeconds()).padStart(2,"0"),me=`${g}-${i}-${O} ${ce}:${oe}:${de}`,Z={name:s.name,text:s.text,rating:s.rating,photo:s.photo,is_approved:s.is_approved,featured:s.featured,created_at:me};s.id===0?Q.mutate(Z):S.mutate({id:s.id,data:Z})},k=t=>{S.mutate({id:t.id,data:{...t,is_approved:!0}})},P=t=>{S.mutate({id:t.id,data:{...t,is_approved:!1}})},_=t=>{confirm(`Ви впевнені, що хочете видалити відгук від "${t.name}"?`)&&R.mutate(t.id)},p=C.filter(t=>{const g=t.name.toLowerCase().includes(N.toLowerCase())||t.text.toLowerCase().includes(N.toLowerCase()),i=h==="all"||h==="approved"&&t.is_approved||h==="pending"&&!t.is_approved;return g&&i}),Y=C.length,re=C.filter(t=>t.is_approved).length,ie=C.filter(t=>!t.is_approved).length,D=Math.ceil(p.length/f),V=(c-1)*f,H=V+f,W=p.slice(V,H);d.useEffect(()=>{u(1)},[h,N]);const K=t=>{y(t),u(1)},X=t=>{L(parseInt(t)),u(1)};return w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження відгуків..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Пошук відгуків...",value:N,onChange:t=>b(t.target.value),className:"pl-9"})]}),e.jsxs(j,{onClick:z,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Додати відгук"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:h==="all"?"default":"outline",onClick:()=>K("all"),children:["Всі (",Y,")"]}),e.jsxs(j,{variant:h==="approved"?"default":"outline",onClick:()=>K("approved"),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Опубліковані (",re,")"]}),e.jsxs(j,{variant:h==="pending"?"default":"outline",onClick:()=>K("pending"),children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"На модерації (",ie,")"]})]})]})})}),p.length>0&&e.jsx(A,{children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Показувати на сторінці:"}),e.jsxs(I,{value:f.toString(),onValueChange:X,children:[e.jsx(M,{className:"w-[100px]",children:e.jsx(E,{})}),e.jsxs($,{children:[e.jsx(x,{value:"10",children:"10"}),e.jsx(x,{value:"20",children:"20"}),e.jsx(x,{value:"50",children:"50"}),e.jsx(x,{value:"100",children:"100"})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Показано ",V+1,"-",Math.min(H,p.length)," з ",p.length]})]})})}),e.jsx("div",{className:"space-y-4",children:W.length>0?W.map(t=>e.jsx(A,{children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-bold text-primary",children:t.name[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:t.name}),!t.is_approved&&e.jsx(ee,{variant:"secondary",children:"На модерації"}),!!t.featured&&e.jsx(ee,{variant:"default",children:"На головній"})]}),t.rating&&t.rating>0&&e.jsx("div",{className:"flex items-center gap-1 mt-1",children:[...Array(5)].map((g,i)=>e.jsx(le,{className:se("w-4 h-4",i<t.rating?"text-yellow-400 fill-yellow-400":"text-muted-foreground")},i))})]})]}),e.jsx("p",{className:"text-muted-foreground mt-3 mb-2 whitespace-pre-wrap",children:t.text}),e.jsx("p",{className:"text-sm text-muted-foreground/60",children:new Date(t.createdAt).toLocaleDateString("uk-UA",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>a(t),children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Редагувати"]}),!t.is_approved&&e.jsxs(j,{variant:"default",size:"sm",onClick:()=>k(t),disabled:S.isPending,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Опублікувати"]}),!!t.is_approved&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>P(t),disabled:S.isPending,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Зняти з публікації"]}),e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>_(t),disabled:R.isPending,children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Видалити"]})]})]})})},t.id)):e.jsx(A,{children:e.jsx(F,{className:"py-12 text-center text-muted-foreground",children:"Відгуків не знайдено"})})}),p.length>0&&D>1&&e.jsx(A,{children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Показувати на сторінці:"}),e.jsxs(I,{value:f.toString(),onValueChange:X,children:[e.jsx(M,{className:"w-[100px]",children:e.jsx(E,{})}),e.jsxs($,{children:[e.jsx(x,{value:"10",children:"10"}),e.jsx(x,{value:"20",children:"20"}),e.jsx(x,{value:"50",children:"50"}),e.jsx(x,{value:"100",children:"100"})]})]})]}),e.jsx(he,{children:e.jsxs(ue,{children:[e.jsx(q,{children:e.jsx(xe,{onClick:t=>{t.preventDefault(),c>1&&u(c-1)},className:c<=1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:D},(t,g)=>g+1).map(t=>{if(!(t===1||t===D||t>=c-1&&t<=c+1)){const i=t===c-2&&c>3,O=t===c+2&&c<D-2;return i||O?e.jsx(q,{children:e.jsx(pe,{})},t):null}return e.jsx(q,{children:e.jsx(ge,{onClick:i=>{i.preventDefault(),u(t)},isActive:t===c,className:"cursor-pointer",children:t})},t)}),e.jsx(q,{children:e.jsx(je,{onClick:t=>{t.preventDefault(),c<D&&u(c+1)},className:c>=D?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Показано ",V+1,"-",Math.min(H,p.length)," з ",p.length]})]})})}),e.jsx(fe,{open:T,onOpenChange:m,children:e.jsxs(ve,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ne,{children:e.jsx(Se,{children:(s==null?void 0:s.id)===0?"Додати новий відгук":"Редагувати відгук"})}),s&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",children:"Ім'я *"}),e.jsx(B,{id:"name",value:s.name,onChange:t=>r({...s,name:t.target.value}),placeholder:"Олена"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Оцінка"}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>r({...s,rating:t}),className:"p-1",children:e.jsx(le,{className:se("w-8 h-8 transition-colors",t<=(s.rating||0)?"text-yellow-400 fill-yellow-400":"text-muted-foreground hover:text-yellow-400/50")})},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"text",children:"Текст відгуку *"}),e.jsx(Ce,{id:"text",value:s.text,onChange:t=>r({...s,text:t.target.value}),placeholder:"Розкажіть про ваш досвід...",rows:4})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(Me,{label:"Дата створення",value:s.createdAt instanceof Date?s.createdAt:new Date(s.createdAt),onChange:t=>{r({...s,createdAt:t||new Date})},id:"created_at"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"photo",children:"Фото (URL)"}),e.jsx(B,{id:"photo",value:s.photo||"",onChange:t=>r({...s,photo:t.target.value||null}),placeholder:"https://example.com/photo.jpg"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:"is_approved",checked:s.is_approved,onCheckedChange:t=>r({...s,is_approved:t})}),e.jsx(v,{htmlFor:"is_approved",children:"Опубліковано"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:"featured",checked:s.featured,onCheckedChange:t=>r({...s,featured:t})}),e.jsx(v,{htmlFor:"featured",children:"Показувати на головній (максимум 4)"})]})]}),e.jsxs(ye,{children:[e.jsx(j,{variant:"outline",onClick:()=>m(!1),children:"Скасувати"}),e.jsx(j,{onClick:n,children:"Зберегти"})]})]})})]})}export{it as Reviews};
