import{r as o,j as e}from"./chunk-react-CHUe_c_M.js";import{B as n}from"./button-Dirq6-S7.js";import{I as v}from"./input-E_DkKYix.js";import{C as f,d as N,a as D,b as E}from"./card-DcmemaXX.js";import{D as F,a as O,b as z,c as P,d as T}from"./dialog-CQ-l8du7.js";import{L as h}from"./label-CUlRyR4d.js";import{T as le}from"./textarea-BBXtoPox.js";import{S as U}from"./switch-C5BnPKBx.js";import{f as ne}from"./index-Dv87KhRC.js";import{u as ce,a as de,b as oe,c as me,d as he,e as ue,f as xe,g as pe}from"./useGalleries-BdQOzmDH.js";import{bm as ge,a_ as je,aM as ve,ax as fe,bo as L,aY as R,bp as Ne,br as _e}from"./chunk-vendor-C_GYGcpd.js";import"./chunk-lottie-DoMt_38f.js";import"./chunk-radix-BYx9rzOz.js";import"./chunk-query-BDB5idE8.js";import"./chunk-router-BMV24Bow.js";function Ue(){const{data:c=[],isLoading:$}=ce(!1),q=de(),C=oe(),B=me(),H=he(),M=ue(),Q=xe(),[w,Y]=o.useState(""),[a,m]=o.useState(null),[l,y]=o.useState(null),[i,u]=o.useState(null),[A,x]=o.useState(!1),[J,_]=o.useState(!1),[S,I]=o.useState(null),b=o.useRef({}),{toast:r}=ne(),{data:d}=pe(l||0,!1),G=c.filter(s=>s.name.toLowerCase().includes(w.toLowerCase())),K=()=>{m({id:0,name:"",sort_order:c.length,is_published:!0,created_at:"",updated_at:""}),x(!0)},V=s=>{m({...s}),x(!0)},W=()=>{if(!a)return;if(!a.name){r({title:"Помилка",description:"Введіть назву галереї",variant:"destructive"});return}const s={name:a.name,sort_order:a.sort_order||0,is_published:a.is_published};a.id===0?q.mutate(s,{onSuccess:()=>{r({title:"Створено",description:"Галерею успішно створено"}),x(!1),m(null)},onError:t=>{r({title:"Помилка",description:t.message||"Не вдалося створити галерею",variant:"destructive"})}}):C.mutate({id:a.id,data:s},{onSuccess:()=>{r({title:"Збережено",description:"Галерею успішно оновлено"}),x(!1),m(null)},onError:t=>{r({title:"Помилка",description:t.message||"Не вдалося оновити галерею",variant:"destructive"})}})},X=s=>{confirm(`Ви впевнені, що хочете видалити галерею "${s.name}"? Всі фотографії також будуть видалені.`)&&B.mutate(s.id,{onSuccess:()=>{r({title:"Видалено",description:`Галерею "${s.name}" видалено`,variant:"destructive"}),l===s.id&&y(null)},onError:t=>{r({title:"Помилка",description:t.message||"Не вдалося видалити галерею",variant:"destructive"})}})},Z=(s,t)=>{var g;const p=(g=t.target.files)==null?void 0:g[0];p&&(I(s),H.mutate({galleryId:s,file:p},{onSuccess:()=>{r({title:"Завантажено",description:"Фотографію успішно завантажено"}),I(null),b.current[s]&&(b.current[s].value="")},onError:j=>{r({title:"Помилка",description:j.message||"Не вдалося завантажити фотографію",variant:"destructive"}),I(null)}}))},ee=s=>{u({...s}),_(!0)},se=()=>{!i||!l||M.mutate({galleryId:l,imageId:i.id,data:{title:i.title||void 0,description:i.description||void 0,sort_order:i.sort_order,is_published:i.is_published}},{onSuccess:()=>{r({title:"Збережено",description:"Фотографію успішно оновлено"}),_(!1),u(null)},onError:s=>{r({title:"Помилка",description:s.message||"Не вдалося оновити фотографію",variant:"destructive"})}})},te=s=>{l&&confirm("Ви впевнені, що хочете видалити цю фотографію?")&&Q.mutate({galleryId:l,imageId:s.id},{onSuccess:()=>{r({title:"Видалено",description:"Фотографію успішно видалено",variant:"destructive"})},onError:t=>{r({title:"Помилка",description:t.message||"Не вдалося видалити фотографію",variant:"destructive"})}})},k=(s,t)=>{const p=c.findIndex(re=>re.id===s.id);if(p===-1)return;const g=t==="up"?p-1:p+1;if(g<0||g>=c.length)return;const j=c[g],ae=j.sort_order,ie=s.sort_order;C.mutate({id:s.id,data:{...s,sort_order:ae}},{onSuccess:()=>{C.mutate({id:j.id,data:{...j,sort_order:ie}},{onSuccess:()=>{r({title:"Оновлено",description:"Порядок галереї змінено"})}})}})};return $?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження галерей..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(f,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Пошук галерей...",value:w,onChange:s=>Y(s.target.value),className:"pl-9"})]}),e.jsxs(n,{onClick:K,children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Додати галерею"]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-4",children:G.length>0?G.map(s=>e.jsxs(f,{className:`cursor-pointer transition-colors ${l===s.id?"ring-2 ring-primary":""}`,onClick:()=>y(s.id),children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),k(s,"up")},disabled:c.findIndex(t=>t.id===s.id)===0,children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),k(s,"down")},disabled:c.findIndex(t=>t.id===s.id)===c.length-1,children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),V(s)},children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),X(s)},children:e.jsx(R,{className:"h-4 w-4"})})]})]}),e.jsxs(N,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.imagesCount||0," фотографій"]}),!s.is_published&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Не опубліковано"})]})]},s.id)):e.jsx(f,{children:e.jsx(N,{className:"py-8 text-center text-muted-foreground",children:"Галерей не знайдено"})})}),e.jsx("div",{className:"lg:col-span-2",children:l?e.jsxs(f,{children:[e.jsx(D,{children:e.jsx(E,{children:(d==null?void 0:d.name)||"Галерея"})}),e.jsxs(N,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{ref:s=>b.current[l]=s,type:"file",accept:"image/*",className:"hidden",onChange:s=>Z(l,s)}),e.jsx(n,{onClick:()=>{var s;return(s=b.current[l])==null?void 0:s.click()},disabled:S===l,children:S===l?e.jsx(e.Fragment,{children:"Завантаження..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Додати фотографію"]})})]}),d!=null&&d.images&&d.images.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:d.images.map(s=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"aspect-square relative overflow-hidden rounded-lg",children:[e.jsx("img",{src:s.url,alt:s.title||"Gallery image",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx(n,{variant:"secondary",size:"icon",onClick:()=>ee(s),children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx(n,{variant:"destructive",size:"icon",onClick:()=>te(s),children:e.jsx(R,{className:"h-4 w-4"})})]}),!s.is_published&&e.jsx("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white text-xs px-2 py-1 rounded",children:"Не опубліковано"})]}),s.title&&e.jsx("p",{className:"text-sm font-medium mt-2 truncate",children:s.title})]},s.id))}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(_e,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Поки що немає фотографій у цій галереї"}),e.jsx("p",{className:"text-sm mt-2",children:'Натисніть "Додати фотографію" щоб почати'})]})]})]}):e.jsx(f,{children:e.jsx(N,{className:"py-12 text-center text-muted-foreground",children:"Оберіть галерею для перегляду фотографій"})})})]}),e.jsx(F,{open:A,onOpenChange:x,children:e.jsxs(O,{className:"sm:max-w-[425px]",children:[e.jsx(z,{children:e.jsx(P,{children:(a==null?void 0:a.id)===0?"Додати нову галерею":"Редагувати галерею"})}),a&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"name",className:"text-right",children:"Назва"}),e.jsx(v,{id:"name",value:a.name,onChange:s=>m({...a,name:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"sort_order",className:"text-right",children:"Порядок"}),e.jsx(v,{id:"sort_order",type:"number",value:a.sort_order,onChange:s=>m({...a,sort_order:parseInt(s.target.value)||0}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"is_published",className:"text-right",children:"Опубліковано"}),e.jsx(U,{id:"is_published",checked:a.is_published,onCheckedChange:s=>m({...a,is_published:s}),className:"col-span-3"})]})]}),e.jsxs(T,{children:[e.jsx(n,{variant:"outline",onClick:()=>x(!1),children:"Скасувати"}),e.jsx(n,{onClick:W,children:"Зберегти"})]})]})}),e.jsx(F,{open:J,onOpenChange:_,children:e.jsxs(O,{className:"sm:max-w-[525px]",children:[e.jsx(z,{children:e.jsx(P,{children:"Редагувати фотографію"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:i.url,alt:i.title||"Gallery image",className:"w-full h-64 object-cover rounded-lg"})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"image_title",className:"text-right",children:"Назва"}),e.jsx(v,{id:"image_title",value:i.title||"",onChange:s=>u({...i,title:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(h,{htmlFor:"image_description",className:"text-right",children:"Опис"}),e.jsx(le,{id:"image_description",value:i.description||"",onChange:s=>u({...i,description:s.target.value}),className:"col-span-3",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"image_sort_order",className:"text-right",children:"Порядок"}),e.jsx(v,{id:"image_sort_order",type:"number",value:i.sort_order,onChange:s=>u({...i,sort_order:parseInt(s.target.value)||0}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"image_is_published",className:"text-right",children:"Опубліковано"}),e.jsx(U,{id:"image_is_published",checked:i.is_published,onCheckedChange:s=>u({...i,is_published:s}),className:"col-span-3"})]})]})]}),e.jsxs(T,{children:[e.jsx(n,{variant:"outline",onClick:()=>_(!1),children:"Скасувати"}),e.jsx(n,{onClick:se,children:"Зберегти"})]})]})})]})}export{Ue as Galleries};
