import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as u}from"./chunk-charts-BaLkbnPn.js";import{B as l}from"./button-DbOqy-bd.js";import{I as x}from"./input-CX5tNebo.js";import{C as g,a as P,b as z,d as N}from"./card-hmVZsDUq.js";import{D as R,a as B,b as q,c as H,d as Q}from"./dialog-C08eaag5.js";import{L as c}from"./label-C5UElfPr.js";import{T as $}from"./textarea-qGHGkmRy.js";import{S as A}from"./switch-qxsQaR7_.js";import{B as G,D as J}from"./index-D_0WsTs2.js";import{u as K,a as V,b as W,c as X}from"./useTeam-CxdPBO5z.js";import{S as Y}from"./search-DwN3ncs1.js";import{P as Z,T as ee}from"./trash-2-CKJaomP5.js";import{C as se}from"./chevron-up-mAf4qrzT.js";import{C as te}from"./chevron-down-XBEGSL4M.js";import{S as re}from"./square-pen-GT-FYehh.js";import{U as ae}from"./upload-VPKEcmrZ.js";import"./index-CbFhp7S4.js";import"./Combination-Cynz0wEz.js";import"./index-ZeZSZmiz.js";function Se(){const{toast:o}=G(),[f,S]=u.useState(""),[t,i]=u.useState(null),[D,d]=u.useState(!1),[C,w]=u.useState(!1),p=u.useRef(null),{data:n=[],isLoading:b}=K(!1),k=V(),m=W(),y=X(),I=()=>{i({id:0,name:"",role:"",photo:null,description:"",sort_order:0,is_active:!0}),d(!0)},T=s=>{i({...s}),d(!0)},F=()=>{if(!t)return;if(!t.name||!t.role){o({title:"Помилка",description:"Ім'я та посада обов'язкові",variant:"destructive"});return}const s={name:t.name,role:t.role,photo:t.photo,description:t.description||null,sort_order:t.sort_order||0,is_active:t.is_active};t.id===0?k.mutate(s,{onSuccess:()=>{o({title:"Створено",description:"Члена команди успішно створено"}),d(!1),i(null)},onError:r=>{o({title:"Помилка",description:r.message||"Не вдалося створити члена команди",variant:"destructive"})}}):m.mutate({id:t.id,data:s},{onSuccess:()=>{o({title:"Оновлено",description:"Члена команди успішно оновлено"}),d(!1),i(null)},onError:r=>{o({title:"Помилка",description:r.message||"Не вдалося оновити члена команди",variant:"destructive"})}})},M=s=>{confirm(`Ви впевнені, що хочете видалити "${s.name}"?`)&&y.mutate(s.id,{onSuccess:()=>{o({title:"Видалено",description:"Члена команди успішно видалено",variant:"destructive"})},onError:r=>{o({title:"Помилка",description:r.message||"Не вдалося видалити члена команди",variant:"destructive"})}})},L=async s=>{w(!0);try{const r=new FormData;r.append("image",s);const a=await fetch("/api/team/upload-image",{method:"POST",body:r});if(!a.ok)throw new Error("Не вдалося завантажити зображення");const h=await a.json();t&&i({...t,photo:h.url}),o({title:"Успіх",description:"Зображення завантажено"})}catch(r){o({title:"Помилка",description:r.message||"Не вдалося завантажити зображення",variant:"destructive"})}finally{w(!1)}},E=s=>{var a;const r=(a=s.target.files)==null?void 0:a[0];r&&L(r),p.current&&(p.current.value="")},O=s=>{const r=n.findIndex(v=>v.id===s.id);if(r<=0)return;const a=n[r-1],h=a.sort_order,j=s.sort_order;m.mutate({id:s.id,data:{...s,sort_order:h}}),m.mutate({id:a.id,data:{...a,sort_order:j}})},U=s=>{const r=n.findIndex(v=>v.id===s.id);if(r>=n.length-1)return;const a=n[r+1],h=a.sort_order,j=s.sort_order;m.mutate({id:s.id,data:{...s,sort_order:h}}),m.mutate({id:a.id,data:{...a,sort_order:j}})},_=n.filter(s=>s.name.toLowerCase().includes(f.toLowerCase())||s.role.toLowerCase().includes(f.toLowerCase()));return b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження команди..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(P,{children:e.jsx(z,{children:"Наша команда"})}),e.jsx(N,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Пошук по імені або посаді...",value:f,onChange:s=>S(s.target.value),className:"pl-9"})]}),e.jsxs(l,{onClick:I,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Додати члена команди"]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:_.map(s=>e.jsxs(g,{className:"overflow-hidden",children:[e.jsxs("div",{className:"aspect-square relative bg-muted",children:[s.photo?e.jsx("img",{src:s.photo,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:"Немає фото"}),!s.is_active&&e.jsx("div",{className:"absolute top-2 right-2 bg-destructive text-destructive-foreground px-2 py-1 rounded text-xs font-semibold",children:"Неактивний"})]}),e.jsxs(N,{className:"pt-4",children:[e.jsx("h3",{className:"font-semibold text-base mb-1",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:s.role}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{variant:"outline",size:"icon",onClick:()=>O(s),disabled:n.findIndex(r=>r.id===s.id)===0,children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"icon",onClick:()=>U(s),disabled:n.findIndex(r=>r.id===s.id)===n.length-1,children:e.jsx(te,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",size:"icon",onClick:()=>T(s),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(l,{variant:"destructive",size:"icon",onClick:()=>M(s),disabled:y.isPending,children:e.jsx(ee,{className:"h-4 w-4"})})]})]})]})]},s.id))}),_.length===0&&e.jsx(g,{children:e.jsx(N,{className:"py-12 text-center text-muted-foreground",children:"Членів команди не знайдено"})}),e.jsx(R,{open:D,onOpenChange:d,children:e.jsxs(B,{className:"sm:max-w-[600px]",children:[e.jsx(q,{children:e.jsx(H,{children:(t==null?void 0:t.id)===0?"Додати нового члена команди":"Редагувати члена команди"})}),t&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Ім'я *"}),e.jsx(x,{id:"name",value:t.name,onChange:s=>i({...t,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"role",children:"Посада *"}),e.jsx(x,{id:"role",value:t.role,onChange:s=>i({...t,role:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"photo",children:"Фото"}),e.jsxs("div",{className:"flex items-center gap-4",children:[t.photo&&e.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden bg-muted flex-shrink-0",children:e.jsx("img",{src:t.photo,alt:"Preview",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{id:"photo",value:t.photo||"",onChange:s=>i({...t,photo:s.target.value}),placeholder:"URL зображення або завантажте файл"}),e.jsx(l,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>{var s;return(s=p.current)==null?void 0:s.click()},disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2 animate-spin"}),"Завантаження..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Завантажити з комп'ютера"]})}),e.jsx("input",{ref:p,type:"file",accept:"image/*",className:"hidden",onChange:E})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Опис"}),e.jsx($,{id:"description",value:t.description||"",onChange:s=>i({...t,description:s.target.value}),rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"sort_order",children:"Порядок сортування"}),e.jsx(x,{id:"sort_order",type:"number",value:t.sort_order,onChange:s=>i({...t,sort_order:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:"is_active",checked:t.is_active,onCheckedChange:s=>i({...t,is_active:s})}),e.jsx(c,{htmlFor:"is_active",children:"Активний"})]})]}),e.jsxs(Q,{children:[e.jsx(l,{variant:"outline",onClick:()=>d(!1),children:"Скасувати"}),e.jsx(l,{onClick:F,children:"Зберегти"})]})]})})]})}export{Se as Team};
