import{j as e}from"./chunk-lottie-CUWK48HK.js";import{r as y}from"./chunk-charts-BaLkbnPn.js";import{B as h}from"./button-CL77314Q.js";import{I as g}from"./input-BBBsi8Z9.js";import{C as Q,a as _,b as M,c as R,d as G}from"./card-BW_lIITm.js";import{L as b}from"./label-DA-KCtde.js";import{S as J}from"./switch-Cd6CofSG.js";import{S as W,a as X,b as Y,c as Z,d as F}from"./select-Ev1Ca8_e.js";import{c as K,B as ee,h as se}from"./index-Mb4dqRW5.js";import{D as te,a as ae,b as re,c as le,d as ne}from"./dialog-OdBTZjDK.js";import{u as ie,a as oe,b as ce,c as de,d as me}from"./useComparison-30GZ1mjj.js";import{S as he}from"./save-7Io4OaC_.js";import{P as pe,T as ue}from"./trash-2-DUN5CE86.js";import"./index-ZeZSZmiz.js";import"./index-D4-djExh.js";import"./Combination-BGLAGuqE.js";import"./chevron-down-DrwPgMZL.js";import"./chevron-up-DEVnCGox.js";import"./check-BAFwOO72.js";import"./index-DrrgopKt.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],je=K("pen",xe);function Ue(){const{toast:n}=ee(),E=se(),{data:C,isLoading:I}=ie(),V=oe(),L=ce(),T=de(),z=me(),[t,c]=y.useState(null),[B,d]=y.useState(!1),[r,m]=y.useState({key:"",label:"",type:"text",sortOrder:0}),[v,k]=y.useState({}),[O,S]=y.useState(!1);if(I||!C)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Завантаження..."})});const{features:w,products:N}=C,D=(s,a,p)=>{k(l=>({...l,[s]:{...l[s],[a]:p}}))},U=async()=>{if(!C)return;const s=[];if(Object.entries(v).forEach(([a,p])=>{const l=w.find(i=>i.key===a);l&&Object.entries(p).forEach(([i,u])=>{const o=parseInt(i),x=N.find(j=>j.id===o);if(!x)return;const f=l.values[x.code]??null;u!==f&&s.push({featureKey:a,productId:o,value:u})})}),s.length===0){n({title:"Немає змін",description:"Немає незбережених змін"});return}S(!0);try{for(const a of s)await V.mutateAsync(a);n({title:"Збережено",description:`Успішно збережено ${s.length} ${s.length===1?"значення":"значень"}`}),k({}),await E.invalidateQueries({queryKey:["comparison"]})}catch(a){n({title:"Помилка",description:a.message||"Не вдалося зберегти значення",variant:"destructive"})}finally{S(!1)}},P=()=>{if(!r.key||!r.label){n({title:"Помилка",description:"Заповніть всі обов'язкові поля",variant:"destructive"});return}L.mutate({key:r.key,label:r.label,type:r.type,sortOrder:r.sortOrder},{onSuccess:()=>{n({title:"Успіх",description:"Параметр додано"}),m({key:"",label:"",type:"text",sortOrder:0}),d(!1)},onError:s=>{n({title:"Помилка",description:s.message||"Не вдалося створити параметр",variant:"destructive"})}})},$=s=>{c(s),d(!0)},q=()=>{t&&T.mutate({key:t.key,label:t.label,type:t.type,sortOrder:t.sortOrder},{onSuccess:()=>{n({title:"Успіх",description:"Параметр оновлено"}),c(null),d(!1)},onError:s=>{n({title:"Помилка",description:s.message||"Не вдалося оновити параметр",variant:"destructive"})}})},A=s=>{confirm("Ви впевнені, що хочете видалити цей параметр?")&&z.mutate(s,{onSuccess:()=>{n({title:"Успіх",description:"Параметр видалено"})},onError:a=>{n({title:"Помилка",description:a.message||"Не вдалося видалити параметр",variant:"destructive"})}})},H=Object.keys(v).length>0&&Object.values(v).some(s=>Object.keys(s).length>0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Таблиця порівняння"}),e.jsx("p",{className:"text-muted-foreground",children:"Керування параметрами порівняння товарів"})]}),e.jsxs("div",{className:"flex gap-2",children:[H&&e.jsxs(h,{variant:"outline",onClick:U,disabled:O,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),O?"Збереження...":"Зберегти зміни"]}),e.jsxs(h,{onClick:()=>d(!0),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Додати параметр"]})]})]}),e.jsxs(Q,{children:[e.jsxs(_,{children:[e.jsx(M,{children:"Параметри порівняння"}),e.jsx(R,{children:"Редагуйте значення параметрів для кожного товару"})]}),e.jsx(G,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 font-semibold sticky left-0 bg-background z-10 min-w-[200px]",children:"Параметр"}),e.jsx("th",{className:"text-center p-3 font-semibold min-w-[80px]",children:"Порядок"}),N.map(s=>e.jsx("th",{className:"text-center p-3 font-semibold min-w-[150px]",children:s.name},s.id)),e.jsx("th",{className:"p-3 w-[100px]"})]})}),e.jsx("tbody",{children:w.map((s,a)=>{const p=s.type==="boolean";return e.jsxs("tr",{className:a%2===0?"bg-muted/50":"",children:[e.jsxs("td",{className:"p-3 sticky left-0 bg-inherit z-10 font-medium",children:[s.label,e.jsx(h,{variant:"ghost",size:"sm",className:"ml-2 h-6 w-6 p-0",onClick:()=>$(s),children:e.jsx(je,{className:"h-3 w-3"})})]}),e.jsx("td",{className:"p-3 text-center",children:s.sortOrder}),N.map(l=>{var f;const i=(f=v[s.key])==null?void 0:f[l.id],u=s.values[l.code]??null,o=i!==void 0?i:u,x=i!==void 0&&i!==u;return e.jsx("td",{className:"p-3",children:p?e.jsx("div",{className:"flex justify-center",children:e.jsx(J,{checked:o===!0,onCheckedChange:j=>D(s.key,l.id,j)})}):e.jsxs("div",{className:"relative",children:[e.jsx(g,{value:(o==null?void 0:o.toString())||"",onChange:j=>D(s.key,l.id,j.target.value||null),placeholder:"Введіть значення",className:`w-full ${x?"ring-2 ring-primary":""}`}),x&&e.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-primary rounded-full"})]})},l.id)}),e.jsx("td",{className:"p-3",children:e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>A(s.key),children:e.jsx(ue,{className:"h-4 w-4 text-destructive"})})})]},s.key)})})]})})})]}),e.jsx(te,{open:B,onOpenChange:d,children:e.jsxs(ae,{children:[e.jsx(re,{children:e.jsx(le,{children:t?"Редагувати параметр":"Додати параметр"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"key",children:"Ключ (латиниця, без пробілів)"}),e.jsx(g,{id:"key",value:(t==null?void 0:t.key)||r.key,onChange:s=>{t||m({...r,key:s.target.value.toLowerCase().replace(/\s+/g,"-")})},disabled:!!t,placeholder:"colors"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"label",children:"Назва параметра"}),e.jsx(g,{id:"label",value:(t==null?void 0:t.label)||r.label,onChange:s=>{t?c({...t,label:s.target.value}):m({...r,label:s.target.value})},placeholder:"Кількість кольорів фетру"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"type",children:"Тип параметра"}),e.jsxs(W,{value:(t==null?void 0:t.type)||r.type,onValueChange:s=>{t?c({...t,type:s}):m({...r,type:s})},children:[e.jsx(X,{children:e.jsx(Y,{placeholder:"Виберіть тип"})}),e.jsxs(Z,{children:[e.jsx(F,{value:"text",children:"Текст"}),e.jsx(F,{value:"boolean",children:"Булеве значення (Так/Ні)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"sortOrder",children:"Порядок сортування"}),e.jsx(g,{id:"sortOrder",type:"number",value:(t==null?void 0:t.sortOrder)??r.sortOrder,onChange:s=>{const a=parseInt(s.target.value)||0;t?c({...t,sortOrder:a}):m({...r,sortOrder:a})}})]})]}),e.jsxs(ne,{children:[e.jsx(h,{variant:"outline",onClick:()=>{d(!1),c(null),m({key:"",label:"",type:"text",sortOrder:0})},children:"Скасувати"}),e.jsx(h,{onClick:t?q:P,children:t?"Зберегти":"Додати"})]})]})})]})}export{Ue as Comparison};
