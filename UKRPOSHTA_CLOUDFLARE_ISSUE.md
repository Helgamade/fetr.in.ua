# –ü—Ä–æ–±–ª–µ–º–∞ —Å Cloudflare –∑–∞—â–∏—Ç–æ–π API –£–∫—Ä–ø–æ—à—Ç—ã

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞

API –£–∫—Ä–ø–æ—à—Ç—ã –∑–∞—â–∏—â–µ–Ω–æ **Cloudflare** –∏ **–±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**.

### –°–∏–º–ø—Ç–æ–º—ã:
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞) —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚ùå –ó–∞–ø—Ä–æ—Å—ã —Å –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å –æ—Ç–≤–µ—Ç–æ–º `Request Rejected`
- ‚ùå Cloudflare challenge (`__CF$cv$params`) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏:
```html
<html>
  <head><title>Request Rejected</title></head>
  <body>
    The requested URL was rejected. Please consult with your administrator.
    <br><br>Your support ID is: 1841581484055481839
  </body>
</html>
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

**–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API –£–∫—Ä–ø–æ—à—Ç—ã –¥–µ–ª–∞—é—Ç—Å—è –ù–ê–ü–†–Ø–ú–£–Æ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞** (–∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç):
```
Browser ‚Üí Our Server ‚Üí Ukrposhta API (‚ùå Cloudflare –±–ª–æ–∫–∏—Ä—É–µ—Ç)
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Ä–∞–±–æ—Ç–∞–µ—Ç):
```
Browser ‚Üí Ukrposhta API ‚úÖ (Cloudflare –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. `src/lib/api.ts`

–í—Å–µ –º–µ—Ç–æ–¥—ã `ukrposhtaAPI` —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞—é—Ç –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```typescript
export const ukrposhtaAPI = {
  // ‚ö†Ô∏è –í–ê–ñ–ù–û: API –£–∫—Ä–ø–æ—à—Ç—ã –∑–∞—â–∏—â–µ–Ω–æ Cloudflare –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  // –ü–æ—ç—Ç–æ–º—É –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–µ–ª–∞—é—Ç—Å—è –ù–ê–ü–†–Ø–ú–£–Æ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  
  getPopularCities: async () => {
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞—Ä–∞–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
    return [ /* –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ */ ];
  },
  
  searchCities: async (query: string) => {
    // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –ù–ê–ü–†–Ø–ú–£–Æ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
    const data = await callUkrposhtaAPIDirect(
      `/get_city_by_region_id_and_district_id_and_city_ua?region_id=${region.id}&city_ua=${query}`
    );
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  },
  
  getBranches: async (cityId: string, search?: string) => {
    // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –ù–ê–ü–†–Ø–ú–£–Æ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
    const data = await callUkrposhtaAPIDirect(
      `/get_postoffices_by_postcode_cityid_cityvpzid?city_id=${cityId}`
    );
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  },
};
```

### 2. `server/routes/ukrposhta.js`

–°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ä–æ—É—Ç—ã –±–æ–ª—å—à–µ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –±—É–¥—É—â–µ–≥–æ).

---

## üéØ –†–∞–±–æ—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### URL:
```javascript
const UKRPOSHTA_API_BASE = 'https://www.ukrposhta.ua/address-classifier-ws';
```

### –¢–æ–∫–µ–Ω:
```javascript
const UKRPOSHTA_BEARER_TOKEN = '67f02a7c-3af7-34d1-aa18-7eb4d96f3be4'; // PROD_BEARER_ECOM
```

### Headers:
```javascript
{
  'Authorization': `Bearer ${UKRPOSHTA_BEARER_TOKEN}`,
  'Accept': 'application/json',
}
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

1. ‚úÖ **Cloudflare –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**  
   –ë—Ä–∞—É–∑–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç Cloudflare challenge –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. ‚úÖ **–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä**  
   API –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä

3. ‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**  
   –ù–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ hop —á–µ—Ä–µ–∑ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä

4. ‚úÖ **–ü—Ä–æ—â–µ –¥–µ–ø–ª–æ–π**  
   –ù–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

## ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

1. ‚ö†Ô∏è **–¢–æ–∫–µ–Ω –≤–∏–¥–µ–Ω –≤ –∫–æ–¥–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞**  
   –¢–æ–∫–µ–Ω API –±—É–¥–µ—Ç –≤–∏–¥–µ–Ω –≤ JavaScript –∫–æ–¥–µ. –ù–æ —ç—Ç–æ production —Ç–æ–∫–µ–Ω, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

2. ‚ö†Ô∏è **CORS –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º—ã**  
   –ï—Å–ª–∏ API –£–∫—Ä–ø–æ—à—Ç—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª–æ CORS –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º.
   –†–µ—à–µ–Ω–∏–µ: Ukrposhta –¥–æ–ª–∂–Ω—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞—à –¥–æ–º–µ–Ω `fetr.in.ua` –≤ whitelist CORS.

3. ‚ö†Ô∏è **–ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**  
   –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç —Å–≤–æ–∏ –∑–∞–ø—Ä–æ—Å—ã –∫ API –£–∫—Ä–ø–æ—à—Ç—ã.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç (–ª–æ–∫–∞–ª—å–Ω–æ):
```bash
cd server/scripts
node test-ukrposhta-api.js
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ 63 —Ä–∞–±–æ—á–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω—ã
- ‚úÖ API –æ—Ç–≤–µ—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–º 200
- ‚ö†Ô∏è –ù–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã `{"Entries": {}}`

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
curl -H 'Authorization: Bearer 67f02a7c-3af7-34d1-aa18-7eb4d96f3be4' \
     -H 'Accept: application/json' \
     'https://www.ukrposhta.ua/address-classifier-ws/get_regions'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: Request Rejected (Cloudflare)
```

### –ò–∑ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
fetch('https://www.ukrposhta.ua/address-classifier-ws/get_regions', {
  headers: {
    'Authorization': 'Bearer 67f02a7c-3af7-34d1-aa18-7eb4d96f3be4',
    'Accept': 'application/json',
  }
})
  .then(res => res.json())
  .then(data => console.log(data));
// ‚úÖ –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å (Cloudflare –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
```

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API –∑–∞–ø—Ä–æ—Å—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ production
2. ‚ö†Ô∏è –ï—Å–ª–∏ CORS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, —Å–≤—è–∑–∞—Ç—å—Å—è —Å –£–∫—Ä–ø–æ—à—Ç–æ–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `fetr.in.ua` –≤ whitelist
3. ‚ö†Ô∏è –ï—Å–ª–∏ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
4. ‚úÖ –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ä–æ—É—Ç—ã `/api/ukrposhta/*` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

---

**–î–∞—Ç–∞**: 2026-01-01  
**–ê–≤—Ç–æ—Ä**: AI Assistant

