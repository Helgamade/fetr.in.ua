# Устранение проблемы "Invalid signature (1113)" в WayForPay

## Результаты проверки

✅ **Алгоритм генерации подписи работает правильно** - тест подтвердил, что подпись генерируется корректно и совпадает с логами.

## Возможные причины ошибки

### 1. Неверный Secret Key
**Проверка:**
- Зайдите в личный кабинет WayForPay
- Перейдите в "Мои магазины" → "Настройки магазина" → "Реквизиты мерчанта"
- Убедитесь, что Secret Key совпадает с тем, что в `server/.env`:
  ```
  WAYFORPAY_SECRET_KEY=77cbf18313c8c17e70ffe4bfad6b50fa37bb8ef5
  ```

**Если Secret Key отличается:**
- Обновите значение в `server/.env`
- Перезапустите сервер

### 2. Магазин не активирован
**Проверка:**
- Зайдите в личный кабинет WayForPay
- Перейдите в "Мои магазины"
- Убедитесь, что магазин `www_fetr_in_ua` имеет статус "Активирован"

**Если магазин не активирован:**
- Следуйте инструкциям для активации магазина
- Обычно требуется заполнить данные о компании и подтвердить документы

### 3. Проблема с доменом
**Проверка:**
- Убедитесь, что в настройках магазина указан правильный домен: `fetr.in.ua`
- Домен должен быть подтвержден в WayForPay

### 4. Тестовый vs Боевой режим
**Проверка:**
- Убедитесь, что используете правильные реквизиты (тестовые или боевые)
- Тестовые и боевые Secret Key различаются

## Контакты для поддержки

Если проблема сохраняется после всех проверок:

**Техническая поддержка WayForPay:**
- Email: tech@wayforpay.com
- Телефон: +380 44 379 48 49
- Telegram: @wayforpay

**Что сообщить в поддержку:**
1. Код ошибки: 1113 (Invalid signature)
2. Merchant Account: www_fetr_in_ua
3. Пример строки подписи из логов (можно взять из последних логов)
4. Скриншот или описание проблемы

## Проверка через тестовый скрипт

Запустите тестовый скрипт для проверки генерации подписи:

```bash
cd /home/idesig02/fetr.in.ua/www
node server/scripts/test-wayforpay-signature.js
```

Скрипт должен показать, что подпись генерируется правильно и совпадает с логами.

## Логи для отладки

Последние логи можно посмотреть командой:

```bash
tail -100 /home/idesig02/.system/webapp/www.fetr.in.ua.log | grep -A 15 WayForPay
```

Ищите строку "Signature string" и "Generated signature" - они должны быть в логах.

